<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>global_ocean &mdash; compass 1.1.0-rc.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="gotm" href="gotm.html" />
    <link rel="prev" title="global_convergence" href="global_convergence.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> compass
          </a>
              <div class="version">
                1.1.0-rc.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/quick_start.html">Quick Start for Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/test_cases.html">Test Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/config_files.html">Config Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/test_suites.html">Test Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/landice/index.html">Landice core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/ocean/index.html">Ocean core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/machines/index.html">Machines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../quick_start.html">Quick Start for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../command_line.html">Command-line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../organization.html">Organization of Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../landice/index.html">Landice core</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Ocean core</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Test groups</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="baroclinic_channel.html">baroclinic_channel</a></li>
<li class="toctree-l3"><a class="reference internal" href="drying_slope.html">drying_slope</a></li>
<li class="toctree-l3"><a class="reference internal" href="global_convergence.html">global_convergence</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">global_ocean</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#framework">Framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="#test-cases">Test cases</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="gotm.html">gotm</a></li>
<li class="toctree-l3"><a class="reference internal" href="ice_shelf_2d.html">ice_shelf_2d</a></li>
<li class="toctree-l3"><a class="reference internal" href="internal_wave.html">internal_wave</a></li>
<li class="toctree-l3"><a class="reference internal" href="isomip_plus.html">isomip_plus</a></li>
<li class="toctree-l3"><a class="reference internal" href="planar_convergence.html">planar_convergence</a></li>
<li class="toctree-l3"><a class="reference internal" href="soma.html">soma</a></li>
<li class="toctree-l3"><a class="reference internal" href="sphere_transport.html">sphere_transport</a></li>
<li class="toctree-l3"><a class="reference internal" href="ziso.html">ziso</a></li>
<li class="toctree-l3"><a class="reference internal" href="spherical_harmonic_transform.html">spherical_harmonic_transform</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../framework.html">Ocean framework</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../framework.html">Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../machines/index.html">Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building_docs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design_docs/index.html">Design Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/dev_add_test_group.html">Developer Tutorial: Adding a new test group</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/dev_add_param_study.html">Developer Tutorial: Adding a parameter study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/dev_porting_legacy.html">Developer Tutorial: Porting a legacy COMPASS test group</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Glossary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../versions.html">Code and Documentation Versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">compass</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Ocean core</a> &raquo;</li>
          <li><a href="index.html">Test groups</a> &raquo;</li>
      <li>global_ocean</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/developers_guide/ocean/test_groups/global_ocean.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="global-ocean">
<span id="dev-ocean-global-ocean"></span><h1>global_ocean<a class="headerlink" href="#global-ocean" title="Permalink to this heading">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">global_ocean</span></code> test group
(<a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.GlobalOcean.html#compass.ocean.tests.global_ocean.GlobalOcean" title="compass.ocean.tests.global_ocean.GlobalOcean"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.GlobalOcean</span></code></a>)
creates meshes and initial conditions, and performs testing and dynamic
adjustment for global, realistic ocean domains. It includes 9 test cases on 5
meshes, with the expectation that more meshes from <a class="reference internal" href="../../../index.html#legacy-compass"><span class="std std-ref">Legacy COMPASS</span></a> will
be added in the near future.</p>
<section id="framework">
<span id="dev-ocean-global-ocean-framework"></span><h2>Framework<a class="headerlink" href="#framework" title="Permalink to this heading">¶</a></h2>
<p>The shared config options for the <code class="docutils literal notranslate"><span class="pre">global_ocean</span></code> test group
are described in <a class="reference internal" href="../../../users_guide/ocean/test_groups/global_ocean.html#ocean-global-ocean"><span class="std std-ref">global_ocean</span></a> in the User’s Guide.</p>
<p>Additionally, the test group has several shared namelist and streams files,
some for shared parameters and streams for forward runs (<code class="docutils literal notranslate"><span class="pre">namelist.forward</span></code>
and <code class="docutils literal notranslate"><span class="pre">streams.forward</span></code>), one specific to meshes with ice-shelf cavities
(<code class="docutils literal notranslate"><span class="pre">namelist.wisc</span></code>), and some related to simulations with biogeochemistry
(<code class="docutils literal notranslate"><span class="pre">namelist.bgc</span></code> and <code class="docutils literal notranslate"><span class="pre">streams.bgc</span></code>).</p>
<section id="configure">
<span id="dev-ocean-global-ocean-config"></span><h3>configure<a class="headerlink" href="#configure" title="Permalink to this heading">¶</a></h3>
<p>The function <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.configure.configure_global_ocean.html#compass.ocean.tests.global_ocean.configure.configure_global_ocean" title="compass.ocean.tests.global_ocean.configure.configure_global_ocean"><code class="xref py py-func docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.configure.configure_global_ocean()</span></code></a>
is used to set config options for most test cases in <code class="docutils literal notranslate"><span class="pre">global_ocean</span></code>.  It
takes as arguments a test case object, a <a class="reference internal" href="#dev-ocean-global-ocean-mesh"><span class="std std-ref">mesh test case</span></a>
object, and optionally an <a class="reference internal" href="#dev-ocean-global-ocean-init"><span class="std std-ref">init test case</span></a> object.  These
2 or 3 test cases are used to:</p>
<ul class="simple">
<li><p>add config options specific to the mesh</p></li>
<li><p>add config options specific to the test case</p></li>
<li><p>set config options describing the mesh and initial conditions (if <code class="docutils literal notranslate"><span class="pre">init</span></code>
is provided).  The config options will be used to add
<a class="reference internal" href="#dev-ocean-global-ocean-metadata"><span class="std std-ref">metadata</span></a> to output files describing the mesh
and initial condition.</p></li>
</ul>
</section>
<section id="metadata">
<span id="dev-ocean-global-ocean-metadata"></span><h3>metadata<a class="headerlink" href="#metadata" title="Permalink to this heading">¶</a></h3>
<p>The module <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.metadata</span></code> determines the values
of a set of metadata related to the E3SM mesh name, initial condition, conda
environment, etc. that are added to nearly all <code class="docutils literal notranslate"><span class="pre">global_ocean</span></code> NetCDF output.
See <a class="reference internal" href="../../../users_guide/ocean/test_groups/global_ocean.html#global-ocean-metadata"><span class="std std-ref">Metadata</span></a> in the User’s Guide for more details on
what the metadata looks like.</p>
<p>The values of some of the metadata are given in config options:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># options for global ocean testcases</span><span class="w"></span>
<span class="k">[global_ocean]</span><span class="w"></span>

<span class="na">...</span><span class="w"></span>

<span class="c1">## metadata related to the mesh</span><span class="w"></span>
<span class="c1"># whether to add metadata to output files</span><span class="w"></span>
<span class="na">add_metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span><span class="w"></span>
<span class="c1"># the prefix (e.g. QU, EC, WC, SO)</span><span class="w"></span>
<span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">PREFIX</span><span class="w"></span>
<span class="c1"># a description of the mesh</span><span class="w"></span>
<span class="na">mesh_description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span><span class="w"></span>
<span class="c1"># a description of the bathymetry</span><span class="w"></span>
<span class="na">bathy_description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span><span class="w"></span>
<span class="c1"># a description of the mesh with ice-shelf cavities</span><span class="w"></span>
<span class="na">init_description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span><span class="w"></span>
<span class="c1"># E3SM version that the mesh is intended for</span><span class="w"></span>
<span class="na">e3sm_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2</span><span class="w"></span>
<span class="c1"># The revision number of the mesh, which should be incremented each time the</span><span class="w"></span>
<span class="c1"># mesh is revised</span><span class="w"></span>
<span class="na">mesh_revision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;&lt;Missing&gt;&gt;</span><span class="w"></span>
<span class="c1"># the minimum (finest) resolution in the mesh</span><span class="w"></span>
<span class="na">min_res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span><span class="w"></span>
<span class="c1"># the maximum (coarsest) resolution in the mesh, can be the same as min_res</span><span class="w"></span>
<span class="na">max_res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span><span class="w"></span>
<span class="c1"># the maximum depth of the ocean, always detected automatically</span><span class="w"></span>
<span class="na">max_depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">autodetect</span><span class="w"></span>
<span class="c1"># the number of vertical levels, always detected automatically</span><span class="w"></span>
<span class="na">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">autodetect</span><span class="w"></span>

<span class="c1"># the date the mesh was created as YYMMDD, typically detected automatically</span><span class="w"></span>
<span class="na">creation_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">autodetect</span><span class="w"></span>
<span class="c1"># The following options are detected from .gitconfig if not explicitly entered</span><span class="w"></span>
<span class="na">author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">autodetect</span><span class="w"></span>
<span class="na">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">autodetect</span><span class="w"></span>
<span class="c1"># The URL of the pull request documenting the creation of the mesh</span><span class="w"></span>
<span class="na">pull_request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>Each mesh should define a number of these config options, e.g. <code class="docutils literal notranslate"><span class="pre">EC30to60</span></code>
defines:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># options for global ocean testcases</span><span class="w"></span>
<span class="k">[global_ocean]</span><span class="w"></span>

<span class="na">...</span><span class="w"></span>

<span class="c1">## metadata related to the mesh</span><span class="w"></span>
<span class="c1"># the prefix (e.g. QU, EC, WC, SO)</span><span class="w"></span>
<span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">EC</span><span class="w"></span>
<span class="c1"># a description of the mesh and initial condition</span><span class="w"></span>
<span class="na">mesh_description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">MPAS Eddy Closure mesh for E3SM version ${e3sm_version} with</span><span class="w"></span>
<span class="w">                   </span><span class="na">enhanced resolution around the equator (30 km), South pole</span><span class="w"></span>
<span class="w">                   </span><span class="na">(35 km), Greenland (${min_res} km), ${max_res}-km resolution</span><span class="w"></span>
<span class="w">                   </span><span class="na">at mid latitudes, and ${levels} vertical levels</span><span class="w"></span>
<span class="c1"># E3SM version that the mesh is intended for</span><span class="w"></span>
<span class="na">e3sm_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2</span><span class="w"></span>
<span class="c1"># The revision number of the mesh, which should be incremented each time the</span><span class="w"></span>
<span class="c1"># mesh is revised</span><span class="w"></span>
<span class="na">mesh_revision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3</span><span class="w"></span>
<span class="c1"># the minimum (finest) resolution in the mesh</span><span class="w"></span>
<span class="na">min_res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">30</span><span class="w"></span>
<span class="c1"># the maximum (coarsest) resolution in the mesh, can be the same as min_res</span><span class="w"></span>
<span class="na">max_res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">60</span><span class="w"></span>
<span class="c1"># The URL of the pull request documenting the creation of the mesh</span><span class="w"></span>
<span class="na">pull_request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>In this particular case, the <code class="docutils literal notranslate"><span class="pre">pull_request</span></code> has not yet been defined.  Each
time the mesh is revised, the <code class="docutils literal notranslate"><span class="pre">mesh_revision</span></code> should be updated and the
associated pull request to <a class="reference external" href="https://github.com/MPAS-Dev/compass/">https://github.com/MPAS-Dev/compass/</a> should be
added here.</p>
<p>The function <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.metadata.get_e3sm_mesh_names.html#compass.ocean.tests.global_ocean.metadata.get_e3sm_mesh_names" title="compass.ocean.tests.global_ocean.metadata.get_e3sm_mesh_names"><code class="xref py py-func docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.metadata.get_e3sm_mesh_names()</span></code></a>
is used to construct the “short” and “long” names of the mesh using a
standard naming convention for E3SM:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">short_mesh_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">E</span><span class="si">{}</span><span class="s1">r</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mesh_prefix</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">e3sm_version</span><span class="p">,</span>
                                      <span class="n">mesh_revision</span><span class="p">)</span>
<span class="n">long_mesh_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">kmL</span><span class="si">{}</span><span class="s1">E3SMv</span><span class="si">{}</span><span class="s1">r</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mesh_prefix</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span>
                                              <span class="n">e3sm_version</span><span class="p">,</span> <span class="n">mesh_revision</span><span class="p">)</span>
</pre></div>
</div>
<p>For example, the <code class="docutils literal notranslate"><span class="pre">QU240</span></code> mesh has the E3SM short name <code class="docutils literal notranslate"><span class="pre">QU240E2r1</span></code> and
long name <code class="docutils literal notranslate"><span class="pre">QU240kmL16E3SMv2r1</span></code>.</p>
</section>
<section id="forward-test-case">
<span id="dev-ocean-global-ocean-forward-test"></span><h3>forward test case<a class="headerlink" href="#forward-test-case" title="Permalink to this heading">¶</a></h3>
<p>The parent class for test cases in <code class="docutils literal notranslate"><span class="pre">global_ocean</span></code> that include running
MPAS-Ocean forward in time is
<a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.forward.ForwardTestCase.html#compass.ocean.tests.global_ocean.forward.ForwardTestCase" title="compass.ocean.tests.global_ocean.forward.ForwardTestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.forward.ForwardTestCase</span></code></a>.  This
class has attributes <code class="docutils literal notranslate"><span class="pre">self.mesh</span></code> and <code class="docutils literal notranslate"><span class="pre">self.init</span></code> to keep track of the
<a class="reference internal" href="#dev-ocean-global-ocean-mesh"><span class="std std-ref">mesh test case</span></a> and <a class="reference internal" href="#dev-ocean-global-ocean-init"><span class="std std-ref">init test case</span></a> made
the mesh and initial condition that this test case will use.  It also has an
attribute <code class="docutils literal notranslate"><span class="pre">self.time_integrator</span></code> to determine whether <code class="docutils literal notranslate"><span class="pre">split-explicit</span></code> or
<code class="docutils literal notranslate"><span class="pre">RK4</span></code> time integration will be used.</p>
<p>In its <code class="docutils literal notranslate"><span class="pre">configure()</span></code> method, <code class="docutils literal notranslate"><span class="pre">ForwardTestCase</span></code> takes care of config options
by calling <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.configure.configure_global_ocean.html#compass.ocean.tests.global_ocean.configure.configure_global_ocean" title="compass.ocean.tests.global_ocean.configure.configure_global_ocean"><code class="xref py py-func docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.configure.configure_global_ocean()</span></code></a>.</p>
<p>In its <code class="docutils literal notranslate"><span class="pre">run()</span></code> method, it sets the number of target and minimum number of
cores as well as the number of threads based on config options.  Then, it calls
the base class’ <code class="docutils literal notranslate"><span class="pre">run()</span></code> method to run its steps.</p>
</section>
<section id="forward-step">
<span id="dev-ocean-global-ocean-forward-step"></span><h3>forward step<a class="headerlink" href="#forward-step" title="Permalink to this heading">¶</a></h3>
<p>The parent class for steps in <code class="docutils literal notranslate"><span class="pre">global_ocean</span></code> that run MPAS-Ocean forward in
time is <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.forward.ForwardStep.html#compass.ocean.tests.global_ocean.forward.ForwardStep" title="compass.ocean.tests.global_ocean.forward.ForwardStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.forward.ForwardStep</span></code></a>.
The constructor for <code class="docutils literal notranslate"><span class="pre">ForwardStep</span></code> takes several arguments.  At a minimum,
the parent test case and the test cases for the mesh and initial-condition
that will be used for the forward model run are needed, along with the
time integrator (<code class="docutils literal notranslate"><span class="pre">split-explicit</span></code> or <code class="docutils literal notranslate"><span class="pre">RK4</span></code>).  Here is an example from the
<a class="reference internal" href="#dev-ocean-global-ocean-performance-test"><span class="std std-ref">performance_test test case</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PerformanceTest</span><span class="p">(</span><span class="n">ForwardTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A test case for performing a short forward run with an MPAS-Ocean global</span>
<span class="sd">    initial condition assess performance and compare with previous results</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_group</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">time_integrator</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create test case</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        test_group : compass.ocean.tests.global_ocean.GlobalOcean</span>
<span class="sd">            The global ocean test group that this test case belongs to</span>

<span class="sd">        mesh : compass.ocean.tests.global_ocean.mesh.Mesh</span>
<span class="sd">            The test case that produces the mesh for this run</span>

<span class="sd">        init : compass.ocean.tests.global_ocean.init.Init</span>
<span class="sd">            The test case that produces the initial condition for this run</span>

<span class="sd">        time_integrator : {&#39;split_explicit&#39;, &#39;RK4&#39;}</span>
<span class="sd">            The time integrator to use for the forward run</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">test_group</span><span class="o">=</span><span class="n">test_group</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
                         <span class="n">time_integrator</span><span class="o">=</span><span class="n">time_integrator</span><span class="p">,</span>
                         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;performance_test&#39;</span><span class="p">)</span>

        <span class="n">step</span> <span class="o">=</span> <span class="n">ForwardStep</span><span class="p">(</span><span class="n">test_case</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
                           <span class="n">time_integrator</span><span class="o">=</span><span class="n">time_integrator</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">with_ice_shelf_cavities</span><span class="p">:</span>
            <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span>
            <span class="n">step</span><span class="o">.</span><span class="n">add_namelist_file</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s1">&#39;namelist.wisc&#39;</span><span class="p">)</span>
            <span class="n">step</span><span class="o">.</span><span class="n">add_streams_file</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s1">&#39;streams.wisc&#39;</span><span class="p">)</span>
            <span class="n">step</span><span class="o">.</span><span class="n">add_output_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;land_ice_fluxes.nc&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
</pre></div>
</div>
<p>As in the example above, these are typically passed along from the arguments
to the the test case’s own constructor.</p>
<p>Performance-related parameters—<code class="docutils literal notranslate"><span class="pre">cores</span></code>, <code class="docutils literal notranslate"><span class="pre">min_cores</span></code>, and
<code class="docutils literal notranslate"><span class="pre">threads</span></code>—can be passed as optional arguments, but they are more typically
read from the corresponding <code class="docutils literal notranslate"><span class="pre">forward_&lt;param&gt;</span></code> config options in the
<code class="docutils literal notranslate"><span class="pre">global_ocean</span></code> section of the config file.  This lets users update these
values as appropriate if the machine and/or mesh defaults aren’t quite right
for them.</p>
<p>During init, the <code class="docutils literal notranslate"><span class="pre">forward</span></code>, <code class="docutils literal notranslate"><span class="pre">wisc</span></code> and <code class="docutils literal notranslate"><span class="pre">bgc</span></code> namelist replacements and
streams files are added as appropriate based on whether the mesh includes
ice-shelf cavities and the initial condition includes biogeochemistry. Further
namelist replacements and streams files can be added in the test case
before adding the step, as in the example above.</p>
<p>The MPAS model is linked in as in input to the step in the <code class="docutils literal notranslate"><span class="pre">setup()</span></code> method,
which also updates the <code class="docutils literal notranslate"><span class="pre">self.cores</span></code>, <code class="docutils literal notranslate"><span class="pre">self.min_cores</span></code> and <code class="docutils literal notranslate"><span class="pre">self.threads</span></code>
attributes from config options if they have not been set explicitly in the
constructor.  Then, in the <code class="docutils literal notranslate"><span class="pre">run()</span></code> method, it runs MPAS-Ocean (including
updating PIO namelist options and generating a graph partition), then
<a class="reference internal" href="../../../users_guide/ocean/test_groups/global_ocean.html#global-ocean-metadata"><span class="std std-ref">Metadata</span></a> is added to the output NetCDF files.</p>
</section>
</section>
<section id="test-cases">
<span id="dev-ocean-global-ocean-testcases"></span><h2>Test cases<a class="headerlink" href="#test-cases" title="Permalink to this heading">¶</a></h2>
<p>There are 9 <code class="docutils literal notranslate"><span class="pre">global_ocean</span></code> test cases.  First, <code class="docutils literal notranslate"><span class="pre">mesh</span></code> must be run to
generate and cull the mesh, then one of the variants of <code class="docutils literal notranslate"><span class="pre">init</span></code> must be run
to create an initial condition on that mesh.  After that, any of the
regression-focused test cases (<code class="docutils literal notranslate"><span class="pre">performance_test</span></code>, <code class="docutils literal notranslate"><span class="pre">restart_test</span></code>,
<code class="docutils literal notranslate"><span class="pre">decomp_test</span></code>, <code class="docutils literal notranslate"><span class="pre">threads_test</span></code>, <code class="docutils literal notranslate"><span class="pre">analysis_test</span></code>, or <code class="docutils literal notranslate"><span class="pre">daily_output_test</span></code>)
can be run in any order and as desired.  If an initial condition for E3SM is
desired, the user (or test suite) should first run <code class="docutils literal notranslate"><span class="pre">dynamic_adjustment</span></code> and
then <code class="docutils literal notranslate"><span class="pre">files_for_e3sm</span></code>.</p>
<section id="mesh-test-case">
<span id="dev-ocean-global-ocean-mesh"></span><h3>mesh test case<a class="headerlink" href="#mesh-test-case" title="Permalink to this heading">¶</a></h3>
<p>This test case generates an MPAS horizontal mesh, then culls out the land cells
to improve model efficiency.</p>
<p>A <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.mesh.Mesh.html#compass.ocean.tests.global_ocean.mesh.Mesh" title="compass.ocean.tests.global_ocean.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.Mesh</span></code></a> object is constructed
with the <code class="docutils literal notranslate"><span class="pre">mesh_name</span></code> as one of its arguments.  Based on this argument, it
determines the appropriate child class of
<a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.mesh.mesh.MeshStep.html#compass.ocean.tests.global_ocean.mesh.mesh.MeshStep" title="compass.ocean.tests.global_ocean.mesh.mesh.MeshStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.mesh.MeshStep</span></code></a> to create.</p>
<section id="mesh-step">
<span id="dev-ocean-global-ocean-mesh-step"></span><h4>mesh step<a class="headerlink" href="#mesh-step" title="Permalink to this heading">¶</a></h4>
<p>The parent class <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.mesh.mesh.MeshStep.html#compass.ocean.tests.global_ocean.mesh.mesh.MeshStep" title="compass.ocean.tests.global_ocean.mesh.mesh.MeshStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.mesh.MeshStep</span></code></a>
defines a method
<a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.mesh.mesh.MeshStep.build_cell_width_lat_lon.html#compass.ocean.tests.global_ocean.mesh.mesh.MeshStep.build_cell_width_lat_lon" title="compass.ocean.tests.global_ocean.mesh.mesh.MeshStep.build_cell_width_lat_lon"><code class="xref py py-meth docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.mesh.MeshStep.build_cell_width_lat_lon()</span></code></a>
that a child class for each mesh type must override to define the size of
MPAS cells as a function of longitude and latitude.</p>
<p>This class also takes care of defining the output from the step and storing
attributes:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">self.mesh_name</span></code></dt><dd><p>the name of the mesh</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">self.with_ice_shelf_cavities</span></code></dt><dd><p>whether the mesh should include ice-shelf cavities</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">self.package</span></code></dt><dd><p>the module (package) where the config options, namelist and streams files
specific to the mesh can be found</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">self.mesh_config_filename</span></code></dt><dd><p>the name of the config file with mesh-specific config options</p>
</dd>
</dl>
<p>In its <code class="docutils literal notranslate"><span class="pre">run()</span></code> method, <code class="docutils literal notranslate"><span class="pre">MeshStep</span></code> calls the <code class="docutils literal notranslate"><span class="pre">build_cell_width_lat_lon()</span></code>
method to get the desired mesh resolution, then creates the mesh by calling
<a class="reference external" href="http://mpas-dev.github.io/MPAS-Tools/stable/generated/mpas_tools.ocean.build_mesh.build_spherical_mesh.html#mpas_tools.ocean.build_mesh.build_spherical_mesh" title="(in mpas_tools vstable)"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.ocean.build_mesh.build_spherical_mesh()</span></code></a> culls out land
cells by calling <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.mesh.cull.cull_mesh.html#compass.ocean.tests.global_ocean.mesh.cull.cull_mesh" title="compass.ocean.tests.global_ocean.mesh.cull.cull_mesh"><code class="xref py py-func docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.cull.cull_mesh()</span></code></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">cull_mesh()</span></code> uses a number of capabilities from
<a class="reference external" href="http://mpas-dev.github.io/MPAS-Tools/stable/">MPAS-Tools</a>
and <a class="reference external" href="http://mpas-dev.github.io/geometric_features/stable/">geometric_features</a>
to cull the mesh.  It performs the following steps:</p>
<ol class="arabic simple">
<li><p>combining Natural Earth land coverage north of 60S with Antarctic
ice coverage or grounded ice coverage from BedMachineAntarctica</p></li>
<li><p>combining transects defining critical passages (if
<code class="docutils literal notranslate"><span class="pre">with_critical_passages=True</span></code>)</p></li>
<li><p>combining points used to seed a flood fill of the global ocean.</p></li>
<li><p>create masks from land coverage</p></li>
<li><p>add land-locked cells to land coverage mask.</p></li>
<li><p>create masks from transects (if <code class="docutils literal notranslate"><span class="pre">with_critical_passages=True</span></code>)</p></li>
<li><p>cull cells based on land coverage but with transects present</p></li>
<li><p>create flood-fill mask based on seeds</p></li>
<li><p>cull cells based on flood-fill mask</p></li>
<li><p>create masks from transects on the final culled mesh (if
<code class="docutils literal notranslate"><span class="pre">with_critical_passages=True</span></code>)</p></li>
</ol>
</section>
<section id="meshes">
<span id="dev-ocean-global-ocean-meshes"></span><h4>meshes<a class="headerlink" href="#meshes" title="Permalink to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">global_ocean</span></code> currently defines 5 meshes, with more to come.</p>
<section id="qu240-and-quwisc240">
<span id="dev-ocean-global-ocean-qu240"></span><h5>QU240 and QUwISC240<a class="headerlink" href="#qu240-and-quwisc240" title="Permalink to this heading">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">QU240</span></code> mesh is a quasi-uniform mesh with 240-km resolution. The
<code class="docutils literal notranslate"><span class="pre">QUwISC240</span></code> mesh is identical except that it includes the cavities below ice
shelves in the ocean domain. The class
<a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.mesh.qu240.QU240Mesh.html#compass.ocean.tests.global_ocean.mesh.qu240.QU240Mesh" title="compass.ocean.tests.global_ocean.mesh.qu240.QU240Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.qu240.QU240Mesh</span></code></a> defines the
resolution for both meshes. The <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.qu240</span></code>
module includes namelist options appropriate for forward simulations with both
RK4 and split-explicit time integration on this mesh.  These set the time step
and default run duration for short runs with this mesh.</p>
<p>The default config options for this mesh are:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># Options related to the vertical grid</span><span class="w"></span>
<span class="k">[vertical_grid]</span><span class="w"></span>

<span class="c1"># the type of vertical grid</span><span class="w"></span>
<span class="na">grid_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">tanh_dz</span><span class="w"></span>

<span class="c1"># Number of vertical levels</span><span class="w"></span>
<span class="na">vert_levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">16</span><span class="w"></span>

<span class="c1"># Depth of the bottom of the ocean</span><span class="w"></span>
<span class="na">bottom_depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3000.0</span><span class="w"></span>

<span class="c1"># The minimum layer thickness</span><span class="w"></span>
<span class="na">min_layer_thickness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3.0</span><span class="w"></span>

<span class="c1"># The maximum layer thickness</span><span class="w"></span>
<span class="na">max_layer_thickness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">500.0</span><span class="w"></span>


<span class="c1"># options for global ocean testcases</span><span class="w"></span>
<span class="k">[global_ocean]</span><span class="w"></span>

<span class="c1">## config options related to the initial_state step</span><span class="w"></span>
<span class="c1"># number of cores to use</span><span class="w"></span>
<span class="na">init_cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">4</span><span class="w"></span>
<span class="c1"># minimum of cores, below which the step fails</span><span class="w"></span>
<span class="na">init_min_cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span><span class="w"></span>
<span class="c1"># maximum memory usage allowed (in MB)</span><span class="w"></span>
<span class="na">init_max_memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"></span>
<span class="c1"># maximum disk usage allowed (in MB)</span><span class="w"></span>
<span class="na">init_max_disk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"></span>

<span class="c1">## config options related to the forward steps</span><span class="w"></span>
<span class="c1"># number of cores to use</span><span class="w"></span>
<span class="na">forward_cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">4</span><span class="w"></span>
<span class="c1"># minimum of cores, below which the step fails</span><span class="w"></span>
<span class="na">forward_min_cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span><span class="w"></span>
<span class="c1"># maximum memory usage allowed (in MB)</span><span class="w"></span>
<span class="na">forward_max_memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"></span>
<span class="c1"># maximum disk usage allowed (in MB)</span><span class="w"></span>
<span class="na">forward_max_disk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"></span>

<span class="c1">## metadata related to the mesh</span><span class="w"></span>
<span class="c1"># the prefix (e.g. QU, EC, WC, SO)</span><span class="w"></span>
<span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">QU</span><span class="w"></span>
<span class="c1"># a description of the mesh</span><span class="w"></span>
<span class="na">mesh_description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">MPAS quasi-uniform mesh for E3SM version ${e3sm_version} at</span><span class="w"></span>
<span class="w">                   </span><span class="na">${min_res}-km global resolution with ${levels} vertical</span><span class="w"></span>
<span class="w">                   </span><span class="na">level</span><span class="w"></span>

<span class="c1"># E3SM version that the mesh is intended for</span><span class="w"></span>
<span class="na">e3sm_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2</span><span class="w"></span>
<span class="c1"># The revision number of the mesh, which should be incremented each time the</span><span class="w"></span>
<span class="c1"># mesh is revised</span><span class="w"></span>
<span class="na">mesh_revision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span><span class="w"></span>
<span class="c1"># the minimum (finest) resolution in the mesh</span><span class="w"></span>
<span class="na">min_res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">240</span><span class="w"></span>
<span class="c1"># the maximum (coarsest) resolution in the mesh, can be the same as min_res</span><span class="w"></span>
<span class="na">max_res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">240</span><span class="w"></span>
<span class="c1"># The URL of the pull request documenting the creation of the mesh</span><span class="w"></span>
<span class="na">pull_request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>The vertical grid is a <code class="docutils literal notranslate"><span class="pre">tanh_dz</span></code> profile (see <a class="reference internal" href="../framework.html#dev-ocean-framework-vertical"><span class="std std-ref">Vertical coordinate</span></a>)
with 16 vertical levels ranging in thickness from 3 to 500 m.</p>
</section>
<section id="ec30to60-and-ecwisc30to60">
<span id="dev-ocean-global-ocean-ec30to60"></span><h5>EC30to60 and ECwISC30to60<a class="headerlink" href="#ec30to60-and-ecwisc30to60" title="Permalink to this heading">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">EC30to60</span></code> mesh is an “eddy-closure” mesh with 30-km resolution at the
equator, 60-km resolution at mid latitudes, and 35-km resolution at the poles.
The mesh resolution is purely a function of latitude. The <code class="docutils literal notranslate"><span class="pre">ECwISC30to60</span></code> mesh
is identical except that it includes the cavities below ice shelves in the
ocean domain.</p>
<p>The class
<a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.mesh.ec30to60.EC30to60Mesh.html#compass.ocean.tests.global_ocean.mesh.ec30to60.EC30to60Mesh" title="compass.ocean.tests.global_ocean.mesh.ec30to60.EC30to60Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.ec30to60.EC30to60Mesh</span></code></a> defines
the resolution for both meshes. The <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.ec30to60</span></code>
module includes  namelist options appropriate for forward simulations with
split-explicit (but not RK4) time integration on this mesh.  These set the time
step and default run duration for short runs with this mesh.</p>
<p>The default config options for this mesh are:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># Options related to the vertical grid</span><span class="w"></span>
<span class="k">[vertical_grid]</span><span class="w"></span>

<span class="c1"># the type of vertical grid</span><span class="w"></span>
<span class="na">grid_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">60layerPHC</span><span class="w"></span>


<span class="c1"># options for global ocean testcases</span><span class="w"></span>
<span class="k">[global_ocean]</span><span class="w"></span>

<span class="c1">## config options related to the initial_state step</span><span class="w"></span>
<span class="c1"># number of cores to use</span><span class="w"></span>
<span class="na">init_cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">36</span><span class="w"></span>
<span class="c1"># minimum of cores, below which the step fails</span><span class="w"></span>
<span class="na">init_min_cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">8</span><span class="w"></span>
<span class="c1"># maximum memory usage allowed (in MB)</span><span class="w"></span>
<span class="na">init_max_memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"></span>
<span class="c1"># maximum disk usage allowed (in MB)</span><span class="w"></span>
<span class="na">init_max_disk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"></span>

<span class="c1">## config options related to the forward steps</span><span class="w"></span>
<span class="c1"># number of cores to use</span><span class="w"></span>
<span class="na">forward_cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">128</span><span class="w"></span>
<span class="c1"># minimum of cores, below which the step fails</span><span class="w"></span>
<span class="na">forward_min_cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">36</span><span class="w"></span>
<span class="c1"># maximum memory usage allowed (in MB)</span><span class="w"></span>
<span class="na">forward_max_memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"></span>
<span class="c1"># maximum disk usage allowed (in MB)</span><span class="w"></span>
<span class="na">forward_max_disk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"></span>

<span class="c1">## metadata related to the mesh</span><span class="w"></span>
<span class="c1"># the prefix (e.g. QU, EC, WC, SO)</span><span class="w"></span>
<span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">EC</span><span class="w"></span>
<span class="c1"># a description of the mesh and initial condition</span><span class="w"></span>
<span class="na">mesh_description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">MPAS Eddy Closure mesh for E3SM version ${e3sm_version} with</span><span class="w"></span>
<span class="w">                   </span><span class="na">enhanced resolution around the equator (30 km), South pole</span><span class="w"></span>
<span class="w">                   </span><span class="na">(35 km), Greenland (${min_res} km), ${max_res}-km resolution</span><span class="w"></span>
<span class="w">                   </span><span class="na">at mid latitudes, and ${levels} vertical levels</span><span class="w"></span>
<span class="c1"># E3SM version that the mesh is intended for</span><span class="w"></span>
<span class="na">e3sm_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2</span><span class="w"></span>
<span class="c1"># The revision number of the mesh, which should be incremented each time the</span><span class="w"></span>
<span class="c1"># mesh is revised</span><span class="w"></span>
<span class="na">mesh_revision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3</span><span class="w"></span>
<span class="c1"># the minimum (finest) resolution in the mesh</span><span class="w"></span>
<span class="na">min_res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">30</span><span class="w"></span>
<span class="c1"># the maximum (coarsest) resolution in the mesh, can be the same as min_res</span><span class="w"></span>
<span class="na">max_res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">60</span><span class="w"></span>
<span class="c1"># The URL of the pull request documenting the creation of the mesh</span><span class="w"></span>
<span class="na">pull_request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>The vertical grid is a <code class="docutils literal notranslate"><span class="pre">60layerPHC</span></code> profile (see <a class="reference internal" href="../framework.html#dev-ocean-framework-vertical"><span class="std std-ref">Vertical coordinate</span></a>)
with 60 vertical levels ranging in thickness from 10 to 250 m.</p>
</section>
<section id="sowisc12to60">
<span id="dev-ocean-global-ocean-sowisc12to60"></span><h5>SOwISC12to60<a class="headerlink" href="#sowisc12to60" title="Permalink to this heading">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">SOwISC12to60</span></code> mesh is a Southern Ocean regionally refined mesh with
12-km resolution around the Southern Ocean and Antarctica, 45-km at southern
mid-latitudes, 30-km at the equator and in the North Atlantic, 60-km resolution
in the North Pacific, and 35-km resolution in the Arctic.</p>
<p>The class
<a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.mesh.so12to60.SO12to60Mesh.html#compass.ocean.tests.global_ocean.mesh.so12to60.SO12to60Mesh" title="compass.ocean.tests.global_ocean.mesh.so12to60.SO12to60Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.so12to60.SO12to60Mesh</span></code></a> defines
the resolution for the mesh. The <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.so12to60</span></code>
module includes namelist options appropriate for forward simulations with
split-explicit (but not RK4) time integration on this mesh.  These set the time
step and default run duration for short runs with this mesh.</p>
<p>The default config options for this mesh are:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># Options related to the vertical grid</span><span class="w"></span>
<span class="k">[vertical_grid]</span><span class="w"></span>

<span class="c1"># the type of vertical grid</span><span class="w"></span>
<span class="na">grid_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">60layerPHC</span><span class="w"></span>


<span class="c1"># options for global ocean testcases</span><span class="w"></span>
<span class="k">[global_ocean]</span><span class="w"></span>

<span class="c1">## config options related to the initial_state step</span><span class="w"></span>
<span class="c1"># number of cores to use</span><span class="w"></span>
<span class="na">init_cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">36</span><span class="w"></span>
<span class="c1"># minimum of cores, below which the step fails</span><span class="w"></span>
<span class="na">init_min_cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">8</span><span class="w"></span>
<span class="c1"># maximum memory usage allowed (in MB)</span><span class="w"></span>
<span class="na">init_max_memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"></span>
<span class="c1"># maximum disk usage allowed (in MB)</span><span class="w"></span>
<span class="na">init_max_disk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"></span>

<span class="c1">## config options related to the forward steps</span><span class="w"></span>
<span class="c1"># number of cores to use</span><span class="w"></span>
<span class="na">forward_cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1296</span><span class="w"></span>
<span class="c1"># minimum of cores, below which the step fails</span><span class="w"></span>
<span class="na">forward_min_cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">128</span><span class="w"></span>
<span class="c1"># maximum memory usage allowed (in MB)</span><span class="w"></span>
<span class="na">forward_max_memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"></span>
<span class="c1"># maximum disk usage allowed (in MB)</span><span class="w"></span>
<span class="na">forward_max_disk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"></span>

<span class="c1">## metadata related to the mesh</span><span class="w"></span>
<span class="c1"># the prefix (e.g. QU, EC, WC, SO)</span><span class="w"></span>
<span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">SO</span><span class="w"></span>
<span class="c1"># a description of the mesh and initial condition</span><span class="w"></span>
<span class="na">mesh_description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">MPAS Southern Ocean regionally refined mesh for E3SM version</span><span class="w"></span>
<span class="w">                   </span><span class="na">${e3sm_version} with enhanced resolution (${min_res} km) around</span><span class="w"></span>
<span class="w">                   </span><span class="na">Antarctica, 45-km resolution in the mid southern latitudes,</span><span class="w"></span>
<span class="w">                   </span><span class="na">30-km resolution in a 15-degree band around the equator, 60-km</span><span class="w"></span>
<span class="w">                   </span><span class="na">resolution in northern mid latitudes, 30 km in the north</span><span class="w"></span>
<span class="w">                   </span><span class="na">Atlantic and 35 km in the Arctic.  This mesh has ${levels}</span><span class="w"></span>
<span class="w">                   </span><span class="na">vertical levels and includes cavities under the ice shelves</span><span class="w"></span>
<span class="w">                   </span><span class="na">around Antarctica.</span><span class="w"></span>
<span class="c1"># E3SM version that the mesh is intended for</span><span class="w"></span>
<span class="na">e3sm_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2</span><span class="w"></span>
<span class="c1"># The revision number of the mesh, which should be incremented each time the</span><span class="w"></span>
<span class="c1"># mesh is revised</span><span class="w"></span>
<span class="na">mesh_revision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">4</span><span class="w"></span>
<span class="c1"># the minimum (finest) resolution in the mesh</span><span class="w"></span>
<span class="na">min_res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">12</span><span class="w"></span>
<span class="c1"># the maximum (coarsest) resolution in the mesh, can be the same as min_res</span><span class="w"></span>
<span class="na">max_res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">60</span><span class="w"></span>
<span class="c1"># The URL of the pull request documenting the creation of the mesh</span><span class="w"></span>
<span class="na">pull_request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">https://github.com/MPAS-Dev/compass/pull/37</span><span class="w"></span>
</pre></div>
</div>
<p>The vertical grid is a <code class="docutils literal notranslate"><span class="pre">60layerPHC</span></code> profile (see <a class="reference internal" href="../framework.html#dev-ocean-framework-vertical"><span class="std std-ref">Vertical coordinate</span></a>)
with 60 vertical levels ranging in thickness from 10 to 250 m.</p>
</section>
<section id="wc14">
<span id="dev-ocean-global-ocean-wc14"></span><h5>WC14<a class="headerlink" href="#wc14" title="Permalink to this heading">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">WC14</span></code> mesh is the Water Cycle regionally refined mesh for E3SM v2.  It
has higher resolution (~14-km) around the continental US, the Arctic Ocean,
and a section of the North Atlantic containing the Gulf Stream. The resolution
elsewhere varies between 35 km at the South Pole to 60 km at mid latitudes,
with a band of 30-km resolution around the equator.</p>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.mesh.wc14.WC14Mesh.html#compass.ocean.tests.global_ocean.mesh.wc14.WC14Mesh" title="compass.ocean.tests.global_ocean.mesh.wc14.WC14Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.wc14.WC14Mesh</span></code></a>
defines the resolution for the mesh. The
<code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.wc14</span></code> module includes namelist options
appropriate for forward simulations with split-explicit (but not RK4) time
integration on this mesh.  These set the time step and default run duration for
short runs with this mesh.</p>
<p>The default config options for this mesh are:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># Options related to the vertical grid</span><span class="w"></span>
<span class="k">[vertical_grid]</span><span class="w"></span>

<span class="c1"># the type of vertical grid</span><span class="w"></span>
<span class="na">grid_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">60layerPHC</span><span class="w"></span>


<span class="c1"># options for global ocean testcases</span><span class="w"></span>
<span class="k">[global_ocean]</span><span class="w"></span>

<span class="c1">## config options related to the initial_state step</span><span class="w"></span>
<span class="c1"># number of cores to use</span><span class="w"></span>
<span class="na">init_cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">36</span><span class="w"></span>
<span class="c1"># minimum of cores, below which the step fails</span><span class="w"></span>
<span class="na">init_min_cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">8</span><span class="w"></span>
<span class="c1"># maximum memory usage allowed (in MB)</span><span class="w"></span>
<span class="na">init_max_memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"></span>
<span class="c1"># maximum disk usage allowed (in MB)</span><span class="w"></span>
<span class="na">init_max_disk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"></span>

<span class="c1">## config options related to the forward steps</span><span class="w"></span>
<span class="c1"># number of cores to use</span><span class="w"></span>
<span class="na">forward_cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">720</span><span class="w"></span>
<span class="c1"># minimum of cores, below which the step fails</span><span class="w"></span>
<span class="na">forward_min_cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">144</span><span class="w"></span>
<span class="c1"># maximum memory usage allowed (in MB)</span><span class="w"></span>
<span class="na">forward_max_memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"></span>
<span class="c1"># maximum disk usage allowed (in MB)</span><span class="w"></span>
<span class="na">forward_max_disk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"></span>

<span class="c1">## metadata related to the mesh</span><span class="w"></span>
<span class="c1"># the prefix (e.g. QU, EC, WC, SO)</span><span class="w"></span>
<span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">WC</span><span class="w"></span>
<span class="c1"># a description of the mesh and initial condition</span><span class="w"></span>
<span class="na">mesh_description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">MPAS North America and Arctic Focused Water Cycle mesh for E3SM version</span><span class="w"></span>
<span class="w">                   </span><span class="na">${e3sm_version}, with a focused ${min_res}-km resolution</span><span class="w"></span>
<span class="w">                   </span><span class="na">around North America and ${levels} vertical levels</span><span class="w"></span>

<span class="c1"># E3SM version that the mesh is intended for</span><span class="w"></span>
<span class="na">e3sm_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2</span><span class="w"></span>
<span class="c1"># The revision number of the mesh, which should be incremented each time the</span><span class="w"></span>
<span class="c1"># mesh is revised</span><span class="w"></span>
<span class="na">mesh_revision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3</span><span class="w"></span>
<span class="c1"># the minimum (finest) resolution in the mesh</span><span class="w"></span>
<span class="na">min_res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">14</span><span class="w"></span>
<span class="c1"># the maximum (coarsest) resolution in the mesh, can be the same as min_res</span><span class="w"></span>
<span class="na">max_res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">60</span><span class="w"></span>
<span class="c1"># The URL of the pull request documenting the creation of the mesh</span><span class="w"></span>
<span class="na">pull_request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">https://github.com/MPAS-Dev/MPAS-Model/pull/628</span><span class="w"></span>
</pre></div>
</div>
<p>The vertical grid is a <code class="docutils literal notranslate"><span class="pre">60layerPHC</span></code> profile (see <a class="reference internal" href="../framework.html#dev-ocean-framework-vertical"><span class="std std-ref">Vertical coordinate</span></a>)
with 60 vertical levels ranging in thickness from 10 to 250 m.</p>
</section>
</section>
</section>
<section id="init-test-case">
<span id="dev-ocean-global-ocean-init"></span><h3>init test case<a class="headerlink" href="#init-test-case" title="Permalink to this heading">¶</a></h3>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.init.Init.html#compass.ocean.tests.global_ocean.init.Init" title="compass.ocean.tests.global_ocean.init.Init"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.init.Init</span></code></a> defines a test
case for creating a global initial condition using MPAS-Ocean’s init mode.
Currently there are two choices for the potential temperature and salinity
fields used for initialization: the Polar science center Hydrographic Climatology
(<a class="reference external" href="http://psc.apl.washington.edu/nonwp_projects/PHC/Climatology.html">PHC</a>)
or the UK MetOffice’s EN4 estimated climatology for the year 1900
(<a class="reference external" href="https://www.metoffice.gov.uk/hadobs/en4/download-en4-2-0.html">EN4_1900</a>).</p>
<p>The test case includes 5 namelist replacement files and 3 streams files.
<code class="docutils literal notranslate"><span class="pre">namelist.init</span></code> and <code class="docutils literal notranslate"><span class="pre">streams.init</span></code> modify the namelist options and set up
the streams needed for the test case, regardless of the particular
test group.  <code class="docutils literal notranslate"><span class="pre">namelist.phc</span></code> and <code class="docutils literal notranslate"><span class="pre">namelist.en4_1900</span></code> set namelist options
specific to those two sets of input files.  <code class="docutils literal notranslate"><span class="pre">namelist.wisc</span></code> and
<code class="docutils literal notranslate"><span class="pre">streams.wisc</span></code> configure the test case for meshes that include
<a class="reference internal" href="../../../users_guide/ocean/test_groups/global_ocean.html#global-ocean-ice-shelf-cavities"><span class="std std-ref">Ice-shelf cavities</span></a>, while <code class="docutils literal notranslate"><span class="pre">namelist.bgc</span></code> and
<code class="docutils literal notranslate"><span class="pre">streams.bgc</span></code> are used to configure the test case when
<a class="reference internal" href="../../../users_guide/ocean/test_groups/global_ocean.html#global-ocean-bgc"><span class="std std-ref">Biogeochemsitry</span></a> is included.</p>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.init.initial_state.InitialState.html#compass.ocean.tests.global_ocean.init.initial_state.InitialState" title="compass.ocean.tests.global_ocean.init.initial_state.InitialState"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.init.initial_state.InitialState</span></code></a>
defines the step for creating the initial state, including defining the
topography, wind stress, shortwave, potential temperature, salinity, and
ecosystem input data files.</p>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.init.ssh_adjustment.SshAdjustment.html#compass.ocean.tests.global_ocean.init.ssh_adjustment.SshAdjustment" title="compass.ocean.tests.global_ocean.init.ssh_adjustment.SshAdjustment"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.init.ssh_adjustment.SshAdjustment</span></code></a>
defines a step to adjust the <code class="docutils literal notranslate"><span class="pre">landIcePressure</span></code> variable to be in closer to
dynamical balance with the sea-surface height (SSH) in configurations with
<a class="reference internal" href="../framework.html#dev-ocean-framework-iceshelf"><span class="std std-ref">Ice-shelf cavities</span></a>.</p>
<p>If the test case is being compared with a baseline, the potential temperature,
salinity, and layerThickness are compared with those in the baseline initial
condition to make sure they are identical.  In runs with BGC, a large number
of ecosystem tracers are compared, and in simulations with ice-shelf cavities,
the SSH and land-ice pressure are compared against the baseline.</p>
</section>
<section id="performance-test-test-case">
<span id="dev-ocean-global-ocean-performance-test"></span><h3>performance_test test case<a class="headerlink" href="#performance-test-test-case" title="Permalink to this heading">¶</a></h3>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.performance_test.PerformanceTest.html#compass.ocean.tests.global_ocean.performance_test.PerformanceTest" title="compass.ocean.tests.global_ocean.performance_test.PerformanceTest"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.performance_test.PerformanceTest</span></code></a>
defines a test case for performing a short MPAS-Ocean simulation as a “smoke
test” to make sure nothing is clearly wrong with the configuration.</p>
<p>The module includes <code class="docutils literal notranslate"><span class="pre">namelist.wisc</span></code> and <code class="docutils literal notranslate"><span class="pre">streams.wisc</span></code>, which enable melt
fluxes below ice shelves and write out related fields if the mesh includes
<a class="reference internal" href="../framework.html#dev-ocean-framework-iceshelf"><span class="std std-ref">Ice-shelf cavities</span></a>.</p>
<p>If a baseline is provided, prognostic variables as well as ecosystem tracers
(if BGC is active) and ice-shelf melt fluxes (if ice-shelf cavities are
included in the mesh) are compared with a baseline, and the
<code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">integration</span></code> timer is compared with that of the baseline.</p>
</section>
<section id="restart-test-test-case">
<span id="dev-ocean-global-ocean-restart-test"></span><h3>restart_test test case<a class="headerlink" href="#restart-test-test-case" title="Permalink to this heading">¶</a></h3>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.restart_test.RestartTest.html#compass.ocean.tests.global_ocean.restart_test.RestartTest" title="compass.ocean.tests.global_ocean.restart_test.RestartTest"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.restart_test.RestartTest</span></code></a>
defines a test case for comparing a <code class="docutils literal notranslate"><span class="pre">full_run</span></code> of a longer duration with a
<code class="docutils literal notranslate"><span class="pre">restart_run</span></code> that is made up of two segments if half the duration with a
restart in between. The length of the full and restart runs depends on the time
integrator.  For the <code class="docutils literal notranslate"><span class="pre">split-explicit</span></code> integrator, an 8-hour full run is
compared with two 4-hour segments in the restart run.  For the <code class="docutils literal notranslate"><span class="pre">RK4</span></code>
integrator, the full run is 20 minutes long, while the restart segments are
each 10 minutes.  The test case ensures that the main prognostic
variables—<code class="docutils literal notranslate"><span class="pre">temperature</span></code>, <code class="docutils literal notranslate"><span class="pre">salinity</span></code>, <code class="docutils literal notranslate"><span class="pre">layerThickness</span></code> and
<code class="docutils literal notranslate"><span class="pre">normalVelocity</span></code>—are identical at the end of the two runs (as well as with
a baseline if one is provided when calling <a class="reference internal" href="../../command_line.html#dev-compass-setup"><span class="std std-ref">compass setup</span></a>).</p>
<p>The various steps and time integrators are configured with
<code class="docutils literal notranslate"><span class="pre">namelist.&lt;time_integrator&gt;.&lt;step&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">streams.&lt;time_integrator&gt;.&lt;step&gt;</span></code>
namelist replacements and streams files.</p>
</section>
<section id="decomp-test-test-case">
<span id="dev-ocean-global-ocean-decomp-test"></span><h3>decomp_test test case<a class="headerlink" href="#decomp-test-test-case" title="Permalink to this heading">¶</a></h3>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.decomp_test.DecompTest.html#compass.ocean.tests.global_ocean.decomp_test.DecompTest" title="compass.ocean.tests.global_ocean.decomp_test.DecompTest"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.decomp_test.DecompTest</span></code></a>
defines a test case that performs a short run once on 4 cores and once on 8
cores.  It ensures that <code class="docutils literal notranslate"><span class="pre">temperature</span></code>, <code class="docutils literal notranslate"><span class="pre">salinity</span></code>, <code class="docutils literal notranslate"><span class="pre">layerThickness</span></code> and
<code class="docutils literal notranslate"><span class="pre">normalVelocity</span></code> are identical at the end of the two runs (as well as with a
baseline if one is provided when calling <a class="reference internal" href="../../command_line.html#dev-compass-setup"><span class="std std-ref">compass setup</span></a>).</p>
<p>The duration of the run depends on the mesh and time integrator.  For the
<a class="reference internal" href="#dev-ocean-global-ocean-qu240"><span class="std std-ref">QU240 and QUwISC240</span></a> meshes (the only meshes that this test case
is currently being generated for), the duration is 6 hours for the
<code class="docutils literal notranslate"><span class="pre">split-explicit</span></code> integrator and 10 minutes for <code class="docutils literal notranslate"><span class="pre">RK4</span></code>.</p>
</section>
<section id="threads-test-test-case">
<span id="dev-ocean-global-ocean-threads-test"></span><h3>threads_test test case<a class="headerlink" href="#threads-test-test-case" title="Permalink to this heading">¶</a></h3>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.threads_test.ThreadsTest.html#compass.ocean.tests.global_ocean.threads_test.ThreadsTest" title="compass.ocean.tests.global_ocean.threads_test.ThreadsTest"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.threads_test.ThreadsTest</span></code></a>
defines a test case that performs a short run once on 4 cores, each with 1
thread and once on 4 cores, each with 2 threads.  It ensures that
<code class="docutils literal notranslate"><span class="pre">temperature</span></code>, <code class="docutils literal notranslate"><span class="pre">salinity</span></code>, <code class="docutils literal notranslate"><span class="pre">layerThickness</span></code> and <code class="docutils literal notranslate"><span class="pre">normalVelocity</span></code> are
identical at the end of the two runs (as well as with a baseline if one is
provided when calling <a class="reference internal" href="../../command_line.html#dev-compass-setup"><span class="std std-ref">compass setup</span></a>).</p>
<p>The duration of the run depends on the mesh and time integrator.  For the
<a class="reference internal" href="#dev-ocean-global-ocean-qu240"><span class="std std-ref">QU240 and QUwISC240</span></a> meshes (the only meshes that this test case
is currently being generated for), the duration is 6 hours for the
<code class="docutils literal notranslate"><span class="pre">split-explicit</span></code> integrator and 10 minutes for <code class="docutils literal notranslate"><span class="pre">RK4</span></code>.</p>
</section>
<section id="analysis-test-test-case">
<span id="dev-ocean-global-ocean-analysis-test"></span><h3>analysis_test test case<a class="headerlink" href="#analysis-test-test-case" title="Permalink to this heading">¶</a></h3>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.analysis_test.AnalysisTest.html#compass.ocean.tests.global_ocean.analysis_test.AnalysisTest" title="compass.ocean.tests.global_ocean.analysis_test.AnalysisTest"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.analysis_test.AnalysisTest</span></code></a>
defines a test case that performs a short run with 14 analysis members (see
<a class="reference internal" href="../../../users_guide/ocean/test_groups/global_ocean.html#global-ocean-analysis-test"><span class="std std-ref">analysis_test test case</span></a> in the User’s Guide). The <code class="docutils literal notranslate"><span class="pre">namelist.forward</span></code>
and <code class="docutils literal notranslate"><span class="pre">streams.forward</span></code> files ensure that the analysis members are enabled and
that the appropriate output is written out.  The test ensures that the
prognostic variables as well as a few variables from each analysis member are
identical to those from the baseline if one is provided when calling
<a class="reference internal" href="../../command_line.html#dev-compass-setup"><span class="std std-ref">compass setup</span></a>.</p>
<p>The duration of the run depends on the mesh and time integrator.  For the
<a class="reference internal" href="#dev-ocean-global-ocean-qu240"><span class="std std-ref">QU240 and QUwISC240</span></a> meshes (the only meshes that this test case
is currently being generated for), the duration is 6 hours for the
<code class="docutils literal notranslate"><span class="pre">split-explicit</span></code> integrator and 10 minutes for <code class="docutils literal notranslate"><span class="pre">RK4</span></code>.</p>
</section>
<section id="daily-output-test-test-case">
<span id="dev-ocean-global-ocean-daily-output-test"></span><h3>daily_output_test test case<a class="headerlink" href="#daily-output-test-test-case" title="Permalink to this heading">¶</a></h3>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.daily_output_test.DailyOutputTest.html#compass.ocean.tests.global_ocean.daily_output_test.DailyOutputTest" title="compass.ocean.tests.global_ocean.daily_output_test.DailyOutputTest"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.daily_output_test.DailyOutputTest</span></code></a>
defines a test case that performs a 1-day run with the <code class="docutils literal notranslate"><span class="pre">timeSeriesStatsDaily</span></code>
analysis members (see <a class="reference internal" href="../../../users_guide/ocean/test_groups/global_ocean.html#global-ocean-daily-output-test"><span class="std std-ref">daily_output_test test case</span></a> in the User’s
Guide). The <code class="docutils literal notranslate"><span class="pre">namelist.forward</span></code> and <code class="docutils literal notranslate"><span class="pre">streams.forward</span></code> files ensure that the
analysis member are enabled and that the appropriate output (the E3SM defaults
for the <code class="docutils literal notranslate"><span class="pre">timeSeriesStatsMonthly</span></code> analysis member) is written out.  The test
ensures that the time average of the prognostic variables as well as the
sea-surface height are identical to those from the baseline if one is provided
when calling <a class="reference internal" href="../../command_line.html#dev-compass-setup"><span class="std std-ref">compass setup</span></a>.</p>
</section>
<section id="dynamic-adjustment-test-case">
<span id="dev-ocean-global-ocean-dynamic-adjustment"></span><h3>dynamic_adjustment test case<a class="headerlink" href="#dynamic-adjustment-test-case" title="Permalink to this heading">¶</a></h3>
<p>The parent class
<a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.dynamic_adjustment.DynamicAdjustment.html#compass.ocean.tests.global_ocean.dynamic_adjustment.DynamicAdjustment" title="compass.ocean.tests.global_ocean.dynamic_adjustment.DynamicAdjustment"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.dynamic_adjustment.DynamicAdjustment</span></code></a>
descends from <a class="reference internal" href="#dev-ocean-global-ocean-forward-test"><span class="std std-ref">forward test case</span></a> and defines a test
case for performing a series of forward model runs in sequence to allow the
ocean model to dynamically adjust to the initial condition.  This process
involves a rapid increase in ocean velocity. the dissipation of fast-moving
waves, and adjustment of the sea-surface height to be in balance with the
dynamic pressure (see <a class="reference internal" href="../../../users_guide/ocean/test_groups/global_ocean.html#global-ocean-dynamic-adjustment"><span class="std std-ref">dynamic_adjustment test case</span></a> in the User’s
Guide). This process typically require smaller times steps and artificial
friction.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">restart_filenames</span></code> attribute keeps track of a sequence of restart files
used in each step of the adjustment process.  The final restart file is used
in the <a class="reference internal" href="#dev-ocean-global-ocean-files-for-e3sm"><span class="std std-ref">files_for_e3sm test case</span></a>.</p>
<p>The test case also takes care of validating the output from the final
<code class="docutils literal notranslate"><span class="pre">simulation</span></code> step, comparing <code class="docutils literal notranslate"><span class="pre">temperature</span></code>, <code class="docutils literal notranslate"><span class="pre">salinity</span></code>,
<code class="docutils literal notranslate"><span class="pre">layerThickness</span></code>, and <code class="docutils literal notranslate"><span class="pre">normalVelocity</span></code> with a baseline if one is provided.</p>
<section id="child-classes">
<h4>child classes<a class="headerlink" href="#child-classes" title="Permalink to this heading">¶</a></h4>
<p>The modules <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.&lt;mesh_name&gt;.dynamic_adjustment</span></code>
define child classes of <code class="docutils literal notranslate"><span class="pre">DynamicAdjustment</span></code>. Each of the
:ref`global_ocean_meshes` has its own adjustment step, since the needs
(duration of each step, amount of damping, time step, etc.) may be different
between meshes.</p>
<p>Each module includes <code class="docutils literal notranslate"><span class="pre">streams.template</span></code>, a Jinja2 template for defining
streams (see <a class="reference internal" href="../../organization.html#dev-step-add-streams-file-template"><span class="std std-ref">Adding a template streams file</span></a>):</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;streams&gt;</span>

<span class="nt">&lt;stream</span> <span class="na">name=</span><span class="s">&quot;output&quot;</span>
        <span class="na">output_interval=</span><span class="s">&quot;{{ output_interval }}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;immutable_stream</span> <span class="na">name=</span><span class="s">&quot;restart&quot;</span>
                  <span class="na">filename_template=</span><span class="s">&quot;../restarts/rst.$Y-$M-$D_$h.$m.$s.nc&quot;</span>
                  <span class="na">output_interval=</span><span class="s">&quot;{{ restart_interval }}&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/streams&gt;</span>
</pre></div>
</div>
</section>
<section id="id1">
<h4>QU240 and QUwISC240<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h4>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.mesh.qu240.dynamic_adjustment.QU240DynamicAdjustment.html#compass.ocean.tests.global_ocean.mesh.qu240.dynamic_adjustment.QU240DynamicAdjustment" title="compass.ocean.tests.global_ocean.mesh.qu240.dynamic_adjustment.QU240DynamicAdjustment"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.qu240.dynamic_adjustment.QU240DynamicAdjustment</span></code></a>
defines a test case for performing dynamical adjustment on the mesh.  In the
<code class="docutils literal notranslate"><span class="pre">damped_adjustment_1</span></code> step, the model is run for 1 day with strong Rayleigh
friction (<code class="docutils literal notranslate"><span class="pre">1e-4</span></code> 1/s) to damp the velocity field.  In the
<code class="docutils literal notranslate"><span class="pre">simulation</span></code> step, the model runs for an additional 1 day without Rayleigh
friction.  The dynamic adjustment test case takes advantage of Jinja templating
for streams files to use the same streams template for each step in the test
case, see <a class="reference internal" href="../../organization.html#dev-step-add-streams-file-template"><span class="std std-ref">Adding a template streams file</span></a>.</p>
</section>
<section id="id2">
<h4>EC30to60 and ECwISC30to60<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h4>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.mesh.ec30to60.dynamic_adjustment.EC30to60DynamicAdjustment.html#compass.ocean.tests.global_ocean.mesh.ec30to60.dynamic_adjustment.EC30to60DynamicAdjustment" title="compass.ocean.tests.global_ocean.mesh.ec30to60.dynamic_adjustment.EC30to60DynamicAdjustment"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.ec30to60.dynamic_adjustment.EC30to60DynamicAdjustment</span></code></a>
defines a test case for performing dynamical adjustment on the mesh.  In the
<code class="docutils literal notranslate"><span class="pre">damped_adjustment_1</span></code> step, the model is run for 10 days with strong Rayleigh
friction (<code class="docutils literal notranslate"><span class="pre">1e-4</span></code> 1/s) to damp the velocity field.  In the
<code class="docutils literal notranslate"><span class="pre">simulation</span></code> step, the model runs for an additional 10 days without Rayleigh
friction.  The dynamic adjustment test case takes advantage of Jinja templating
for streams files to use the same streams template for each step in the test
case, see <a class="reference internal" href="../../organization.html#dev-step-add-streams-file-template"><span class="std std-ref">Adding a template streams file</span></a>.</p>
</section>
<section id="id3">
<h4>SOwISC12to60<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h4>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.mesh.so12to60.dynamic_adjustment.SO12to60DynamicAdjustment.html#compass.ocean.tests.global_ocean.mesh.so12to60.dynamic_adjustment.SO12to60DynamicAdjustment" title="compass.ocean.tests.global_ocean.mesh.so12to60.dynamic_adjustment.SO12to60DynamicAdjustment"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.so12to60.dynamic_adjustment.SO12to60DynamicAdjustment</span></code></a>
defines a test case for performing dynamical adjustment on the mesh.  In the
<code class="docutils literal notranslate"><span class="pre">damped_adjustment_1</span></code> through <code class="docutils literal notranslate"><span class="pre">damped_adjustment_3</span></code> steps, the model is run for
2, 4 and 4 days with gradually weakening Rayleigh friction (<code class="docutils literal notranslate"><span class="pre">1e-4</span></code>, <code class="docutils literal notranslate"><span class="pre">4e-5</span></code>,
and <code class="docutils literal notranslate"><span class="pre">1e-5</span></code> 1/s) to damp the velocity field.  In the <code class="docutils literal notranslate"><span class="pre">simulation</span></code> step, the
model runs for an additional 10 days without Rayleigh friction.  The
dynamic adjustment test case takes advantage of Jinja templating for streams
files to use the same streams template for each step in the test case, see
<a class="reference internal" href="../../organization.html#dev-step-add-streams-file-template"><span class="std std-ref">Adding a template streams file</span></a>.</p>
</section>
<section id="id4">
<h4>WC14<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h4>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.mesh.wc14.dynamic_adjustment.WC14DynamicAdjustment.html#compass.ocean.tests.global_ocean.mesh.wc14.dynamic_adjustment.WC14DynamicAdjustment" title="compass.ocean.tests.global_ocean.mesh.wc14.dynamic_adjustment.WC14DynamicAdjustment"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.wc14.dynamic_adjustment.WC14DynamicAdjustment</span></code></a>
defines a test case for performing dynamical adjustment on the mesh.  In the
<code class="docutils literal notranslate"><span class="pre">damped_adjustment_1</span></code> through <code class="docutils literal notranslate"><span class="pre">damped_adjustment_6</span></code> steps, the model is run
for durations ranging from 6 hours to 3 days with gradually increasing time
step and gradually weakening Rayleigh friction (from <code class="docutils literal notranslate"><span class="pre">1e-3</span></code> 1/s to <code class="docutils literal notranslate"><span class="pre">0</span></code>) to
damp the velocity field.  In the <code class="docutils literal notranslate"><span class="pre">simulation</span></code> step, the model runs for an
additional 24 days without Rayleigh friction.  The dynamic adjustment test case
takes advantage of Jinja templating for streams files to use the same streams
template for each step in the test case, see
<a class="reference internal" href="../../organization.html#dev-step-add-streams-file-template"><span class="std std-ref">Adding a template streams file</span></a>.</p>
</section>
</section>
<section id="files-for-e3sm-test-case">
<span id="dev-ocean-global-ocean-files-for-e3sm"></span><h3>files_for_e3sm test case<a class="headerlink" href="#files-for-e3sm-test-case" title="Permalink to this heading">¶</a></h3>
<p>After running a <a class="reference internal" href="#dev-ocean-global-ocean-dynamic-adjustment"><span class="std std-ref">dynamic_adjustment test case</span></a>, files can be
prepared for use as E3SM ocean and sea-ice initial conditions using the test
case defined in
<a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.files_for_e3sm.FilesForE3SM.html#compass.ocean.tests.global_ocean.files_for_e3sm.FilesForE3SM" title="compass.ocean.tests.global_ocean.files_for_e3sm.FilesForE3SM"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.files_for_e3sm.FilesForE3SM</span></code></a>.
Output files from the test case are symlinked in a directory within the test
case called <code class="docutils literal notranslate"><span class="pre">assembled_files</span></code>. See <a class="reference internal" href="../../../users_guide/ocean/test_groups/global_ocean.html#global-ocean-files-for-e3sm"><span class="std std-ref">files_for_e3sm test case</span></a> in the
User’s Guide for more details.  Output file names involve the “mesh short
name”, see <a class="reference internal" href="#dev-ocean-global-ocean-metadata"><span class="std std-ref">metadata</span></a>.</p>
<p>The test case is constructed with an argument <code class="docutils literal notranslate"><span class="pre">restart_filename</span></code>. the final
restart file produced by the <a class="reference internal" href="#dev-ocean-global-ocean-dynamic-adjustment"><span class="std std-ref">dynamic_adjustment test case</span></a>
for the given mesh.</p>
<p>The test case is made up of 5 steps:</p>
<dl>
<dt><a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.files_for_e3sm.ocean_initial_condition.OceanInitialCondition.html#compass.ocean.tests.global_ocean.files_for_e3sm.ocean_initial_condition.OceanInitialCondition" title="compass.ocean.tests.global_ocean.files_for_e3sm.ocean_initial_condition.OceanInitialCondition"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.files_for_e3sm.ocean_initial_condition.OceanInitialCondition</span></code></a></dt><dd><p>takes out the <code class="docutils literal notranslate"><span class="pre">xtime</span></code> variable from the restart file, creating a symlink
at <code class="docutils literal notranslate"><span class="pre">assembled_files/inputdata/ocn/mpas-o/&lt;mesh_short_name&gt;/&lt;mesh_short_name&gt;_no_xtime.nc</span></code></p>
</dd>
<dt><a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.files_for_e3sm.ocean_graph_partition.OceanGraphPartition.html#compass.ocean.tests.global_ocean.files_for_e3sm.ocean_graph_partition.OceanGraphPartition" title="compass.ocean.tests.global_ocean.files_for_e3sm.ocean_graph_partition.OceanGraphPartition"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.files_for_e3sm.ocean_graph_partition.OceanGraphPartition</span></code></a></dt><dd><p>computes graph partitions (see <a class="reference internal" href="../../framework.html#dev-model"><span class="std std-ref">Model</span></a>) appropriate for a wide
range of core counts between <code class="docutils literal notranslate"><span class="pre">min_graph_size</span> <span class="pre">=</span> <span class="pre">int(nCells</span> <span class="pre">/</span> <span class="pre">6000)</span></code> and
<code class="docutils literal notranslate"><span class="pre">max_graph_size</span> <span class="pre">=</span> <span class="pre">int(nCells</span> <span class="pre">/</span> <span class="pre">100)</span></code>.  Possible processor counts are
any power of 2 or any multiple of 12, 120 and 1200 in the range.  Symlinks
to the graph files are placed at
<code class="docutils literal notranslate"><span class="pre">assembled_files/inputdata/ocn/mpas-o/&lt;mesh_short_name&gt;/mpas-o.graph.info.&lt;core_count&gt;</span></code></p>
</dd>
<dt><a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.files_for_e3sm.seaice_initial_condition.SeaiceInitialCondition.html#compass.ocean.tests.global_ocean.files_for_e3sm.seaice_initial_condition.SeaiceInitialCondition" title="compass.ocean.tests.global_ocean.files_for_e3sm.seaice_initial_condition.SeaiceInitialCondition"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.files_for_e3sm.seaice_initial_condition.SeaiceInitialCondition</span></code></a></dt><dd><p>extracts the following variables from the restart file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keep_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;areaCell&#39;</span><span class="p">,</span> <span class="s1">&#39;cellsOnCell&#39;</span><span class="p">,</span> <span class="s1">&#39;edgesOnCell&#39;</span><span class="p">,</span> <span class="s1">&#39;fCell&#39;</span><span class="p">,</span>
             <span class="s1">&#39;indexToCellID&#39;</span><span class="p">,</span> <span class="s1">&#39;latCell&#39;</span><span class="p">,</span> <span class="s1">&#39;lonCell&#39;</span><span class="p">,</span> <span class="s1">&#39;meshDensity&#39;</span><span class="p">,</span>
             <span class="s1">&#39;nEdgesOnCell&#39;</span><span class="p">,</span> <span class="s1">&#39;verticesOnCell&#39;</span><span class="p">,</span> <span class="s1">&#39;xCell&#39;</span><span class="p">,</span> <span class="s1">&#39;yCell&#39;</span><span class="p">,</span> <span class="s1">&#39;zCell&#39;</span><span class="p">,</span>
             <span class="s1">&#39;angleEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;cellsOnEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;dcEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;dvEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;edgesOnEdge&#39;</span><span class="p">,</span>
             <span class="s1">&#39;fEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;indexToEdgeID&#39;</span><span class="p">,</span> <span class="s1">&#39;latEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;lonEdge&#39;</span><span class="p">,</span>
             <span class="s1">&#39;nEdgesOnCell&#39;</span><span class="p">,</span> <span class="s1">&#39;nEdgesOnEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;verticesOnEdge&#39;</span><span class="p">,</span>
             <span class="s1">&#39;weightsOnEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;xEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;yEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;zEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;areaTriangle&#39;</span><span class="p">,</span>
             <span class="s1">&#39;cellsOnVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;edgesOnVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;fVertex&#39;</span><span class="p">,</span>
             <span class="s1">&#39;indexToVertexID&#39;</span><span class="p">,</span> <span class="s1">&#39;kiteAreasOnVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;latVertex&#39;</span><span class="p">,</span>
             <span class="s1">&#39;lonVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;xVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;yVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;zVertex&#39;</span><span class="p">]</span>

<span class="k">if</span> <span class="n">with_ice_shelf_cavities</span><span class="p">:</span>
   <span class="n">keep_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;landIceMask&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A symlink to the resulting file is placed at
<code class="docutils literal notranslate"><span class="pre">assembled_files/inputdata/ocn/mpas-cice/&lt;mesh_short_name&gt;/seaice.&lt;mesh_short_name&gt;_no_xtime.nc</span></code></p>
</dd>
<dt><a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.files_for_e3sm.scrip.Scrip.html#compass.ocean.tests.global_ocean.files_for_e3sm.scrip.Scrip" title="compass.ocean.tests.global_ocean.files_for_e3sm.scrip.Scrip"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.files_for_e3sm.scrip.Scrip</span></code></a></dt><dd><p>generates a SCRIP file (see <a class="reference internal" href="../../../users_guide/ocean/test_groups/global_ocean.html#global-ocean-files-for-e3sm"><span class="std std-ref">files_for_e3sm test case</span></a> in the
User’s guide) describing the MPAS-Ocean mesh.  If ice-shelf cavities are
included, the step also generates a SCRIP file without the ice-shelf
cavities for use in coupling components that do not interact with ice-shelf
cavities (atmosphere, land and sea-ice components).</p>
<p>Symlinks are placed in <code class="docutils literal notranslate"><span class="pre">assembled_files/inputdata/ocn/mpas-o/&lt;mesh_short_name&gt;</span></code>
If ice-shelf cavities are present, the two symlinks are named
<code class="docutils literal notranslate"><span class="pre">ocean.&lt;mesh_short_name&gt;.nomask.scrip.&lt;creation_date&gt;.nc</span></code>
and
<code class="docutils literal notranslate"><span class="pre">ocean.&lt;mesh_short_name&gt;.mask.scrip.&lt;creation_date&gt;.nc</span></code>.
Otherwise, only one file is symlinked, and it is named
<code class="docutils literal notranslate"><span class="pre">ocean.&lt;mesh_short_name&gt;.scrip.&lt;creation_date&gt;.nc</span></code></p>
</dd>
<dt><a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.files_for_e3sm.diagnostics_files.DiagnosticsFiles.html#compass.ocean.tests.global_ocean.files_for_e3sm.diagnostics_files.DiagnosticsFiles" title="compass.ocean.tests.global_ocean.files_for_e3sm.diagnostics_files.DiagnosticsFiles"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.files_for_e3sm.diagnostics_files.DiagnosticsFiles</span></code></a></dt><dd><p>creates mapping files and regions masks for E3SM analysis members and
<a class="reference external" href="https://mpas-dev.github.io/MPAS-Analysis/stable/">MPAS-Analysis</a>.</p>
<p>Region masks are created using
<a class="reference external" href="http://mpas-dev.github.io/geometric_features/stable/generated/geometric_features.aggregation.get_aggregator_by_name.html#geometric_features.aggregation.get_aggregator_by_name" title="(in geometric_features v0.6.0)"><code class="xref py py-func docutils literal notranslate"><span class="pre">geometric_features.aggregation.get_aggregator_by_name()</span></code></a> for
the following region groups:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">region_groups</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Antarctic Regions&#39;</span><span class="p">,</span> <span class="s1">&#39;Arctic Ocean Regions&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Arctic Sea Ice Regions&#39;</span><span class="p">,</span> <span class="s1">&#39;Ocean Basins&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Ocean Subbasins&#39;</span><span class="p">,</span> <span class="s1">&#39;ISMIP6 Regions&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Transport Transects&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The resulting region masks are symlinked in the directory
<code class="docutils literal notranslate"><span class="pre">assembled_files/diagnostics/mpas_analysis/region_masks/</span></code>
and named <code class="docutils literal notranslate"><span class="pre">&lt;mesh_short_name&gt;_&lt;region_group&gt;&lt;ref_date&gt;.nc</span></code></p>
<p>Masks are also created for the meridional overturning circulation (MOC)
basins and the transects representing their southern boundaries.
The resulting region mask is in the same directory as above, and named
<code class="docutils literal notranslate"><span class="pre">&lt;mesh_short_name&gt;_moc_masks_and_transects.nc</span></code></p>
<p>Mapping files are created from the MPAS-Ocean and -Seaice mesh to 3
standard comparison grids: a 0.5 x 0.5 degree longitude/latitude grid,
an Antarctic stereographic grid, and an Arctic stereographic grid.
The mapping files are symlinked in the directory
<code class="docutils literal notranslate"><span class="pre">assembled_files/diagnostics/mpas_analysis/maps/</span></code>
and named <code class="docutils literal notranslate"><span class="pre">map_&lt;mesh_short_name&gt;_to_0.5x0.5degree_bilinear.nc</span></code>,
<code class="docutils literal notranslate"><span class="pre">map_&lt;mesh_short_name&gt;_to_6000.0x6000.0km_10.0km_Antarctic_stereo_bilinear.nc</span></code>,
and <code class="docutils literal notranslate"><span class="pre">map_&lt;mesh_short_name&gt;_to_6000.0x6000.0km_10.0km_Arctic_stereo_bilinear.nc</span></code>.</p>
</dd>
</dl>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="global_convergence.html" class="btn btn-neutral float-left" title="global_convergence" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="gotm.html" class="btn btn-neutral float-right" title="gotm" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) 2013-2021,  Los Alamos National Security, LLC (LANS) (Ocean: LA-CC-13-047;Land Ice: LA-CC-13-117) and the University Corporation for Atmospheric Research (UCAR)..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>