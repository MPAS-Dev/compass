

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>global_ocean &mdash; compass 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="ice_shelf_2d" href="ice_shelf_2d.html" />
    <link rel="prev" title="baroclinic_channel" href="baroclinic_channel.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> compass
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/overview.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/testcase.html">Test Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/configuration.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/suite.html">Test Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/landice/index.html">Landice core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/ocean/index.html">Ocean core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/machines/index.html">Machines</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer's guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../command_line.html">Command-line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cores.html">Cores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Examples core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../landice/index.html">Landice core</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Ocean core</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Configurations</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="baroclinic_channel.html">baroclinic_channel</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">global_ocean</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#framework">Framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="#test-cases">Test cases</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ice_shelf_2d.html">ice_shelf_2d</a></li>
<li class="toctree-l3"><a class="reference internal" href="ziso.html">ziso</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../framework.html">Ocean framework</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../framework.html">Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building_docs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../versions.html">Code and Documentation Versions</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">compass</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Ocean core</a> &raquo;</li>
        
          <li><a href="index.html">Configurations</a> &raquo;</li>
        
      <li>global_ocean</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/developers_guide/ocean/configurations/global_ocean.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="global-ocean">
<span id="dev-ocean-global-ocean"></span><h1>global_ocean<a class="headerlink" href="#global-ocean" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">global_ocean</span></code> configuration creates meshes and initial conditions, and
performs testing and dynamic adjustment for global, realistic ocean domains.
It includes 9 test cases on 4 meshes, with the expectation that more meshes
from <a class="reference internal" href="../../../index.html#legacy-compass"><span class="std std-ref">Legacy COMPASS</span></a> will be added in the near future.</p>
<div class="section" id="framework">
<span id="dev-ocean-global-ocean-framework"></span><h2>Framework<a class="headerlink" href="#framework" title="Permalink to this headline">¶</a></h2>
<p>The shared configuration options for the <code class="docutils literal notranslate"><span class="pre">global_ocean</span></code> configuration
are described in <a class="reference internal" href="../../../users_guide/ocean/configurations/global_ocean.html#ocean-global-ocean"><span class="std std-ref">global_ocean</span></a> in the User’s Guide.</p>
<p>Additionally, the configuration has several shared namelist and streams files,
some for shared parameters and streams for forward runs (<code class="docutils literal notranslate"><span class="pre">namelist.forward</span></code>
and <code class="docutils literal notranslate"><span class="pre">streams.forward</span></code>), one specific to meshes with ice-shelf cavities
(<code class="docutils literal notranslate"><span class="pre">namelist.wisc</span></code>), and some related to simulations with biogeochemistry
(<code class="docutils literal notranslate"><span class="pre">namelist.bgc</span></code> and <code class="docutils literal notranslate"><span class="pre">streams.bgc</span></code>).</p>
<div class="section" id="description">
<span id="dev-ocean-global-ocean-description"></span><h3>description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
<p>The module <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.description</span></code> creates a
description of a test case (basically the long name of the testcase) given its
parameters.  The name includes the name of the mesh, the initial condition and
whether biogeochemistory is included, the time integrator and a description
specific to the test case itself.</p>
</div>
<div class="section" id="meshes">
<span id="dev-ocean-global-ocean-meshes"></span><h3>meshes<a class="headerlink" href="#meshes" title="Permalink to this headline">¶</a></h3>
<p>The module <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh</span></code> defines the
<a class="reference internal" href="#dev-ocean-global-ocean-mesh"><span class="std std-ref">mesh test case</span></a> test case as well as properties of each
global mesh in its own module.  Each mesh defines the function
<code class="docutils literal notranslate"><span class="pre">build_cell_width_lat_lon()</span></code>, giving the size of MPAS cells as a function of
longitude and latitude, within its <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>.</p>
<p>Each mesh also includes a test case for a series of 1 or more short simulations
that perform dynamic adjustment of the initial condition (currently erroneously
referred to a “spin up”), allowing high amplitude barotropic waves to
dissipate.</p>
<div class="section" id="qu240">
<span id="dev-ocean-global-ocean-qu240"></span><h4>QU240<a class="headerlink" href="#qu240" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">QU240</span></code> mesh is a quasi-uniform mesh with 240-km resolution.  The
<code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.qu240</span></code> module includes namelist
options appropriate for forward simulations with both RK4 and split-explicit
time integration on this mesh.  These set the time step and default run
duration for short runs with this mesh.</p>
<p>The default config options for this mesh are:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># Options related to the vertical grid</span>
<span class="k">[vertical_grid]</span>

<span class="c1"># the type of vertical grid</span>
<span class="na">grid_type</span> <span class="o">=</span> <span class="s">tanh_dz</span>

<span class="c1"># Number of vertical levels</span>
<span class="na">vert_levels</span> <span class="o">=</span> <span class="s">16</span>

<span class="c1"># Depth of the bottom of the ocean</span>
<span class="na">bottom_depth</span> <span class="o">=</span> <span class="s">3000.0</span>

<span class="c1"># The minimum layer thickness</span>
<span class="na">min_layer_thickness</span> <span class="o">=</span> <span class="s">3.0</span>

<span class="c1"># The maximum layer thickness</span>
<span class="na">max_layer_thickness</span> <span class="o">=</span> <span class="s">500.0</span>


<span class="c1"># options for global ocean testcases</span>
<span class="k">[global_ocean]</span>

<span class="c1">## config options related to the initial_state step</span>
<span class="c1"># number of cores to use</span>
<span class="na">init_cores</span> <span class="o">=</span> <span class="s">4</span>
<span class="c1"># minimum of cores, below which the step fails</span>
<span class="na">init_min_cores</span> <span class="o">=</span> <span class="s">1</span>
<span class="c1"># maximum memory usage allowed (in MB)</span>
<span class="na">init_max_memory</span> <span class="o">=</span> <span class="s">1000</span>
<span class="c1"># maximum disk usage allowed (in MB)</span>
<span class="na">init_max_disk</span> <span class="o">=</span> <span class="s">1000</span>

<span class="c1">## config options related to the forward steps</span>
<span class="c1"># number of cores to use</span>
<span class="na">forward_cores</span> <span class="o">=</span> <span class="s">4</span>
<span class="c1"># minimum of cores, below which the step fails</span>
<span class="na">forward_min_cores</span> <span class="o">=</span> <span class="s">1</span>
<span class="c1"># maximum memory usage allowed (in MB)</span>
<span class="na">forward_max_memory</span> <span class="o">=</span> <span class="s">1000</span>
<span class="c1"># maximum disk usage allowed (in MB)</span>
<span class="na">forward_max_disk</span> <span class="o">=</span> <span class="s">1000</span>

<span class="c1">## metadata related to the mesh</span>
<span class="c1"># the prefix (e.g. QU, EC, WC, SO)</span>
<span class="na">prefix</span> <span class="o">=</span> <span class="s">QU</span>
<span class="c1"># a description of the mesh</span>
<span class="na">mesh_description</span> <span class="o">=</span> <span class="s">MPAS quasi-uniform mesh for E3SM version ${e3sm_version} at</span>
                   <span class="na">${min_res}-km global resolution with ${levels} vertical</span>
                   <span class="na">level</span>

<span class="c1"># E3SM version that the mesh is intended for</span>
<span class="na">e3sm_version</span> <span class="o">=</span> <span class="s">2</span>
<span class="c1"># The revision number of the mesh, which should be incremented each time the</span>
<span class="c1"># mesh is revised</span>
<span class="na">mesh_revision</span> <span class="o">=</span> <span class="s">1</span>
<span class="c1"># the minimum (finest) resolution in the mesh</span>
<span class="na">min_res</span> <span class="o">=</span> <span class="s">240</span>
<span class="c1"># the maximum (coarsest) resolution in the mesh, can be the same as min_res</span>
<span class="na">max_res</span> <span class="o">=</span> <span class="s">240</span>
<span class="c1"># The URL of the pull request documenting the creation of the mesh</span>
<span class="na">pull_request</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>The vertical grid is a <code class="docutils literal notranslate"><span class="pre">tanh_dz</span></code> profile (see <a class="reference internal" href="../framework.html#dev-ocean-framework-vertical"><span class="std std-ref">Vertical coordinate</span></a>)
with 16 vertical levels ranging in thickness from 3 to 500 m.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.qu240.spinup</span></code> module defines a
test case for performing dynamical adjustment on the mesh.  In the
<code class="docutils literal notranslate"><span class="pre">damped_spinup_1</span></code> step, the model is run for 1 day with strong Rayleigh
friction (<code class="docutils literal notranslate"><span class="pre">1e-4</span></code> 1/s) to damp the velocity field.  In the
<code class="docutils literal notranslate"><span class="pre">simulation</span></code> step, the model runs for an additional 1 day without Rayleigh
friction.  The dynamic adjustment test case takes advantage of Jinja templating
for streams files to use the same streams template for each step in the test
case, see <a class="reference internal" href="../../framework.html#dev-streams"><span class="std std-ref">Streams</span></a>.</p>
</div>
<div class="section" id="quwisc240">
<span id="dev-ocean-global-ocean-quwisc240"></span><h4>QUwISC240<a class="headerlink" href="#quwisc240" title="Permalink to this headline">¶</a></h4>
<p>This mesh is identical to <code class="docutils literal notranslate"><span class="pre">QU240</span></code> in every way except that it includes the
cavities below ice shelves in the ocean domain.  The same dynamical adjustment
test case is used.</p>
</div>
<div class="section" id="ec30to60">
<span id="dev-ocean-global-ocean-ec30to60"></span><h4>EC30to60<a class="headerlink" href="#ec30to60" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">EC30to60</span></code> mesh is an “eddy-closure” mesh with 30-km resolution at the
equator, 60-km resolution at mid latitudes, and 35-km resolution at the poles.
The mesh resolution is purely a function of latitude and is defined by the
default keyword arguments to
<a class="reference external" href="http://mpas-dev.github.io/MPAS-Tools/stable/generated/mpas_tools.mesh.creation.mesh_definition_tools.EC_CellWidthVsLat.html#mpas_tools.mesh.creation.mesh_definition_tools.EC_CellWidthVsLat" title="(in mpas_tools vstable)"><code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.mesh.creation.mesh_definition_tools.EC_CellWidthVsLat()</span></code></a>
The <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.ec30to60</span></code> module includes namelist
options appropriate for forward simulations with split-explicit (but not RK4)
time integration on this mesh.  These set the time step and default run
duration for short runs with this mesh.</p>
<p>The default config options for this mesh are:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># Options related to the vertical grid</span>
<span class="k">[vertical_grid]</span>

<span class="c1"># the type of vertical grid</span>
<span class="na">grid_type</span> <span class="o">=</span> <span class="s">60layerPHC</span>


<span class="c1"># options for global ocean testcases</span>
<span class="k">[global_ocean]</span>

<span class="c1">## config options related to the initial_state step</span>
<span class="c1"># number of cores to use</span>
<span class="na">init_cores</span> <span class="o">=</span> <span class="s">36</span>
<span class="c1"># minimum of cores, below which the step fails</span>
<span class="na">init_min_cores</span> <span class="o">=</span> <span class="s">8</span>
<span class="c1"># maximum memory usage allowed (in MB)</span>
<span class="na">init_max_memory</span> <span class="o">=</span> <span class="s">1000</span>
<span class="c1"># maximum disk usage allowed (in MB)</span>
<span class="na">init_max_disk</span> <span class="o">=</span> <span class="s">1000</span>

<span class="c1">## config options related to the forward steps</span>
<span class="c1"># number of cores to use</span>
<span class="na">forward_cores</span> <span class="o">=</span> <span class="s">128</span>
<span class="c1"># minimum of cores, below which the step fails</span>
<span class="na">forward_min_cores</span> <span class="o">=</span> <span class="s">36</span>
<span class="c1"># maximum memory usage allowed (in MB)</span>
<span class="na">forward_max_memory</span> <span class="o">=</span> <span class="s">1000</span>
<span class="c1"># maximum disk usage allowed (in MB)</span>
<span class="na">forward_max_disk</span> <span class="o">=</span> <span class="s">1000</span>

<span class="c1">## metadata related to the mesh</span>
<span class="c1"># the prefix (e.g. QU, EC, WC, SO)</span>
<span class="na">prefix</span> <span class="o">=</span> <span class="s">EC</span>
<span class="c1"># a description of the mesh and initial condition</span>
<span class="na">mesh_description</span> <span class="o">=</span> <span class="s">MPAS Eddy Closure mesh for E3SM version ${e3sm_version} with</span>
                   <span class="na">enhanced resolution around the equator (30 km), South pole</span>
                   <span class="na">(35 km), Greenland (${min_res} km), ${max_res}-km resolution</span>
                   <span class="na">at mid latitudes, and ${levels} vertical levels</span>
<span class="c1"># E3SM version that the mesh is intended for</span>
<span class="na">e3sm_version</span> <span class="o">=</span> <span class="s">2</span>
<span class="c1"># The revision number of the mesh, which should be incremented each time the</span>
<span class="c1"># mesh is revised</span>
<span class="na">mesh_revision</span> <span class="o">=</span> <span class="s">3</span>
<span class="c1"># the minimum (finest) resolution in the mesh</span>
<span class="na">min_res</span> <span class="o">=</span> <span class="s">30</span>
<span class="c1"># the maximum (coarsest) resolution in the mesh, can be the same as min_res</span>
<span class="na">max_res</span> <span class="o">=</span> <span class="s">60</span>
<span class="c1"># The URL of the pull request documenting the creation of the mesh</span>
<span class="na">pull_request</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>The vertical grid is a <code class="docutils literal notranslate"><span class="pre">60layerPHC</span></code> profile (see <a class="reference internal" href="../framework.html#dev-ocean-framework-vertical"><span class="std std-ref">Vertical coordinate</span></a>)
with 60 vertical levels ranging in thickness from 10 to 250 m.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.ec30to60.spinup</span></code> module defines a
test case for performing dynamical adjustment on the mesh.  In the
<code class="docutils literal notranslate"><span class="pre">damped_spinup_1</span></code> step, the model is run for 10 days with strong Rayleigh
friction (<code class="docutils literal notranslate"><span class="pre">1e-4</span></code> 1/s) to damp the velocity field.  In the
<code class="docutils literal notranslate"><span class="pre">simulation</span></code> step, the model runs for an additional 10 days without Rayleigh
friction.  The dynamic adjustment test case takes advantage of Jinja templating
for streams files to use the same streams template for each step in the test
case, see <a class="reference internal" href="../../framework.html#dev-streams"><span class="std std-ref">Streams</span></a>.</p>
</div>
<div class="section" id="ecwisc30to60">
<span id="dev-ocean-global-ocean-ecwisc30to60"></span><h4>ECwISC30to60<a class="headerlink" href="#ecwisc30to60" title="Permalink to this headline">¶</a></h4>
<p>This mesh is identical to <code class="docutils literal notranslate"><span class="pre">EC30to60</span></code> in every way except that it includes the
cavities below ice shelves in the ocean domain.  The same dynamical adjustment
test case is used.</p>
</div>
<div class="section" id="sowisc12to60">
<span id="dev-ocean-global-ocean-sowisc12to60"></span><h4>SOwISC12to60<a class="headerlink" href="#sowisc12to60" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">SOwISC12to60</span></code> mesh is a Southern Ocean regionally refined mesh with
12-km resolution around the Southern Ocean and Antarctica, 45-km at southern
mid-latitudes, 30-km at the equator and in the North Atlantic, 60-km resolution
in the North Pacific, and 35-km resolution in the Arctic.
The <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.so12to60</span></code> module includes namelist
options appropriate for forward simulations with split-explicit (but not RK4)
time integration on this mesh.  These set the time step and default run
duration for short runs with this mesh.</p>
<p>The default config options for this mesh are:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># Options related to the vertical grid</span>
<span class="k">[vertical_grid]</span>

<span class="c1"># the type of vertical grid</span>
<span class="na">grid_type</span> <span class="o">=</span> <span class="s">60layerPHC</span>


<span class="c1"># options for global ocean testcases</span>
<span class="k">[global_ocean]</span>

<span class="c1">## config options related to the initial_state step</span>
<span class="c1"># number of cores to use</span>
<span class="na">init_cores</span> <span class="o">=</span> <span class="s">36</span>
<span class="c1"># minimum of cores, below which the step fails</span>
<span class="na">init_min_cores</span> <span class="o">=</span> <span class="s">8</span>
<span class="c1"># maximum memory usage allowed (in MB)</span>
<span class="na">init_max_memory</span> <span class="o">=</span> <span class="s">1000</span>
<span class="c1"># maximum disk usage allowed (in MB)</span>
<span class="na">init_max_disk</span> <span class="o">=</span> <span class="s">1000</span>

<span class="c1">## config options related to the forward steps</span>
<span class="c1"># number of cores to use</span>
<span class="na">forward_cores</span> <span class="o">=</span> <span class="s">1296</span>
<span class="c1"># minimum of cores, below which the step fails</span>
<span class="na">forward_min_cores</span> <span class="o">=</span> <span class="s">128</span>
<span class="c1"># maximum memory usage allowed (in MB)</span>
<span class="na">forward_max_memory</span> <span class="o">=</span> <span class="s">1000</span>
<span class="c1"># maximum disk usage allowed (in MB)</span>
<span class="na">forward_max_disk</span> <span class="o">=</span> <span class="s">1000</span>

<span class="c1">## metadata related to the mesh</span>
<span class="c1"># the prefix (e.g. QU, EC, WC, SO)</span>
<span class="na">prefix</span> <span class="o">=</span> <span class="s">SO</span>
<span class="c1"># a description of the mesh and initial condition</span>
<span class="na">mesh_description</span> <span class="o">=</span> <span class="s">MPAS Southern Ocean regionally refined mesh for E3SM version</span>
                   <span class="na">${e3sm_version} with enhanced resolution (${min_res} km) around</span>
                   <span class="na">Antarctica, 45-km resolution in the mid southern latitudes,</span>
                   <span class="na">30-km resolution in a 15-degree band around the equator, 60-km</span>
                   <span class="na">resolution in northern mid latitudes, 30 km in the north</span>
                   <span class="na">Atlantic and 35 km in the Arctic.  This mesh has ${levels}</span>
                   <span class="na">vertical levels and includes cavities under the ice shelves</span>
                   <span class="na">around Antarctica.</span>
<span class="c1"># E3SM version that the mesh is intended for</span>
<span class="na">e3sm_version</span> <span class="o">=</span> <span class="s">2</span>
<span class="c1"># The revision number of the mesh, which should be incremented each time the</span>
<span class="c1"># mesh is revised</span>
<span class="na">mesh_revision</span> <span class="o">=</span> <span class="s">4</span>
<span class="c1"># the minimum (finest) resolution in the mesh</span>
<span class="na">min_res</span> <span class="o">=</span> <span class="s">12</span>
<span class="c1"># the maximum (coarsest) resolution in the mesh, can be the same as min_res</span>
<span class="na">max_res</span> <span class="o">=</span> <span class="s">60</span>
<span class="c1"># The URL of the pull request documenting the creation of the mesh</span>
<span class="na">pull_request</span> <span class="o">=</span> <span class="s">https://github.com/MPAS-Dev/compass/pull/37</span>
</pre></div>
</div>
<p>The vertical grid is a <code class="docutils literal notranslate"><span class="pre">60layerPHC</span></code> profile (see <a class="reference internal" href="../framework.html#dev-ocean-framework-vertical"><span class="std std-ref">Vertical coordinate</span></a>)
with 60 vertical levels ranging in thickness from 10 to 250 m.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.so12to60.spinup</span></code> module defines a
test case for performing dynamical adjustment on the mesh.  In the
<code class="docutils literal notranslate"><span class="pre">damped_spinup_1</span></code> through <code class="docutils literal notranslate"><span class="pre">damped_spinup_3</span></code> steps, the model is run for
2, 4 and 4 days with gradually weakening Rayleigh friction (<code class="docutils literal notranslate"><span class="pre">1e-4</span></code>, <code class="docutils literal notranslate"><span class="pre">4e-5</span></code>,
and <code class="docutils literal notranslate"><span class="pre">1e-5</span></code> 1/s) to damp the velocity field.  In the <code class="docutils literal notranslate"><span class="pre">simulation</span></code> step, the
model runs for an additional 10 days without Rayleigh friction.  The
dynamic adjustment test case takes advantage of Jinja templating for streams
files to use the same streams template for each step in the test case, see
<a class="reference internal" href="../../framework.html#dev-streams"><span class="std std-ref">Streams</span></a>.</p>
</div>
</div>
<div class="section" id="metadata">
<span id="dev-ocean-global-ocean-metadata"></span><h3>metadata<a class="headerlink" href="#metadata" title="Permalink to this headline">¶</a></h3>
<p>The module <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.metadata</span></code> determines the values
of a set of metadata related to the E3SM mesh name, initial condition, conda
environment, etc. that are added to nearly all <code class="docutils literal notranslate"><span class="pre">global_ocean</span></code> NetCDF output.
See <a class="reference internal" href="../../../users_guide/ocean/configurations/global_ocean.html#global-ocean-metadata"><span class="std std-ref">Metadata</span></a> in the User’s Guide for more details on
what the metadata looks like.</p>
<p>The values of some of the metadata are given in config options:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># options for global ocean testcases</span>
<span class="k">[global_ocean]</span>

<span class="na">...</span>

<span class="c1">## metadata related to the mesh</span>
<span class="c1"># whether to add metadata to output files</span>
<span class="na">add_metadata</span> <span class="o">=</span> <span class="s">True</span>
<span class="c1"># the prefix (e.g. QU, EC, WC, SO)</span>
<span class="na">prefix</span> <span class="o">=</span> <span class="s">PREFIX</span>
<span class="c1"># a description of the mesh</span>
<span class="na">mesh_description</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span>
<span class="c1"># a description of the bathymetry</span>
<span class="na">bathy_description</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span>
<span class="c1"># a description of the mesh with ice-shelf cavities</span>
<span class="na">init_description</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span>
<span class="c1"># E3SM version that the mesh is intended for</span>
<span class="na">e3sm_version</span> <span class="o">=</span> <span class="s">2</span>
<span class="c1"># The revision number of the mesh, which should be incremented each time the</span>
<span class="c1"># mesh is revised</span>
<span class="na">mesh_revision</span> <span class="o">=</span> <span class="s">&lt;&lt;Missing&gt;&gt;</span>
<span class="c1"># the minimum (finest) resolution in the mesh</span>
<span class="na">min_res</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span>
<span class="c1"># the maximum (coarsest) resolution in the mesh, can be the same as min_res</span>
<span class="na">max_res</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span>
<span class="c1"># the maximum depth of the ocean, always detected automatically</span>
<span class="na">max_depth</span> <span class="o">=</span> <span class="s">autodetect</span>
<span class="c1"># the number of vertical levels, always detected automatically</span>
<span class="na">levels</span> <span class="o">=</span> <span class="s">autodetect</span>

<span class="c1"># the date the mesh was created as YYMMDD, typically detected automatically</span>
<span class="na">creation_date</span> <span class="o">=</span> <span class="s">autodetect</span>
<span class="c1"># The following options are detected from .gitconfig if not explicitly entered</span>
<span class="na">author</span> <span class="o">=</span> <span class="s">autodetect</span>
<span class="na">email</span> <span class="o">=</span> <span class="s">autodetect</span>
<span class="c1"># The URL of the pull request documenting the creation of the mesh</span>
<span class="na">pull_request</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Each mesh should define a number of these config options, e.g. <code class="docutils literal notranslate"><span class="pre">EC30to60</span></code>
defines:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># options for global ocean testcases</span>
<span class="k">[global_ocean]</span>

<span class="na">...</span>

<span class="c1">## metadata related to the mesh</span>
<span class="c1"># the prefix (e.g. QU, EC, WC, SO)</span>
<span class="na">prefix</span> <span class="o">=</span> <span class="s">EC</span>
<span class="c1"># a description of the mesh and initial condition</span>
<span class="na">mesh_description</span> <span class="o">=</span> <span class="s">MPAS Eddy Closure mesh for E3SM version ${e3sm_version} with</span>
                   <span class="na">enhanced resolution around the equator (30 km), South pole</span>
                   <span class="na">(35 km), Greenland (${min_res} km), ${max_res}-km resolution</span>
                   <span class="na">at mid latitudes, and ${levels} vertical levels</span>
<span class="c1"># E3SM version that the mesh is intended for</span>
<span class="na">e3sm_version</span> <span class="o">=</span> <span class="s">2</span>
<span class="c1"># The revision number of the mesh, which should be incremented each time the</span>
<span class="c1"># mesh is revised</span>
<span class="na">mesh_revision</span> <span class="o">=</span> <span class="s">3</span>
<span class="c1"># the minimum (finest) resolution in the mesh</span>
<span class="na">min_res</span> <span class="o">=</span> <span class="s">30</span>
<span class="c1"># the maximum (coarsest) resolution in the mesh, can be the same as min_res</span>
<span class="na">max_res</span> <span class="o">=</span> <span class="s">60</span>
<span class="c1"># The URL of the pull request documenting the creation of the mesh</span>
<span class="na">pull_request</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>In this particular case, the <code class="docutils literal notranslate"><span class="pre">pull_request</span></code> has not yet been defined.  Each
time the mesh is revised, the <code class="docutils literal notranslate"><span class="pre">mesh_revision</span></code> should be updated and the
associated pull request to <a class="reference external" href="https://github.com/MPAS-Dev/compass/">https://github.com/MPAS-Dev/compass/</a> should be
added here.</p>
<p>The function <a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.metadata.get_e3sm_mesh_names.html#compass.ocean.tests.global_ocean.metadata.get_e3sm_mesh_names" title="compass.ocean.tests.global_ocean.metadata.get_e3sm_mesh_names"><code class="xref py py-func docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.metadata.get_e3sm_mesh_names()</span></code></a>
is used to construct the “short” and “long” names of the mesh using a
standard naming convention for E3SM:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">short_mesh_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">E</span><span class="si">{}</span><span class="s1">r</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mesh_prefix</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">e3sm_version</span><span class="p">,</span>
                                      <span class="n">mesh_revision</span><span class="p">)</span>
<span class="n">long_mesh_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">kmL</span><span class="si">{}</span><span class="s1">E3SMv</span><span class="si">{}</span><span class="s1">r</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mesh_prefix</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span>
                                              <span class="n">e3sm_version</span><span class="p">,</span> <span class="n">mesh_revision</span><span class="p">)</span>
</pre></div>
</div>
<p>For example, the <code class="docutils literal notranslate"><span class="pre">QU240</span></code> mesh has the E3SM short name <code class="docutils literal notranslate"><span class="pre">QU240E2r1</span></code> and
long name <code class="docutils literal notranslate"><span class="pre">QU240kmL16E3SMv2r1</span></code>.</p>
</div>
<div class="section" id="subdir">
<span id="dev-ocean-global-ocean-subdir"></span><h3>subdir<a class="headerlink" href="#subdir" title="Permalink to this headline">¶</a></h3>
<p>The subdirectory structure for <code class="docutils literal notranslate"><span class="pre">global_ocean</span></code> test cases got a little complex
as we worked to generalize the test cases.  Each test case is in a subdirectory
with the mesh name.  Each test case other than <code class="docutils literal notranslate"><span class="pre">mesh</span></code> is in a subdirectory
with information about the initial condition that was used.  Further, test
cases that use the <code class="docutils literal notranslate"><span class="pre">RK4</span></code> time integrator are put in their own <code class="docutils literal notranslate"><span class="pre">RK4</span></code>
subdirectory.</p>
<p>To keep track of all of this without to much effort, the module
<code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.subdir</span></code> has several helper functions that
test cases can call to find the relative paths to other test cases:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.subdir.get_init_sudbdir.html#compass.ocean.tests.global_ocean.subdir.get_init_sudbdir" title="compass.ocean.tests.global_ocean.subdir.get_init_sudbdir"><code class="xref py py-func docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.subdir.get_init_sudbdir()</span></code></a> gets
the the subdirectory specific to the initial condition that all test cases
(other than mesh) are under, for example, <code class="docutils literal notranslate"><span class="pre">QU240/PHC</span></code>.</p></li>
<li><p><a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.subdir.get_forward_sudbdir.html#compass.ocean.tests.global_ocean.subdir.get_forward_sudbdir" title="compass.ocean.tests.global_ocean.subdir.get_forward_sudbdir"><code class="xref py py-func docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.subdir.get_forward_sudbdir()</span></code></a> gets
the the subdirectory for a specific test case that includes a forward run.
If the test case is with the default <code class="docutils literal notranslate"><span class="pre">split-explicit</span></code> time integrator, it
doesn’t have a subdirectory to indicate this but if it uses <code class="docutils literal notranslate"><span class="pre">RK4</span></code>, it is
placed in an <code class="docutils literal notranslate"><span class="pre">RK4</span></code> subdirectory.  Examples:
<code class="docutils literal notranslate"><span class="pre">QU240/EN4_1900/performance_test</span></code>, <code class="docutils literal notranslate"><span class="pre">QU240/PHC/RK4/restart_test</span></code>.</p></li>
<li><p><a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.subdir.get_mesh_relative_path.html#compass.ocean.tests.global_ocean.subdir.get_mesh_relative_path" title="compass.ocean.tests.global_ocean.subdir.get_mesh_relative_path"><code class="xref py py-func docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.subdir.get_mesh_relative_path()</span></code></a>
gets the relative path to the subdirectory with the mesh name in the
global_ocean configuration.  For example, for the
<code class="docutils literal notranslate"><span class="pre">QU240/PHC/RK4/restart_test</span></code> test case this would be <code class="docutils literal notranslate"><span class="pre">../../..</span></code>, but
for <code class="docutils literal notranslate"><span class="pre">QU240/EN4_1900/performance_test</span></code>, it would be <code class="docutils literal notranslate"><span class="pre">../..</span></code>.</p></li>
<li><p><a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.subdir.get_initial_condition_relative_path.html#compass.ocean.tests.global_ocean.subdir.get_initial_condition_relative_path" title="compass.ocean.tests.global_ocean.subdir.get_initial_condition_relative_path"><code class="xref py py-func docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.subdir.get_initial_condition_relative_path()</span></code></a>
gets the relative path to the subdirectory with the initial condition name in
the global_ocean configuration.  For example, for the
<code class="docutils literal notranslate"><span class="pre">QU240/PHC/RK4/restart_test</span></code> test case this would be <code class="docutils literal notranslate"><span class="pre">../..</span></code>, but
for <code class="docutils literal notranslate"><span class="pre">QU240/EN4_1900/performance_test</span></code>, it would be <code class="docutils literal notranslate"><span class="pre">..</span></code>.</p></li>
</ul>
<p>The first two functions help with defining subdirectories for test cases to
pass to <a class="reference internal" href="../../generated/compass.testcase.set_testcase_subdir.html#compass.testcase.set_testcase_subdir" title="compass.testcase.set_testcase_subdir"><code class="xref py py-func docutils literal notranslate"><span class="pre">compass.testcase.set_testcase_subdir()</span></code></a>, while the last two
are helpful for adding outputs from previous test cases as inputs to a given
step, and creating symlinks to these files, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mesh_path</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/mesh/mesh&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">get_mesh_relative_path</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
<span class="n">init_path</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/init&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">get_initial_condition_relative_path</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>

<span class="k">if</span> <span class="n">with_ice_shelf_cavities</span><span class="p">:</span>
    <span class="n">initial_state_target</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/ssh_adjustment/adjusted_init.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">init_path</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">initial_state_target</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/initial_state/initial_state.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">init_path</span><span class="p">)</span>
<span class="n">add_input_file</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;init.nc&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">initial_state_target</span><span class="p">)</span>
<span class="n">add_input_file</span><span class="p">(</span>
    <span class="n">step</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;forcing_data.nc&#39;</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/initial_state/init_mode_forcing_data.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">init_path</span><span class="p">))</span>
<span class="n">add_input_file</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;graph.info&#39;</span><span class="p">,</span>
               <span class="n">target</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/culled_graph.info&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mesh_path</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="forward-step">
<span id="dev-ocean-global-ocean-forward"></span><h3>forward step<a class="headerlink" href="#forward-step" title="Permalink to this headline">¶</a></h3>
<p>The module <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.forward</span></code> defines a step
for running MPAS-Ocean from the initial condition produced in the
<code class="docutils literal notranslate"><span class="pre">initial_state</span></code> step or the output of an <code class="docutils literal notranslate"><span class="pre">ssh_adjustment</span></code> step.  When
a test case is adding a forward step with <a class="reference internal" href="../../generated/compass.testcase.add_step.html#compass.testcase.add_step" title="compass.testcase.add_step"><code class="xref py py-func docutils literal notranslate"><span class="pre">compass.testcase.add_step()</span></code></a>,
it needs to pass a number of keyword arguments to be added to the <code class="docutils literal notranslate"><span class="pre">step</span></code>
dictionary, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mesh_name</span> <span class="o">=</span> <span class="n">testcase</span><span class="p">[</span><span class="s1">&#39;mesh_name&#39;</span><span class="p">]</span>
<span class="n">with_ice_shelf_cavities</span> <span class="o">=</span> <span class="n">testcase</span><span class="p">[</span><span class="s1">&#39;with_ice_shelf_cavities&#39;</span><span class="p">]</span>
<span class="n">initial_condition</span> <span class="o">=</span> <span class="n">testcase</span><span class="p">[</span><span class="s1">&#39;initial_condition&#39;</span><span class="p">]</span>
<span class="n">with_bgc</span> <span class="o">=</span> <span class="n">testcase</span><span class="p">[</span><span class="s1">&#39;with_bgc&#39;</span><span class="p">]</span>
<span class="n">time_integrator</span> <span class="o">=</span> <span class="n">testcase</span><span class="p">[</span><span class="s1">&#39;time_integrator&#39;</span><span class="p">]</span>

<span class="o">...</span>

<span class="n">step</span> <span class="o">=</span> <span class="n">add_step</span><span class="p">(</span><span class="n">testcase</span><span class="p">,</span> <span class="n">forward</span><span class="p">,</span> <span class="n">mesh_name</span><span class="o">=</span><span class="n">mesh_name</span><span class="p">,</span>
                <span class="n">with_ice_shelf_cavities</span><span class="o">=</span><span class="n">with_ice_shelf_cavities</span><span class="p">,</span>
                <span class="n">initial_condition</span><span class="o">=</span><span class="n">initial_condition</span><span class="p">,</span> <span class="n">with_bgc</span><span class="o">=</span><span class="n">with_bgc</span><span class="p">,</span>
                <span class="n">time_integrator</span><span class="o">=</span><span class="n">time_integrator</span><span class="p">)</span>
</pre></div>
</div>
<p>As in the example above, these are typically passed along from the <code class="docutils literal notranslate"><span class="pre">testcase</span></code>
dictionary (they were passed in as keyword arguments to
<a class="reference internal" href="../../generated/compass.testcase.add_testcase.html#compass.testcase.add_testcase" title="compass.testcase.add_testcase"><code class="xref py py-func docutils literal notranslate"><span class="pre">compass.testcase.add_testcase()</span></code></a>).</p>
<p>Performance-related parameters—<code class="docutils literal notranslate"><span class="pre">cores</span></code>, <code class="docutils literal notranslate"><span class="pre">min_cores</span></code>, <code class="docutils literal notranslate"><span class="pre">max_memory</span></code>,
<code class="docutils literal notranslate"><span class="pre">max_disk</span></code>, and <code class="docutils literal notranslate"><span class="pre">threads</span></code>—can be passed as keyword arguments to
<code class="docutils literal notranslate"><span class="pre">add_step</span></code>, but they are more typically read from the corresponding
<code class="docutils literal notranslate"><span class="pre">forward_&lt;param&gt;</span></code> config options in the <code class="docutils literal notranslate"><span class="pre">global_ocean</span></code> section of the
config file.  This lets users update these values as appropriate if the machine
and/or mesh defaults aren’t quite right for them.</p>
<p>During <code class="docutils literal notranslate"><span class="pre">collect()</span></code>, this step adds the <code class="docutils literal notranslate"><span class="pre">forward</span></code>, <code class="docutils literal notranslate"><span class="pre">wisc</span></code> and <code class="docutils literal notranslate"><span class="pre">bgc</span></code>
namelist replacements and streams files as appropriate based
<code class="docutils literal notranslate"><span class="pre">with_ice_shelf_cavities</span></code> and <code class="docutils literal notranslate"><span class="pre">with_bgc</span></code>.</p>
<p>Further namelist replacements and streams files can be added in the test case
after calling <code class="docutils literal notranslate"><span class="pre">add_step</span></code>, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">step</span> <span class="o">=</span> <span class="n">add_step</span><span class="p">(</span><span class="n">testcase</span><span class="p">,</span> <span class="n">forward</span><span class="p">,</span> <span class="n">mesh_name</span><span class="o">=</span><span class="n">mesh_name</span><span class="p">,</span>
                <span class="n">with_ice_shelf_cavities</span><span class="o">=</span><span class="n">with_ice_shelf_cavities</span><span class="p">,</span>
                <span class="n">initial_condition</span><span class="o">=</span><span class="n">initial_condition</span><span class="p">,</span> <span class="n">with_bgc</span><span class="o">=</span><span class="n">with_bgc</span><span class="p">,</span>
                <span class="n">time_integrator</span><span class="o">=</span><span class="n">time_integrator</span><span class="p">)</span>

<span class="k">if</span> <span class="n">with_ice_shelf_cavities</span><span class="p">:</span>
    <span class="n">module</span> <span class="o">=</span> <span class="vm">__name__</span>
    <span class="n">add_namelist_file</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="s1">&#39;namelist.wisc&#39;</span><span class="p">)</span>
    <span class="n">add_streams_file</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="s1">&#39;streams.wisc&#39;</span><span class="p">)</span>
    <span class="n">add_output_file</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;land_ice_fluxes.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Namelist and streams files are generate during <code class="docutils literal notranslate"><span class="pre">setup()</span></code> and MPAS-Ocean is
run (including updating PIO namelist options and generating a graph partition)
in <code class="docutils literal notranslate"><span class="pre">run()</span></code>.  Then, <a class="reference internal" href="../../../users_guide/ocean/configurations/global_ocean.html#global-ocean-metadata"><span class="std std-ref">Metadata</span></a> is added to the output NetCDF
files.</p>
</div>
</div>
<div class="section" id="test-cases">
<span id="dev-ocean-global-ocean-testcases"></span><h2>Test cases<a class="headerlink" href="#test-cases" title="Permalink to this headline">¶</a></h2>
<p>There are 9 <code class="docutils literal notranslate"><span class="pre">global_ocean</span></code> test cases.  First, <code class="docutils literal notranslate"><span class="pre">mesh</span></code> must be run to
generate and cull the mesh, then one of the variants of <code class="docutils literal notranslate"><span class="pre">init</span></code> must be run
to create an initial condition on that mesh.  After that, any of the
regression-focused test cases (<code class="docutils literal notranslate"><span class="pre">performance_test</span></code>, <code class="docutils literal notranslate"><span class="pre">restart_test</span></code>,
<code class="docutils literal notranslate"><span class="pre">decomp_test</span></code>, <code class="docutils literal notranslate"><span class="pre">threads_test</span></code>, <code class="docutils literal notranslate"><span class="pre">analysis_test</span></code>, or <code class="docutils literal notranslate"><span class="pre">daily_output_test</span></code>)
can be run in any order and as desired.  If an initial condition for E3SM is
desired, the user (or test suite) should first run <code class="docutils literal notranslate"><span class="pre">spinup</span></code> and then
<code class="docutils literal notranslate"><span class="pre">files_for_e3sm</span></code>.</p>
<div class="section" id="mesh-test-case">
<span id="dev-ocean-global-ocean-mesh"></span><h3>mesh test case<a class="headerlink" href="#mesh-test-case" title="Permalink to this headline">¶</a></h3>
<p>This test case generates an MPAS horizontal mesh, then culls out the land cells
to improve model efficiency.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">mesh</span></code> step, first <code class="docutils literal notranslate"><span class="pre">build_cell_width_lat_lon()</span></code> is called in the
mesh’s module (see <a class="reference internal" href="#dev-ocean-global-ocean-meshes"><span class="std std-ref">meshes</span></a>).  Then, the base mesh
is created with <code class="xref py py-func docutils literal notranslate"><span class="pre">mpas_tools.ocean.build_spherical_mesh()</span></code>.  Finally,
<a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.mesh.cull.cull_mesh.html#compass.ocean.tests.global_ocean.mesh.cull.cull_mesh" title="compass.ocean.tests.global_ocean.mesh.cull.cull_mesh"><code class="xref py py-func docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.cull.cull_mesh()</span></code></a> is called to
cull the mesh.</p>
<p>The helper function <code class="xref py py-func docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.mesh.get_mesh_package()</span></code>
finds the package for a given mesh based on the mesh name.  This can be useful
for computing the mesh resolution as well as finding the forward namelist
replacements and streams files specific to the mesh, or the <code class="docutils literal notranslate"><span class="pre">spinup</span></code> test
case for performing dynamic adjustment of the initial condition.</p>
<p><a class="reference internal" href="../generated/compass.ocean.tests.global_ocean.mesh.cull.cull_mesh.html#compass.ocean.tests.global_ocean.mesh.cull.cull_mesh" title="compass.ocean.tests.global_ocean.mesh.cull.cull_mesh"><code class="xref py py-func docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.cull.cull_mesh()</span></code></a> uses a number
of capabilities from <a class="reference external" href="http://mpas-dev.github.io/MPAS-Tools/stable/">MPAS-Tools</a>
and <a class="reference external" href="http://mpas-dev.github.io/geometric_features/stable/">geometric_features</a>
to cull the mesh.  It performs the following steps:</p>
<ol class="arabic simple">
<li><p>combining Natural Earth land coverage north of 60S with Antarctic
ice coverage or grounded ice coverage from BedMachineAntarctica</p></li>
<li><p>combining transects defining critical passages (if
<code class="docutils literal notranslate"><span class="pre">with_critical_passages=True</span></code>)</p></li>
<li><p>combining points used to seed a flood fill of the global ocean.</p></li>
<li><p>create masks from land coverage</p></li>
<li><p>add land-locked cells to land coverage mask.</p></li>
<li><p>create masks from transects (if <code class="docutils literal notranslate"><span class="pre">with_critical_passages=True</span></code>)</p></li>
<li><p>cull cells based on land coverage but with transects present</p></li>
<li><p>create flood-fill mask based on seeds</p></li>
<li><p>cull cells based on flood-fill mask</p></li>
<li><p>create masks from transects on the final culled mesh (if
<code class="docutils literal notranslate"><span class="pre">with_critical_passages=True</span></code>)</p></li>
</ol>
</div>
<div class="section" id="init-test-case">
<span id="dev-ocean-global-ocean-init"></span><h3>init test case<a class="headerlink" href="#init-test-case" title="Permalink to this headline">¶</a></h3>
<p>The module <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.init</span></code> defines a test case for
creating a global initial condition using MPAS-Ocean’s init mode. Currently
there are two choices for the potential temperature and salinity
fields used for initialization: the Polar science center Hydrographic Climatology
(<a class="reference external" href="http://psc.apl.washington.edu/nonwp_projects/PHC/Climatology.html">PHC</a>)
or the UK MetOffice’s EN4 estimated climatology for the year 1900
(<a class="reference external" href="https://www.metoffice.gov.uk/hadobs/en4/download-en4-2-0.html">EN4_1900</a>).</p>
<p>The test case includes 5 namelist replacement files and 3 streams files.
<code class="docutils literal notranslate"><span class="pre">namelist.init</span></code> and <code class="docutils literal notranslate"><span class="pre">streams.init</span></code> modify the namelist options and set up
the streams needed for the test case, regardless of the particular
configuration.  <code class="docutils literal notranslate"><span class="pre">namelist.phc</span></code> and <code class="docutils literal notranslate"><span class="pre">namelist.en4_1900</span></code> set namelist options
specific to those two sets of input files.  <code class="docutils literal notranslate"><span class="pre">namelist.wisc</span></code> and
<code class="docutils literal notranslate"><span class="pre">streams.wisc</span></code> configure the test case for meshes that include
<a class="reference internal" href="../../../users_guide/ocean/configurations/global_ocean.html#global-ocean-ice-shelf-cavities"><span class="std std-ref">Ice-shelf cavities</span></a>, while <code class="docutils literal notranslate"><span class="pre">namelist.bgc</span></code> and
<code class="docutils literal notranslate"><span class="pre">streams.bgc</span></code> are used to configure the test case when
<a class="reference internal" href="../../../users_guide/ocean/configurations/global_ocean.html#global-ocean-bgc"><span class="std std-ref">Biogeochemsitry</span></a> is included.</p>
<p>The module <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.init.initial_state</span></code> defines
the step for creating the initial state, including defining the topography,
wind stress, shortwave, potential temperature, salinity, and ecosystem input
data files.</p>
<p>The module <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.init.ssh_adjustment</span></code> defines
a step to adjust the <code class="docutils literal notranslate"><span class="pre">landIcePressure</span></code> variable to be in closer to dynamical
balance with the sea-surface height (SSH) in configurations with
<a class="reference internal" href="../framework.html#dev-ocean-framework-iceshelf"><span class="std std-ref">Ice-shelf cavities</span></a>.</p>
<p>If the test case is being compared with a baseline, the potential temperature,
salinity, and layerThickness are compared with those in the baseline initial
condition to make sure they are identical.  In runs with BGC, a large number
of ecosystem tracers are compared, and in simulations with ice-shelf cavities,
the SSH and land-ice pressure are compared against the baseline.</p>
</div>
<div class="section" id="performance-test-test-case">
<span id="dev-ocean-global-ocean-performance-test"></span><h3>performance_test test case<a class="headerlink" href="#performance-test-test-case" title="Permalink to this headline">¶</a></h3>
<p>The module <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.performance_test</span></code> defines a test
case for performing a short MPAS-Ocean simulation as a “smoke test” to make
sure nothing is clearly wrong with the configuration.</p>
<p>The module includes <code class="docutils literal notranslate"><span class="pre">namelist.wisc</span></code> and <code class="docutils literal notranslate"><span class="pre">streams.wisc</span></code>, which enable melt
fluxes below ice shelves and write out related fields if the mesh includes
<a class="reference internal" href="../framework.html#dev-ocean-framework-iceshelf"><span class="std std-ref">Ice-shelf cavities</span></a>.</p>
<p>If a baseline is provided, prognostic variables as well as ecosystem tracers
(if BGC is active) and ice-shelf melt fluxes (if ice-shelf cavities are
included in the mesh) are compared with a baseline, and the
<code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">integration</span></code> timer is compared with that of the baseline.</p>
</div>
<div class="section" id="restart-test-test-case">
<span id="dev-ocean-global-ocean-restart-test"></span><h3>restart_test test case<a class="headerlink" href="#restart-test-test-case" title="Permalink to this headline">¶</a></h3>
<p>The module <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.restart_test</span></code> defines a test
case for comparing a <code class="docutils literal notranslate"><span class="pre">full_run</span></code> of a longer duration with a <code class="docutils literal notranslate"><span class="pre">restart_run</span></code>
that is made up of two segments if half the duration with a restart in between.
The length of the full and restart runs depends on the time integrator.  For
the <code class="docutils literal notranslate"><span class="pre">split-explicit</span></code> integrator, an 8-hour full run is compared with two
4-hour segments in the restart run.  For the <code class="docutils literal notranslate"><span class="pre">RK4</span></code> integrator, the full run
is 20 minutes long, while the restart segments are each 10 minutes.  The test
case ensures that the main prognostic variables—<code class="docutils literal notranslate"><span class="pre">temperature</span></code>,
<code class="docutils literal notranslate"><span class="pre">salinity</span></code>, <code class="docutils literal notranslate"><span class="pre">layerThickness</span></code> and <code class="docutils literal notranslate"><span class="pre">normalVelocity</span></code>—are identical at the
end of the two runs (as well as with a baseline if one is provided when calling
<a class="reference internal" href="../../command_line.html#dev-compass-setup"><span class="std std-ref">compass setup</span></a>).</p>
<p>The various steps and time integrators are configured with
<code class="docutils literal notranslate"><span class="pre">namelist.&lt;time_integrator&gt;.&lt;step&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">streams.&lt;time_integrator&gt;.&lt;step&gt;</span></code>
namelist replacements and streams files.</p>
</div>
<div class="section" id="decomp-test-test-case">
<span id="dev-ocean-global-ocean-decomp-test"></span><h3>decomp_test test case<a class="headerlink" href="#decomp-test-test-case" title="Permalink to this headline">¶</a></h3>
<p>The module <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.decomp_test</span></code> defines a test case
that performs a short run once on 4 cores and once on 8 cores.  It ensures that
<code class="docutils literal notranslate"><span class="pre">temperature</span></code>, <code class="docutils literal notranslate"><span class="pre">salinity</span></code>, <code class="docutils literal notranslate"><span class="pre">layerThickness</span></code> and <code class="docutils literal notranslate"><span class="pre">normalVelocity</span></code> are
identical at the end of the two runs (as well as with a baseline if one is
provided when calling <a class="reference internal" href="../../command_line.html#dev-compass-setup"><span class="std std-ref">compass setup</span></a>).</p>
<p>The duration of the run depends on the mesh and time integrator.  For the
<a class="reference internal" href="#dev-ocean-global-ocean-qu240"><span class="std std-ref">QU240</span></a> and <a class="reference internal" href="#dev-ocean-global-ocean-quwisc240"><span class="std std-ref">QUwISC240</span></a>
(the only meshes that this test case is currently being generated for), the
duration is 6 hours for the <code class="docutils literal notranslate"><span class="pre">split-explicit</span></code> integrator and 10 minutes for
<code class="docutils literal notranslate"><span class="pre">RK4</span></code>.</p>
</div>
<div class="section" id="threads-test-test-case">
<span id="dev-ocean-global-ocean-threads-test"></span><h3>threads_test test case<a class="headerlink" href="#threads-test-test-case" title="Permalink to this headline">¶</a></h3>
<p>The module <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.threads_test</span></code> defines a test
case that performs a short run once on 4 cores, each with 1 thread and once
on 4 cores, each with 2 threads.  It ensures that <code class="docutils literal notranslate"><span class="pre">temperature</span></code>,
<code class="docutils literal notranslate"><span class="pre">salinity</span></code>, <code class="docutils literal notranslate"><span class="pre">layerThickness</span></code> and <code class="docutils literal notranslate"><span class="pre">normalVelocity</span></code> are identical at the
end of the two runs (as well as with a baseline if one is provided when calling
<a class="reference internal" href="../../command_line.html#dev-compass-setup"><span class="std std-ref">compass setup</span></a>).</p>
<p>The duration of the run depends on the mesh and time integrator.  For the
<a class="reference internal" href="#dev-ocean-global-ocean-qu240"><span class="std std-ref">QU240</span></a> and <a class="reference internal" href="#dev-ocean-global-ocean-quwisc240"><span class="std std-ref">QUwISC240</span></a>
(the only meshes that this test case is currently being generated for), the
duration is 6 hours for the <code class="docutils literal notranslate"><span class="pre">split-explicit</span></code> integrator and 10 minutes for
<code class="docutils literal notranslate"><span class="pre">RK4</span></code>.</p>
</div>
<div class="section" id="analysis-test-test-case">
<span id="dev-ocean-global-ocean-analysis-test"></span><h3>analysis_test test case<a class="headerlink" href="#analysis-test-test-case" title="Permalink to this headline">¶</a></h3>
<p>The module <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.analysis_test</span></code> defines a test
case that performs a short run with 14 analysis members (see
<a class="reference internal" href="../../../users_guide/ocean/configurations/global_ocean.html#global-ocean-analysis-test"><span class="std std-ref">analysis_test test case</span></a> in the User’s Guide). The <code class="docutils literal notranslate"><span class="pre">namelist.forward</span></code>
and <code class="docutils literal notranslate"><span class="pre">streams.forward</span></code> files ensure that the analysis members are enabled and
that the appropriate output is written out.  The test ensures that the
prognostic variables as well as a few variables from each analysis member are
identical to those from the baseline if one is provided when calling
<a class="reference internal" href="../../command_line.html#dev-compass-setup"><span class="std std-ref">compass setup</span></a>.</p>
<p>The duration of the run depends on the mesh and time integrator.  For the
<a class="reference internal" href="#dev-ocean-global-ocean-qu240"><span class="std std-ref">QU240</span></a> and <a class="reference internal" href="#dev-ocean-global-ocean-quwisc240"><span class="std std-ref">QUwISC240</span></a>
(the only meshes that this test case is currently being generated for), the
duration is 6 hours for the <code class="docutils literal notranslate"><span class="pre">split-explicit</span></code> integrator and 10 minutes for
<code class="docutils literal notranslate"><span class="pre">RK4</span></code>.</p>
</div>
<div class="section" id="daily-output-test-test-case">
<span id="dev-ocean-global-ocean-daily-output-test"></span><h3>daily_output_test test case<a class="headerlink" href="#daily-output-test-test-case" title="Permalink to this headline">¶</a></h3>
<p>The module <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.daily_output_test</span></code> defines a
test case that performs a 1-day run with the <code class="docutils literal notranslate"><span class="pre">timeSeriesStatsDaily</span></code> analysis
members (see <a class="reference internal" href="../../../users_guide/ocean/configurations/global_ocean.html#global-ocean-daily-output-test"><span class="std std-ref">daily_output_test test case</span></a> in the User’s Guide). The
<code class="docutils literal notranslate"><span class="pre">namelist.forward</span></code> and <code class="docutils literal notranslate"><span class="pre">streams.forward</span></code> files ensure that the analysis
member are enabled and that the appropriate output (the E3SM defaults for
the <code class="docutils literal notranslate"><span class="pre">timeSeriesStatsMonthly</span></code> analysis member) is written out.  The test
ensures that the time average of the prognostic variables as well as the
sea-surface height are identical to those from the baseline if one is provided
when calling <a class="reference internal" href="../../command_line.html#dev-compass-setup"><span class="std std-ref">compass setup</span></a>.</p>
</div>
<div class="section" id="spinup-test-case">
<span id="dev-ocean-global-ocean-spinup"></span><h3>spinup test case<a class="headerlink" href="#spinup-test-case" title="Permalink to this headline">¶</a></h3>
<p>The modules <code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.mesh.&lt;mesh_name&gt;.spinup</span></code> define
test cases that performs dynamic adjustment of the model in which surface waves
dissipate and the sea-surface height adjusts to be in balance with the dynamic
pressure (see <a class="reference internal" href="../../../users_guide/ocean/configurations/global_ocean.html#global-ocean-spinup"><span class="std std-ref">spinup test case</span></a> in the User’s Guide). Each of the
:ref`global_ocean_meshes` has its own adjustment step, since the needs
(duration of each step, amount of damping, time step, etc.) may be different
between meshes.</p>
<p>Each module includes <code class="docutils literal notranslate"><span class="pre">streams.template</span></code>, a Jinja2 template for defining
streams (see <a class="reference internal" href="../../framework.html#dev-streams"><span class="std std-ref">Streams</span></a>):</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;streams&gt;</span>

<span class="nt">&lt;stream</span> <span class="na">name=</span><span class="s">&quot;output&quot;</span>
        <span class="na">output_interval=</span><span class="s">&quot;{{ output_interval }}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;immutable_stream</span> <span class="na">name=</span><span class="s">&quot;restart&quot;</span>
                  <span class="na">filename_template=</span><span class="s">&quot;../restarts/rst.$Y-$M-$D_$h.$m.$s.nc&quot;</span>
                  <span class="na">output_interval=</span><span class="s">&quot;{{ restart_interval }}&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/streams&gt;</span>
</pre></div>
</div>
<p>Details of the dynamic adjustment steps are discussed under
<a class="reference internal" href="#dev-ocean-global-ocean-meshes"><span class="std std-ref">meshes</span></a> above.</p>
</div>
<div class="section" id="files-for-e3sm-test-case">
<span id="dev-ocean-global-ocean-files-for-e3sm"></span><h3>files_for_e3sm test case<a class="headerlink" href="#files-for-e3sm-test-case" title="Permalink to this headline">¶</a></h3>
<p>After running a <a class="reference internal" href="#dev-ocean-global-ocean-spinup"><span class="std std-ref">spinup test case</span></a>, files can be prepared for
use as E3SM ocean and sea-ice initial conditions using the test case defined in
<code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.files_for_e3sm</span></code>.  Output files from the
test case are symlinked in a directory within the test case called
<code class="docutils literal notranslate"><span class="pre">assembled_files</span></code>. See <a class="reference internal" href="../../../users_guide/ocean/configurations/global_ocean.html#global-ocean-files-for-e3sm"><span class="std std-ref">files_for_e3sm test case</span></a> in the User’s
Guide for more details.  Output file names involve the “mesh short name”, see
<a class="reference internal" href="#dev-ocean-global-ocean-metadata"><span class="std std-ref">metadata</span></a>.</p>
<p>The test case requires that an argument <code class="docutils literal notranslate"><span class="pre">restart_filename</span></code> be passed to
<a class="reference internal" href="../../generated/compass.testcase.add_testcase.html#compass.testcase.add_testcase" title="compass.testcase.add_testcase"><code class="xref py py-func docutils literal notranslate"><span class="pre">compass.testcase.add_testcase()</span></code></a> (and thus added to the <code class="docutils literal notranslate"><span class="pre">testcase</span></code>
dictionary).  This should be the final restart file produced by the
<a class="reference internal" href="#dev-ocean-global-ocean-spinup"><span class="std std-ref">spinup test case</span></a> for the given mesh.</p>
<p>The test case is made up of 5 steps:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.files_for_e3sm.ocean_initial_condition</span></code></dt><dd><p>takes out the <code class="docutils literal notranslate"><span class="pre">xtime</span></code> variable from the restart file, creating a symlink
at <code class="docutils literal notranslate"><span class="pre">assembled_files/inputdata/ocn/mpas-o/&lt;mesh_short_name&gt;/&lt;mesh_short_name&gt;_no_xtime.nc</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.files_for_e3sm.ocean_graph_partition</span></code></dt><dd><p>computes graph partitions (see <a class="reference internal" href="../../framework.html#dev-model"><span class="std std-ref">Model</span></a>) appropriate for a wide
range of core counts between <code class="docutils literal notranslate"><span class="pre">min_graph_size</span> <span class="pre">=</span> <span class="pre">int(nCells</span> <span class="pre">/</span> <span class="pre">6000)</span></code> and
<code class="docutils literal notranslate"><span class="pre">max_graph_size</span> <span class="pre">=</span> <span class="pre">int(nCells</span> <span class="pre">/</span> <span class="pre">100)</span></code>.  Possible processor counts are
any power of 2 or any multiple of 12, 120 and 1200 in the range.  Symlinks
to the graph files are placed at
<code class="docutils literal notranslate"><span class="pre">assembled_files/inputdata/ocn/mpas-o/&lt;mesh_short_name&gt;/mpas-o.graph.info.&lt;core_count&gt;</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.files_for_e3sm.seaice_initial_condition</span></code></dt><dd><p>extracts the following variables from the restart file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keep_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;areaCell&#39;</span><span class="p">,</span> <span class="s1">&#39;cellsOnCell&#39;</span><span class="p">,</span> <span class="s1">&#39;edgesOnCell&#39;</span><span class="p">,</span> <span class="s1">&#39;fCell&#39;</span><span class="p">,</span>
             <span class="s1">&#39;indexToCellID&#39;</span><span class="p">,</span> <span class="s1">&#39;latCell&#39;</span><span class="p">,</span> <span class="s1">&#39;lonCell&#39;</span><span class="p">,</span> <span class="s1">&#39;meshDensity&#39;</span><span class="p">,</span>
             <span class="s1">&#39;nEdgesOnCell&#39;</span><span class="p">,</span> <span class="s1">&#39;verticesOnCell&#39;</span><span class="p">,</span> <span class="s1">&#39;xCell&#39;</span><span class="p">,</span> <span class="s1">&#39;yCell&#39;</span><span class="p">,</span> <span class="s1">&#39;zCell&#39;</span><span class="p">,</span>
             <span class="s1">&#39;angleEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;cellsOnEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;dcEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;dvEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;edgesOnEdge&#39;</span><span class="p">,</span>
             <span class="s1">&#39;fEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;indexToEdgeID&#39;</span><span class="p">,</span> <span class="s1">&#39;latEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;lonEdge&#39;</span><span class="p">,</span>
             <span class="s1">&#39;nEdgesOnCell&#39;</span><span class="p">,</span> <span class="s1">&#39;nEdgesOnEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;verticesOnEdge&#39;</span><span class="p">,</span>
             <span class="s1">&#39;weightsOnEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;xEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;yEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;zEdge&#39;</span><span class="p">,</span> <span class="s1">&#39;areaTriangle&#39;</span><span class="p">,</span>
             <span class="s1">&#39;cellsOnVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;edgesOnVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;fVertex&#39;</span><span class="p">,</span>
             <span class="s1">&#39;indexToVertexID&#39;</span><span class="p">,</span> <span class="s1">&#39;kiteAreasOnVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;latVertex&#39;</span><span class="p">,</span>
             <span class="s1">&#39;lonVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;xVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;yVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;zVertex&#39;</span><span class="p">]</span>

<span class="k">if</span> <span class="n">with_ice_shelf_cavities</span><span class="p">:</span>
   <span class="n">keep_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;landIceMask&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A symlink to the resulting file is placed at
<code class="docutils literal notranslate"><span class="pre">assembled_files/inputdata/ocn/mpas-cice/&lt;mesh_short_name&gt;/seaice.&lt;mesh_short_name&gt;_no_xtime.nc</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.files_for_e3sm.scrip</span></code></dt><dd><p>generates a SCRIP file (see <a class="reference internal" href="../../../users_guide/ocean/configurations/global_ocean.html#global-ocean-files-for-e3sm"><span class="std std-ref">files_for_e3sm test case</span></a> in the
User’s guide) describing the MPAS-Ocean mesh.  If ice-shelf cavities are
included, the step also generates a SCRIP file without the ice-shelf
cavities for use in coupling components that do not interact with ice-shelf
cavities (atmosphere, land and sea-ice components).</p>
<p>Symlinks are placed in <code class="docutils literal notranslate"><span class="pre">assembled_files/inputdata/ocn/mpas-o/&lt;mesh_short_name&gt;</span></code>
If ice-shelf cavities are present, the two symlinks are named
<code class="docutils literal notranslate"><span class="pre">ocean.&lt;mesh_short_name&gt;.nomask.scrip.&lt;creation_date&gt;.nc</span></code>
and
<code class="docutils literal notranslate"><span class="pre">ocean.&lt;mesh_short_name&gt;.mask.scrip.&lt;creation_date&gt;.nc</span></code>.
Otherwise, only one file is symlinked, and it is named
<code class="docutils literal notranslate"><span class="pre">ocean.&lt;mesh_short_name&gt;.scrip.&lt;creation_date&gt;.nc</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">compass.ocean.tests.global_ocean.files_for_e3sm.diagnostics_files</span></code></dt><dd><p>creates mapping files and regions masks for E3SM analysis members and
<a class="reference external" href="https://mpas-dev.github.io/MPAS-Analysis/stable/">MPAS-Analysis</a>.</p>
<p>Region masks are created using
<a class="reference external" href="http://mpas-dev.github.io/geometric_features/stable/generated/geometric_features.aggregation.get_aggregator_by_name.html#geometric_features.aggregation.get_aggregator_by_name" title="(in geometric_features v0.3.0)"><code class="xref py py-func docutils literal notranslate"><span class="pre">geometric_features.aggregation.get_aggregator_by_name()</span></code></a> for
the following region groups:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">region_groups</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Antarctic Regions&#39;</span><span class="p">,</span> <span class="s1">&#39;Arctic Ocean Regions&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Arctic Sea Ice Regions&#39;</span><span class="p">,</span> <span class="s1">&#39;Ocean Basins&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Ocean Subbasins&#39;</span><span class="p">,</span> <span class="s1">&#39;ISMIP6 Regions&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Transport Transects&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The resulting region masks are symlinked in the directory
<code class="docutils literal notranslate"><span class="pre">assembled_files/diagnostics/mpas_analysis/region_masks/</span></code>
and named <code class="docutils literal notranslate"><span class="pre">&lt;mesh_short_name&gt;_&lt;region_group&gt;&lt;ref_date&gt;.nc</span></code></p>
<p>Masks are also created for the meridional overturning circulation (MOC)
basins and the transects representing their southern boundaries.
The resulting region mask is in the same directory as above, and named
<code class="docutils literal notranslate"><span class="pre">&lt;mesh_short_name&gt;_moc_masks_and_transects.nc</span></code></p>
<p>Mapping files are created from the MPAS-Ocean and -Seaice mesh to 3
standard comparison grids: a 0.5 x 0.5 degree longitude/latitude grid,
an Antarctic stereographic grid, and an Arctic stereographic grid.
The mapping files are symlinked in the directory
<code class="docutils literal notranslate"><span class="pre">assembled_files/diagnostics/mpas_analysis/maps/</span></code>
and named <code class="docutils literal notranslate"><span class="pre">map_&lt;mesh_short_name&gt;_to_0.5x0.5degree_bilinear.nc</span></code>,
<code class="docutils literal notranslate"><span class="pre">map_&lt;mesh_short_name&gt;_to_6000.0x6000.0km_10.0km_Antarctic_stereo_bilinear.nc</span></code>,
and <code class="docutils literal notranslate"><span class="pre">map_&lt;mesh_short_name&gt;_to_6000.0x6000.0km_10.0km_Arctic_stereo_bilinear.nc</span></code>.</p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="ice_shelf_2d.html" class="btn btn-neutral float-right" title="ice_shelf_2d" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="baroclinic_channel.html" class="btn btn-neutral float-left" title="baroclinic_channel" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Copyright (c) 2013-2021,  Los Alamos National Security, LLC (LANS) (Ocean: LA-CC-13-047;Land Ice: LA-CC-13-117) and the University Corporation for Atmospheric Research (UCAR)..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>