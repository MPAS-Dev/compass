

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Configuration Files &mdash; compass 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Test Suites" href="suite.html" />
    <link rel="prev" title="Test Cases" href="testcase.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> compass
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User's guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="testcase.html">Test Cases</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="suite.html">Test Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="landice/index.html">Landice core</a></li>
<li class="toctree-l1"><a class="reference internal" href="ocean/index.html">Ocean core</a></li>
<li class="toctree-l1"><a class="reference internal" href="machines/index.html">Machines</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/command_line.html">Command-line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/cores.html">Cores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/examples/index.html">Examples core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/landice/index.html">Landice core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/ocean/index.html">Ocean core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/framework.html">Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/building_docs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/api.html">API reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">Code and Documentation Versions</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">compass</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Configuration Files</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/users_guide/configuration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configuration-files">
<span id="config-files"></span><h1>Configuration Files<a class="headerlink" href="#configuration-files" title="Permalink to this headline">¶</a></h1>
<p>compass uses configuration files (with extension <code class="docutils literal notranslate"><span class="pre">.cfg</span></code>) to allow users to
control how <a class="reference internal" href="testcase.html#test-cases"><span class="std std-ref">Test Cases</span></a> and <a class="reference internal" href="suite.html#test-suites"><span class="std std-ref">Test Suites</span></a> get set up and run.
Configuration options for a given test case are built up from a number of
different sources:</p>
<ul class="simple">
<li><p>the default config file,
<a class="reference external" href="https://github.com/MPAS-Dev/compass/blob/master/compass/default.cfg">default.cfg</a>,
which sets a few options related to downloading files during setup (whether
to download and whether to check the size of files already downloaded)</p></li>
<li><p>the <a class="reference external" href="https://github.com/MPAS-Dev/compass/blob/master/compass/machines">machine config file</a>
(using <a class="reference external" href="https://github.com/MPAS-Dev/compass/blob/master/compass/machines/default.cfg">machines/default.cfg</a>
if no machine was specified) with information on the parallel system and
the paths to cached data files</p></li>
<li><p>the core’s config file.  For the <a class="reference internal" href="ocean/index.html#ocean"><span class="std std-ref">Ocean core</span></a> core, this sets default paths
to the MPAS-Ocean model build (including the namelist templates).  It uses
<a class="reference external" href="https://docs.python.org/3/library/configparser.html#configparser.ExtendedInterpolation">extended interpolation</a>
in the config file to use config options within other config
options, e.g. <code class="docutils literal notranslate"><span class="pre">model</span> <span class="pre">=</span> <span class="pre">${paths:mpas_model}/ocean_model</span></code>.</p></li>
<li><p>the configuration’s config file if one is defined.  For idealized
configurations, these include config options that were init-mode namelist
options in <a class="reference internal" href="../index.html#legacy-compass"><span class="std std-ref">Legacy COMPASS</span></a>.  For <a class="reference internal" href="ocean/configurations/global_ocean.html#ocean-global-ocean"><span class="std std-ref">global_ocean</span></a>, these include
defaults for mesh metadata (again using
<a class="reference external" href="https://docs.python.org/3/library/configparser.html#configparser.ExtendedInterpolation">extended interpolation</a>);
the default number of cores and other resource usage for mesh, init and
forward steps; and options related to files created for E3SM initial
conditions.</p></li>
<li><p>any number of config files from the test case.  There might be different
config options depending on how the test case is configured (e.g. only if a
certain feature is enabled.  For example, <a class="reference internal" href="ocean/configurations/global_ocean.html#ocean-global-ocean"><span class="std std-ref">global_ocean</span></a> loads different
sets of config options for different meshes.</p></li>
<li><p>a user’s config file that is passed in to the <code class="docutils literal notranslate"><span class="pre">compass</span> <span class="pre">setup</span></code> (see
<a class="reference internal" href="overview.html#setup-overview"><span class="std std-ref">Setting up a test case</span></a>) or <code class="docutils literal notranslate"><span class="pre">compass</span> <span class="pre">suite</span></code> (see <a class="reference internal" href="overview.html#suite-overview"><span class="std std-ref">Test Suites</span></a>).</p></li>
</ul>
<p>As a user, this last one is the only config file you will need to set up
yourself.  If you are on one of the <a class="reference internal" href="machines/index.html#supported-machines"><span class="std std-ref">Supported Machines</span></a> and you have
built the MPAS-Model code in the default location (see <a class="reference internal" href="overview.html#compass-repo"><span class="std std-ref">Set up a compass repository: for beginners</span></a>),
you won’t need to create a config file at all.</p>
<p>If you are using a machine that <code class="docutils literal notranslate"><span class="pre">compass</span></code> doesn’t know about, you will need
to provide some config options to tell it where you would like to cache some
data files and how many cores you have:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># The paths section points compass to external paths</span>
<span class="k">[paths]</span>

<span class="c1"># The mesh_database and the initial_condition_database are locations where</span>
<span class="c1"># meshes / initial conditions might be found on a specific machine. They can be</span>
<span class="c1"># the same directory, or different directory. Additionally, if they are empty</span>
<span class="c1"># some test cases might download data into them, which will then be reused if</span>
<span class="c1"># the test case is run again later.</span>
<span class="na">mesh_database</span> <span class="o">=</span> <span class="s">/home/xylar/data/mpas/meshes</span>
<span class="na">initial_condition_database</span> <span class="o">=</span> <span class="s">/home/xylar/data/mpas/initial_conditions</span>
<span class="na">bathymetry_database</span> <span class="o">=</span> <span class="s">/home/xylar/data/mpas/bathymetry_database</span>


<span class="c1"># The parallel section describes options related to running tests in parallel</span>
<span class="k">[parallel]</span>

<span class="c1"># parallel system of execution: slurm or single_node</span>
<span class="na">system</span> <span class="o">=</span> <span class="s">single_node</span>

<span class="c1"># whether to use mpirun or srun to run the model</span>
<span class="na">parallel_executable</span> <span class="o">=</span> <span class="s">mpirun</span>

<span class="c1"># cores per node on the machine</span>
<span class="na">cores_per_node</span> <span class="o">=</span> <span class="s">8</span>

<span class="c1"># the number of multiprocessing or dask threads to use</span>
<span class="na">threads</span> <span class="o">=</span> <span class="s">8</span>
</pre></div>
</div>
<p>The comments in this example are hopefully pretty self-explanatory.  If you
have build MPAS-Model in another location, which is often useful if you are
developing the model yourself, you will need to provide the path to the
location where the model is build (i.e. where the <code class="docutils literal notranslate"><span class="pre">ocean_model</span></code> or
<code class="docutils literal notranslate"><span class="pre">landice_model</span></code> executables are found):</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># The paths section points compass to external paths</span>
<span class="k">[paths]</span>

<span class="c1"># the relative or absolute path to the root of a branch where MPAS-Ocean</span>
<span class="c1"># has been built</span>
<span class="na">mpas_model</span> <span class="o">=</span> <span class="s">/home/xylar/code/MPAS-Model/ocean/develop</span>
</pre></div>
</div>
<p>You are free to add any other sections and config options to your config file,
in which case they will override the values specified in one of the other
config files listed above.</p>
<p>A typical config file resulting from all of this looks like:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="k">[download]</span>
<span class="na">download</span> <span class="o">=</span> <span class="s">True</span>
<span class="na">check_size</span> <span class="o">=</span> <span class="s">False</span>
<span class="na">verify</span> <span class="o">=</span> <span class="s">True</span>

<span class="k">[parallel]</span>
<span class="na">system</span> <span class="o">=</span> <span class="s">single_node</span>
<span class="na">parallel_executable</span> <span class="o">=</span> <span class="s">mpirun</span>
<span class="na">cores_per_node</span> <span class="o">=</span> <span class="s">8</span>
<span class="na">threads</span> <span class="o">=</span> <span class="s">8</span>

<span class="k">[paths]</span>
<span class="na">mpas_model</span> <span class="o">=</span> <span class="s">/home/xylar/code/mpas-work/compass/compass_1.0/MPAS-Model/ocean/develop</span>
<span class="na">mesh_database</span> <span class="o">=</span> <span class="s">/home/xylar/data/mpas/meshes</span>
<span class="na">initial_condition_database</span> <span class="o">=</span> <span class="s">/home/xylar/data/mpas/initial_conditions</span>
<span class="na">bathymetry_database</span> <span class="o">=</span> <span class="s">/home/xylar/data/mpas/bathymetry_database</span>

<span class="k">[namelists]</span>
<span class="na">forward</span> <span class="o">=</span> <span class="s">/home/xylar/code/mpas-work/compass/compass_1.0/MPAS-Model/ocean/develop/default_inputs/namelist.ocean.forward</span>
<span class="na">init</span> <span class="o">=</span> <span class="s">/home/xylar/code/mpas-work/compass/compass_1.0/MPAS-Model/ocean/develop/default_inputs/namelist.ocean.init</span>

<span class="k">[streams]</span>
<span class="na">forward</span> <span class="o">=</span> <span class="s">/home/xylar/code/mpas-work/compass/compass_1.0/MPAS-Model/ocean/develop/default_inputs/streams.ocean.forward</span>
<span class="na">init</span> <span class="o">=</span> <span class="s">/home/xylar/code/mpas-work/compass/compass_1.0/MPAS-Model/ocean/develop/default_inputs/streams.ocean.init</span>

<span class="k">[executables]</span>
<span class="na">model</span> <span class="o">=</span> <span class="s">/home/xylar/code/mpas-work/compass/compass_1.0/MPAS-Model/ocean/develop/ocean_model</span>

<span class="k">[ssh_adjustment]</span>
<span class="na">iterations</span> <span class="o">=</span> <span class="s">10</span>

<span class="k">[global_ocean]</span>
<span class="na">mesh_cores</span> <span class="o">=</span> <span class="s">1</span>
<span class="na">mesh_min_cores</span> <span class="o">=</span> <span class="s">1</span>
<span class="na">mesh_max_memory</span> <span class="o">=</span> <span class="s">1000</span>
<span class="na">mesh_max_disk</span> <span class="o">=</span> <span class="s">1000</span>
<span class="na">init_cores</span> <span class="o">=</span> <span class="s">4</span>
<span class="na">init_min_cores</span> <span class="o">=</span> <span class="s">1</span>
<span class="na">init_max_memory</span> <span class="o">=</span> <span class="s">1000</span>
<span class="na">init_max_disk</span> <span class="o">=</span> <span class="s">1000</span>
<span class="na">init_threads</span> <span class="o">=</span> <span class="s">1</span>
<span class="na">forward_cores</span> <span class="o">=</span> <span class="s">4</span>
<span class="na">forward_min_cores</span> <span class="o">=</span> <span class="s">1</span>
<span class="na">forward_threads</span> <span class="o">=</span> <span class="s">1</span>
<span class="na">forward_max_memory</span> <span class="o">=</span> <span class="s">1000</span>
<span class="na">forward_max_disk</span> <span class="o">=</span> <span class="s">1000</span>
<span class="na">add_metadata</span> <span class="o">=</span> <span class="s">True</span>
<span class="na">prefix</span> <span class="o">=</span> <span class="s">QU</span>
<span class="na">mesh_description</span> <span class="o">=</span> <span class="s">MPAS quasi-uniform mesh for E3SM version ${e3sm_version} at</span>
    <span class="na">${min_res}-km global resolution with ${levels} vertical</span>
    <span class="na">level</span>
<span class="na">bathy_description</span> <span class="o">=</span> <span class="s">Bathymetry is from GEBCO 2019, combined with BedMachine Antarctica around Antarctica.</span>
<span class="na">init_description</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;Missing&gt;&gt;&gt;</span>
<span class="na">e3sm_version</span> <span class="o">=</span> <span class="s">2</span>
<span class="na">mesh_revision</span> <span class="o">=</span> <span class="s">1</span>
<span class="na">min_res</span> <span class="o">=</span> <span class="s">240</span>
<span class="na">max_res</span> <span class="o">=</span> <span class="s">240</span>
<span class="na">max_depth</span> <span class="o">=</span> <span class="s">autodetect</span>
<span class="na">levels</span> <span class="o">=</span> <span class="s">autodetect</span>
<span class="na">creation_date</span> <span class="o">=</span> <span class="s">autodetect</span>
<span class="na">author</span> <span class="o">=</span> <span class="s">Xylar Asay-Davis</span>
<span class="na">email</span> <span class="o">=</span> <span class="s">xylar@lanl.gov</span>
<span class="na">pull_request</span> <span class="o">=</span> <span class="s">https://github.com/MPAS-Dev/compass/pull/28</span>

<span class="k">[files_for_e3sm]</span>
<span class="na">enable_ocean_initial_condition</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">enable_ocean_graph_partition</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">enable_seaice_initial_condition</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">enable_scrip</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">enable_diagnostics_files</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">comparisonlatresolution</span> <span class="o">=</span> <span class="s">0.5</span>
<span class="na">comparisonlonresolution</span> <span class="o">=</span> <span class="s">0.5</span>
<span class="na">comparisonantarcticstereowidth</span> <span class="o">=</span> <span class="s">6000.</span>
<span class="na">comparisonantarcticstereoresolution</span> <span class="o">=</span> <span class="s">10.</span>
<span class="na">comparisonarcticstereowidth</span> <span class="o">=</span> <span class="s">6000.</span>
<span class="na">comparisonarcticstereoresolution</span> <span class="o">=</span> <span class="s">10.</span>

<span class="k">[vertical_grid]</span>
<span class="na">grid_type</span> <span class="o">=</span> <span class="s">tanh_dz</span>
<span class="na">vert_levels</span> <span class="o">=</span> <span class="s">16</span>
<span class="na">bottom_depth</span> <span class="o">=</span> <span class="s">3000.0</span>
<span class="na">min_layer_thickness</span> <span class="o">=</span> <span class="s">3.0</span>
<span class="na">max_layer_thickness</span> <span class="o">=</span> <span class="s">500.0</span>
</pre></div>
</div>
<p>Unfortunately, all comments are lost in the process of combining config
options.  Comments are not parsed by <code class="docutils literal notranslate"><span class="pre">ConfigParser</span></code>, and there is not a
standard for which comments are associated with which options.  So users
will need to search through this documentation to know what the config options
are used for.</p>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="suite.html" class="btn btn-neutral float-right" title="Test Suites" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="testcase.html" class="btn btn-neutral float-left" title="Test Cases" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Copyright (c) 2013-2021,  Los Alamos National Security, LLC (LANS) (Ocean: LA-CC-13-047;Land Ice: LA-CC-13-117) and the University Corporation for Atmospheric Research (UCAR)..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>