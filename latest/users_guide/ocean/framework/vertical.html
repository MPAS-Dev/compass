

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Vertical coordinate &mdash; compass latest documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Test suites" href="../suites.html" />
    <link rel="prev" title="Ice shelf-cavities" href="ice_shelf.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> compass
          

          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">User's guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../quick_start.html">Quick Start for Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../test_cases.html">Test Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../config_files.html">Config Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../test_suites.html">Test Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../landice/index.html">Landice core</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Ocean core</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../test_groups/index.html">Test groups</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Framework</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ice_shelf.html">Ice shelf-cavities</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Vertical coordinate</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#d-grid-type">1D Grid type</a></li>
<li class="toctree-l4"><a class="reference internal" href="#d-vertical-coordinates">3D vertical coordinates</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../suites.html">Test suites</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../machines/index.html">Machines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/quick_start.html">Quick Start for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/command_line.html">Command-line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/organization.html">Organization of Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/landice/index.html">Landice core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/ocean/index.html">Ocean core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/framework.html">Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/machines/index.html">Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/building_docs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design_docs/index.html">Design Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/dev_add_test_group.html">Developer Tutorial: Adding a new test group</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/dev_porting_legacy.html">Developer Tutorial: Porting a legacy COMPASS test group</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Glossary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../versions.html">Code and Documentation Versions</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">compass</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Ocean core</a> &raquo;</li>
        
          <li><a href="index.html">Framework</a> &raquo;</li>
        
      <li>Vertical coordinate</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/users_guide/ocean/framework/vertical.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="vertical-coordinate">
<span id="ocean-vertical"></span><h1>Vertical coordinate<a class="headerlink" href="#vertical-coordinate" title="Permalink to this headline">¶</a></h1>
<p>The vertical coordinate used in most MPAS-Ocean test cases is determined by
config options in the <code class="docutils literal notranslate"><span class="pre">vertical_grid</span></code> section of the config file:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># Options related to the vertical grid</span>
<span class="k">[vertical_grid]</span>

<span class="c1"># the type of vertical grid</span>
<span class="na">grid_type</span> <span class="o">=</span> <span class="s">100layerE3SMv1</span>

<span class="c1"># Number of vertical levels</span>
<span class="na">vert_levels</span> <span class="o">=</span> <span class="s">100</span>

<span class="c1"># Depth of the bottom of the ocean</span>
<span class="na">bottom_depth</span> <span class="o">=</span> <span class="s">2500.0</span>

<span class="c1"># The minimum layer thickness</span>
<span class="na">min_layer_thickness</span> <span class="o">=</span> <span class="s">3.0</span>

<span class="c1"># The maximum layer thickness</span>
<span class="na">max_layer_thickness</span> <span class="o">=</span> <span class="s">500.0</span>

<span class="c1"># The type of vertical coordinate (e.g. z-level, z-star)</span>
<span class="na">coord_type</span> <span class="o">=</span> <span class="s">z-star</span>

<span class="c1"># Whether to use &quot;partial&quot; or &quot;full&quot;, or &quot;None&quot; to not alter the topography</span>
<span class="na">partial_cell_type</span> <span class="o">=</span> <span class="s">full</span>

<span class="c1"># The minimum fraction of a layer for partial cells</span>
<span class="na">min_pc_fraction</span> <span class="o">=</span> <span class="s">0.1</span>
</pre></div>
</div>
<p>The vertical coordinate is typically defined based on a 1D reference grid.
Possible 1D grid types are: <code class="docutils literal notranslate"><span class="pre">uniform</span></code>, <code class="docutils literal notranslate"><span class="pre">tanh_dz</span></code>, <code class="docutils literal notranslate"><span class="pre">60layerPHC</span></code>, and
<code class="docutils literal notranslate"><span class="pre">100layerE3SMv1</span></code>.</p>
<p>The meaning of the config options <code class="docutils literal notranslate"><span class="pre">vert_levels</span></code>, <code class="docutils literal notranslate"><span class="pre">bottom_depth</span></code>,
<code class="docutils literal notranslate"><span class="pre">min_layer_thickness</span></code> and <code class="docutils literal notranslate"><span class="pre">max_layer_thickness</span></code> depends grid type and is
described below.</p>
<p>The options <code class="docutils literal notranslate"><span class="pre">coord_type</span></code>, <code class="docutils literal notranslate"><span class="pre">partial_cell_type</span></code> and <code class="docutils literal notranslate"><span class="pre">min_pc_fraction</span></code>
relate to <a class="reference internal" href="#ocean-vert-3d"><span class="std std-ref">3D vertical coordinates</span></a>, described below.</p>
<div class="section" id="d-grid-type">
<h2>1D Grid type<a class="headerlink" href="#d-grid-type" title="Permalink to this headline">¶</a></h2>
<div class="section" id="uniform">
<h3>uniform<a class="headerlink" href="#uniform" title="Permalink to this headline">¶</a></h3>
<p>Uniform vertical grids have vertical layers all of the same thickness. The
layer thickness is simply <code class="docutils literal notranslate"><span class="pre">bottom_depth</span></code> (the positive depth of the bottom
interface of the deepest layer) divided by the number of layers
(<code class="docutils literal notranslate"><span class="pre">vert_levels</span></code>).  In this example, the vertical grid would have 10 vertical
layers, each 100 m thick.</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># Options related to the vertical grid</span>
<span class="k">[vertical_grid]</span>

<span class="c1"># the type of vertical grid</span>
<span class="na">grid_type</span> <span class="o">=</span> <span class="s">uniform</span>

<span class="c1"># Number of vertical levels</span>
<span class="na">vert_levels</span> <span class="o">=</span> <span class="s">10</span>

<span class="c1"># Depth of the bottom of the ocean</span>
<span class="na">bottom_depth</span> <span class="o">=</span> <span class="s">1000.0</span>
</pre></div>
</div>
</div>
<div class="section" id="tanh-dz">
<h3>tanh_dz<a class="headerlink" href="#tanh-dz" title="Permalink to this headline">¶</a></h3>
<p>This vertical coordinate is a variant on
<a class="reference external" href="https://doi.org/10.1016/j.ocemod.2017.03.012">Stewart et al. (2017)</a>.  Layer
thickness is defined by:</p>
<div class="math notranslate nohighlight">
\[\Delta z\left(z\right) = (\Delta z_2 - \Delta z_1)
           \mathrm{tanh}\left(\frac{-\pi z}{\Delta}\right) + \Delta z_1,\]</div>
<p>where <span class="math notranslate nohighlight">\(\Delta z_1\)</span> is the value of the layer thickness
<span class="math notranslate nohighlight">\(\Delta z\)</span> at <span class="math notranslate nohighlight">\(z = 0\)</span> and <span class="math notranslate nohighlight">\(\Delta z_2\)</span> is the same as
<span class="math notranslate nohighlight">\(z \rightarrow \infty\)</span>.  Interface locations <cite>z_k</cite> are defined by:</p>
<div class="math notranslate nohighlight">
\[\begin{split}z_0 = 0, \\
z_{k+1} = z_k - \Delta z\left(z_k\right).\end{split}\]</div>
<p>We use a root finder to solve for <span class="math notranslate nohighlight">\(\Delta\)</span>, such that
<span class="math notranslate nohighlight">\(z_{n_z+1} = -H_\mathrm{bot}\)</span>, where <span class="math notranslate nohighlight">\(n_z\)</span> is <code class="docutils literal notranslate"><span class="pre">nVertLevels</span></code>, the
number of vertical levels (one less than the number of layer interfaces) and
<span class="math notranslate nohighlight">\(H_\mathrm{bot}\)</span> is <code class="docutils literal notranslate"><span class="pre">bottom_depth</span></code>, the depth of the seafloor.</p>
<p>The following config options are all required.  This is an example of a
64-layer vertical grid that has been explored in E3SM v2:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># Options related to the vertical grid</span>
<span class="k">[vertical_grid]</span>

<span class="c1"># the type of vertical grid</span>
<span class="na">grid_type</span> <span class="o">=</span> <span class="s">tanh_dz</span>

<span class="c1"># Number of vertical levels</span>
<span class="na">vert_levels</span> <span class="o">=</span> <span class="s">64</span>

<span class="c1"># Depth of the bottom of the ocean</span>
<span class="na">bottom_depth</span> <span class="o">=</span> <span class="s">6000.0</span>

<span class="c1"># The minimum layer thickness</span>
<span class="na">min_layer_thickness</span> <span class="o">=</span> <span class="s">2.0</span>

<span class="c1"># The maximum layer thickness</span>
<span class="na">max_layer_thickness</span> <span class="o">=</span> <span class="s">210.0</span>
</pre></div>
</div>
</div>
<div class="section" id="layerphc">
<h3>60layerPHC<a class="headerlink" href="#layerphc" title="Permalink to this headline">¶</a></h3>
<p>This is the vertical grid used by the Polar science center Hydrographic Climatology
(<a class="reference external" href="http://psc.apl.washington.edu/nonwp_projects/PHC/Climatology.html">PHC</a>).
Layer thicknesses vary over 60 layers from 10 m at the surface to 250 m at the
seafloor, which is at 5500 m depth.  To get the default grid, use:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># Options related to the vertical grid</span>
<span class="k">[vertical_grid]</span>

<span class="c1"># the type of vertical grid</span>
<span class="na">grid_type</span> <span class="o">=</span> <span class="s">60layerPHC</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">bottom_depth</span></code> option is also defined, the depths will be renormalized
so that bottom of the deepest layer is at <code class="docutils literal notranslate"><span class="pre">z</span> <span class="pre">=</span> <span class="pre">-bottom_depth</span></code></p>
</div>
<div class="section" id="layere3smv1">
<h3>100layerE3SMv1<a class="headerlink" href="#layere3smv1" title="Permalink to this headline">¶</a></h3>
<p>This is the vertical grid was used in some E3SM v1 experiments. Layer
thicknesses vary over 100 layers from 1.51 m at the surface to 221 m at the
seafloor, which is at 6000 m depth.  To get the default grid, use:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># Options related to the vertical grid</span>
<span class="k">[vertical_grid]</span>

<span class="c1"># the type of vertical grid</span>
<span class="na">grid_type</span> <span class="o">=</span> <span class="s">100layerE3SMv1</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">bottom_depth</span></code> option is also defined, the depths will be renormalized
so that bottom of the deepest layer is at <code class="docutils literal notranslate"><span class="pre">z</span> <span class="pre">=</span> <span class="pre">-bottom_depth</span></code>.  This is
the default approach in the <a class="reference internal" href="../test_groups/ziso.html#ocean-ziso"><span class="std std-ref">ziso</span></a> test group:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># Options related to the vertical grid</span>
<span class="k">[vertical_grid]</span>

<span class="c1"># the type of vertical grid</span>
<span class="na">grid_type</span> <span class="o">=</span> <span class="s">100layerE3SMv1</span>

<span class="c1"># Depth of the bottom of the ocean</span>
<span class="na">bottom_depth</span> <span class="o">=</span> <span class="s">2500.0</span>
</pre></div>
</div>
<p>In this case, the thickness of the 100 layers vary between ~0.63 m and 92.1 m,
with the sea floor at 2500 m.</p>
</div>
</div>
<div class="section" id="d-vertical-coordinates">
<span id="ocean-vert-3d"></span><h2>3D vertical coordinates<a class="headerlink" href="#d-vertical-coordinates" title="Permalink to this headline">¶</a></h2>
<p>Currently, <code class="docutils literal notranslate"><span class="pre">z-star</span></code> and <code class="docutils literal notranslate"><span class="pre">z-level</span></code> vertical coordinates are supported
(<code class="docutils literal notranslate"><span class="pre">coord_type</span></code>).  Each supports 3 options for <code class="docutils literal notranslate"><span class="pre">partial_cell_type</span></code>: <code class="docutils literal notranslate"><span class="pre">full</span></code>
meaning the topography (bottom depth and sea-surface height) are expanded so
that all layers have their full thickness; <code class="docutils literal notranslate"><span class="pre">partial</span></code> meaning that cells
adjacent to the topography are allowed to be a small fraction of a full layer
thickness; or <code class="docutils literal notranslate"><span class="pre">None</span></code> to indicate that no alteration is needed for full or
partial cells (typically only in cases where the topography is already flat).</p>
<p>If <code class="docutils literal notranslate"><span class="pre">partial_cell_type</span> <span class="pre">=</span> <span class="pre">partial</span></code>, the option <code class="docutils literal notranslate"><span class="pre">min_pc_fraction</span></code> indicates
the smallest fraction of a layer that a partial cell is allowed to have before
it must either be expanded to the minimum or collapsed to the next adjacent
valid layer (whichever would cause the smallest change).</p>
<div class="section" id="z-star">
<span id="ocean-z-star"></span><h3>z-star<a class="headerlink" href="#z-star" title="Permalink to this headline">¶</a></h3>
<p>Most MPAS-Ocean test cases currently use the z* vertical coordinate
(<a class="reference external" href="https://doi.org/10.1016/j.ocemod.2003.09.003">Adcroft and Campin, 2004</a>)
by default.  Typically (in the absence of ice-shelf cavities), the initial
“resting” grid uses a <a class="reference internal" href="#ocean-z-level"><span class="std std-ref">z-level</span></a> coordinate.  As the sea-surface
height evolves, the coordinate stretches and squashes in proportion to changes
in the local watercolumn thickness.</p>
<p>In configurations with <a class="reference internal" href="ice_shelf.html#ocean-ice-shelf-cavities"><span class="std std-ref">Ice shelf-cavities</span></a>, the ice draft
(elevation of the ice shelf-ocean interface) also acts the sea-surface height
for a z-star coordinate.  This means that the initial layers are squashed
significantly from their “resting” thickness under ice shelves as if they were
being pressed down by the weight of the ice.</p>
</div>
<div class="section" id="z-level">
<span id="ocean-z-level"></span><h3>z-level<a class="headerlink" href="#z-level" title="Permalink to this headline">¶</a></h3>
<p>In the absence of <a class="reference internal" href="ice_shelf.html#ocean-ice-shelf-cavities"><span class="std std-ref">Ice shelf-cavities</span></a>, the z-level coordinate in
MPAS-Ocean is the same as the <a class="reference internal" href="#ocean-z-star"><span class="std std-ref">z-star</span></a> coordinate.</p>
<p>When ice-shelf cavities are included, rather than depressing the vertical grid
under the weight of the ice, the z-level coordinate used top cells to mask out
parts of the mesh as “land” in the same way that cells below the batymetry are
masked as land.  The topography at the top of the ocean is represented by
“stair steps”, using either “full” or “partial” cells to represent these steps
in exactly the same way as at the seafloor.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../suites.html" class="btn btn-neutral float-right" title="Test suites" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="ice_shelf.html" class="btn btn-neutral float-left" title="Ice shelf-cavities" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Copyright (c) 2013-2021,  Los Alamos National Security, LLC (LANS) (Ocean: LA-CC-13-047;Land Ice: LA-CC-13-117) and the University Corporation for Atmospheric Research (UCAR)..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>