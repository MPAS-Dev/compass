

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>planar_convergence &mdash; compass latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=c6e86fd7"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="soma" href="soma.html" />
    <link rel="prev" title="parabolic_bowl" href="parabolic_bowl.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            compass
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User's guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../quick_start.html">Quick Start for Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../test_cases.html">Test Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../config_files.html">Config Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../test_suites.html">Test Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../landice/index.html">Landice core</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Ocean core</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Test groups</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="baroclinic_channel.html">baroclinic_channel</a></li>
<li class="toctree-l3"><a class="reference internal" href="baroclinic_gyre.html">baroclinic_gyre</a></li>
<li class="toctree-l3"><a class="reference internal" href="buttermilk_bay.html">buttermilk_bay</a></li>
<li class="toctree-l3"><a class="reference internal" href="dam_break.html">dam_break</a></li>
<li class="toctree-l3"><a class="reference internal" href="drying_slope.html">drying_slope</a></li>
<li class="toctree-l3"><a class="reference internal" href="global_convergence.html">global_convergence</a></li>
<li class="toctree-l3"><a class="reference internal" href="global_ocean.html">global_ocean</a></li>
<li class="toctree-l3"><a class="reference internal" href="gotm.html">gotm</a></li>
<li class="toctree-l3"><a class="reference internal" href="hurricane.html">hurricane</a></li>
<li class="toctree-l3"><a class="reference internal" href="ice_shelf_2d.html">ice_shelf_2d</a></li>
<li class="toctree-l3"><a class="reference internal" href="internal_wave.html">internal_wave</a></li>
<li class="toctree-l3"><a class="reference internal" href="isomip_plus.html">isomip_plus</a></li>
<li class="toctree-l3"><a class="reference internal" href="lock_exchange.html">lock_exchange</a></li>
<li class="toctree-l3"><a class="reference internal" href="merry_go_round.html">merry_go_round</a></li>
<li class="toctree-l3"><a class="reference internal" href="nonhydro.html">nonhydro</a></li>
<li class="toctree-l3"><a class="reference internal" href="overflow.html">overflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="parabolic_bowl.html">parabolic_bowl</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">planar_convergence</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#shared-config-options">shared config options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#resolutions">resolutions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#time-step">time step</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cores">cores</a></li>
<li class="toctree-l4"><a class="reference internal" href="#config-options">config options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="soma.html">soma</a></li>
<li class="toctree-l3"><a class="reference internal" href="sphere_transport.html">sphere_transport</a></li>
<li class="toctree-l3"><a class="reference internal" href="spherical_harmonic_transform.html">spherical_harmonic_transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="tides.html">tides</a></li>
<li class="toctree-l3"><a class="reference internal" href="utility.html">utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="ziso.html">ziso</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../framework/index.html">Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../suites.html">Test suites</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../machines/index.html">Machines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/quick_start.html">Quick Start for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/command_line.html">Command-line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/organization.html">Organization of Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/landice/index.html">Landice core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/ocean/index.html">Ocean core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/framework.html">Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/machines/index.html">Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/building_docs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/deploying_spack.html">Deploying a new spack environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers_guide/api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design_docs/index.html">Design Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/dev_add_test_group.html">Developer Tutorial: Adding a new test group</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/dev_add_rrm.html">Developer Tutorial: Adding a new ocean/sea ice regionally refined mesh (RRM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/dev_add_param_study.html">Developer Tutorial: Adding a parameter study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/dev_porting_legacy.html">Developer Tutorial: Porting a legacy COMPASS test group</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Glossary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../versions.html">Code and Documentation Versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">compass</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Ocean core</a></li>
          <li class="breadcrumb-item"><a href="index.html">Test groups</a></li>
      <li class="breadcrumb-item active">planar_convergence</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/users_guide/ocean/test_groups/planar_convergence.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="planar-convergence">
<span id="ocean-planar-convergence"></span><h1>planar_convergence<a class="headerlink" href="#planar-convergence" title="Link to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">planar_convergence</span></code> test group implements convergence studies for
doubly periodic, planar meshes.  Currently, the only test case is the
horizontal advection of a Gaussian tracer.</p>
<section id="shared-config-options">
<h2>shared config options<a class="headerlink" href="#shared-config-options" title="Link to this heading"></a></h2>
<p>Config options shared by all test cases include:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># Options related to the vertical grid</span>
<span class="k">[vertical_grid]</span>

<span class="c1"># the type of vertical grid</span>
<span class="na">grid_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">uniform</span>

<span class="c1"># Number of vertical levels</span>
<span class="na">vert_levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3</span>

<span class="c1"># Depth of the bottom of the ocean</span>
<span class="na">bottom_depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">300.0</span>

<span class="c1"># The type of vertical coordinate (e.g. z-level, z-star)</span>
<span class="na">coord_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">z-star</span>

<span class="c1"># Whether to use &quot;partial&quot; or &quot;full&quot;, or &quot;None&quot; to not alter the topography</span>
<span class="na">partial_cell_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">None</span>

<span class="c1"># The minimum fraction of a layer for partial cells</span>
<span class="na">min_pc_fraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0.1</span>

<span class="c1"># options for planar convergence test cases</span>
<span class="k">[planar_convergence]</span>

<span class="c1"># a list of resolutions (km) to test</span>
<span class="na">resolutions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2, 4, 8, 16, 32</span>

<span class="c1"># number of mesh cells in x and y for 1 km resolution.  Other resolutions have</span>
<span class="c1"># the same physical size.  The default is approximately square, because of the</span>
<span class="c1"># staggering of the hex mesh.</span>
<span class="na">nx_1km</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">512</span>
<span class="na">ny_1km</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">640</span>

<span class="c1"># the number of cells per core to aim for</span>
<span class="na">goal_cells_per_core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">300</span>

<span class="c1"># the approximate maximum number of cells per core (the test will fail if too</span>
<span class="c1"># few cores are available)</span>
<span class="na">max_cells_per_core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3000</span>

<span class="c1"># time step at 1 km.  dt at other resolutions is proportional to the resolution</span>
<span class="na">dt_1km</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">15</span>

<span class="c1"># the duration (hours) of the run</span>
<span class="na">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">24</span>
</pre></div>
</div>
</section>
<section id="resolutions">
<h2>resolutions<a class="headerlink" href="#resolutions" title="Link to this heading"></a></h2>
<p>To alter the resolutions used in this test, you will need to create your own
config file (or add a <code class="docutils literal notranslate"><span class="pre">planar_convergence</span></code> section to a config file if you’re
already using one).  The resolutions are a comma-separated list of the
uniform resolution of the mesh in km.  If you specify a different list
before setting up <code class="docutils literal notranslate"><span class="pre">horizontal_advection</span></code>, steps will be generated with the
requested resolutions.  (If you alter <code class="docutils literal notranslate"><span class="pre">resolutions</span></code> in the test case’s config
file in the work directory, nothing will happen.)</p>
</section>
<section id="time-step">
<h2>time step<a class="headerlink" href="#time-step" title="Link to this heading"></a></h2>
<p>The time step for forward integration is determined by multiplying the
resolution by <code class="docutils literal notranslate"><span class="pre">dt_1km</span></code>, so that coarser meshes have longer time steps.
You can alter this before setup (in a user config file) or before running the
test case (in the config file in the work directory).</p>
</section>
<section id="cores">
<h2>cores<a class="headerlink" href="#cores" title="Link to this heading"></a></h2>
<p>The number of cores (and the minimum) is proportional to the number of cells,
so that the number of cells per core is roughly constant.  You can alter how
many cells are allocated to each core with <code class="docutils literal notranslate"><span class="pre">goal_cells_per_core</span></code>.  You can
control the maximum number of cells that are allowed to be placed on a single
core (before the test case will fail) with <code class="docutils literal notranslate"><span class="pre">max_cells_per_core</span></code>.  If there
aren’t enough processors to handle the finest resolution, you will see that
the step (and therefore the test case) has failed.</p>
<section id="horizontal-advection">
<span id="ocean-planar-convergence-horizontal-advection"></span><h3>horizontal_advection<a class="headerlink" href="#horizontal-advection" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">horizontal_advection</span></code> test case implements horizontal advection in a
constant velocity field of a Gaussian tracer.  The domain is periodic in both
x and y, and the flow field is designed to return the tracer to its original
location at the center of the domain in 24 hours.  The time step is
proportional to the grid-cell size.</p>
<p>By default, the resolution is varied from 2 km to 32 km by powers of 2.
The result of the <code class="docutils literal notranslate"><span class="pre">analysis</span></code> step of the test case is a plot like the
following showing convergence as a function of the number of cells:</p>
<a class="reference internal image-reference" href="../../../_images/horizontal_advection_convergence.png"><img alt="../../../_images/horizontal_advection_convergence.png" class="align-center" src="../../../_images/horizontal_advection_convergence.png" style="width: 500px;" />
</a>
</section>
</section>
<section id="config-options">
<h2>config options<a class="headerlink" href="#config-options" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">horizontal_advection</span></code> config options include:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># options for planar horizontal advection test case</span>
<span class="k">[horizontal_advection]</span>

<span class="c1"># Temperature (deg C) of the ocean</span>
<span class="na">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">15.0</span>

<span class="c1"># Salinity (PSU) of the surface of the ocean</span>
<span class="na">salinity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">35.0</span>

<span class="c1"># center of the tracer gaussian (km)</span>
<span class="na">x_center</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0.</span>
<span class="na">y_center</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0.</span>

<span class="c1"># width of gaussian tracer &quot;blob&quot; (km)</span>
<span class="na">gaussian_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">50</span>

<span class="c1"># whether to advect in x, y, or both</span>
<span class="na">advect_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<span class="na">advect_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>

<span class="c1"># convergence threshold below which the test fails</span>
<span class="na">conv_thresh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1.9</span>

<span class="c1"># Convergence rate above which a warning is issued</span>
<span class="na">conv_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2.3</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">x_center</span></code>, <code class="docutils literal notranslate"><span class="pre">y_center</span></code> and <code class="docutils literal notranslate"><span class="pre">gaussian_width</span></code> are used to control
properties of the Gaussian tracer.  <code class="docutils literal notranslate"><span class="pre">temperature</span></code> and <code class="docutils literal notranslate"><span class="pre">salinity</span></code> are
constant background properties.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="parabolic_bowl.html" class="btn btn-neutral float-left" title="parabolic_bowl" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="soma.html" class="btn btn-neutral float-right" title="soma" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) 2013-2021,  Los Alamos National Security, LLC (LANS) (Ocean: LA-CC-13-047;Land Ice: LA-CC-13-117) and the University Corporation for Atmospheric Research (UCAR)..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>