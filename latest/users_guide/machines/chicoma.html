

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chicoma &mdash; compass latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=c6e86fd7"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Chrysalis" href="chrysalis.html" />
    <link rel="prev" title="Anvil" href="anvil.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            compass
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User's guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick Start for Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../test_cases.html">Test Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config_files.html">Config Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../test_suites.html">Test Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../landice/index.html">Landice core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ocean/index.html">Ocean core</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Machines</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#config-options">config options</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#slurm-job-queueing">Slurm job queueing</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#supported-machines">Supported Machines</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="anvil.html">Anvil</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Chicoma</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#chicoma-cpu">Chicoma-CPU</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="chrysalis.html">Chrysalis</a></li>
<li class="toctree-l3"><a class="reference internal" href="compy.html">CompyMcNodeFace</a></li>
<li class="toctree-l3"><a class="reference internal" href="perlmutter.html">Perlmutter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#other-machines">Other Machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">MPICH</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id5">OpenMPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#no-mpi-from-conda-forge">No MPI from conda-forge</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/quick_start.html">Quick Start for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/command_line.html">Command-line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/organization.html">Organization of Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/landice/index.html">Landice core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/ocean/index.html">Ocean core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/framework.html">Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/machines/index.html">Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/building_docs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/deploying_spack.html">Deploying a new spack environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design_docs/index.html">Design Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/dev_add_test_group.html">Developer Tutorial: Adding a new test group</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/dev_add_rrm.html">Developer Tutorial: Adding a new ocean/sea ice regionally refined mesh (RRM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/dev_add_param_study.html">Developer Tutorial: Adding a parameter study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/dev_porting_legacy.html">Developer Tutorial: Porting a legacy COMPASS test group</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Glossary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../versions.html">Code and Documentation Versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">compass</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Machines</a></li>
      <li class="breadcrumb-item active">Chicoma</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/users_guide/machines/chicoma.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="chicoma">
<span id="machine-chicoma"></span><h1>Chicoma<a class="headerlink" href="#chicoma" title="Link to this heading"></a></h1>
<p><a class="reference external" href="https://int.lanl.gov/hpc/institutional-computing/index.shtml">LANL IC overview and search</a></p>
<p><a class="reference external" href="http://hpccalendar.lanl.gov/">DST Calendar</a> (within LANL network)</p>
<p>Information about Slurm:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://hpc.lanl.gov/job-scheduling/index.html#JobScheduling-IntroductiontoSlurm">Introduction to Slurm at LANL</a></p></li>
<li><p><a class="reference external" href="https://hpc.lanl.gov/job-scheduling/basic-slurm-guide-for-lanl-hpc-users.html">Basic Slurm Guide for LANL HPC Users</a></p></li>
<li><p><a class="reference external" href="https://hpc.lanl.gov/job-scheduling/slurm-commands.html">Slurm Command Summary</a></p></li>
<li><p><a class="reference external" href="https://hpc.lanl.gov/job-scheduling/slurm-commands.html#SlurmCommands-SlurmJobSubmission">Slurm: Running Jobs on HPC Platforms</a></p></li>
<li><p><a class="reference external" href="https://hpc.lanl.gov/job-scheduling/basic-slurm-guide-for-lanl-hpc-users.html#BasicSlurmGuideforLANLHPCUsers-BatchScriptGenerator">example of batch scripts</a></p></li>
</ul>
<p>Machine specifications: <a class="reference external" href="https://hpc.lanl.gov/platforms/chicoma/index.html">chicoma</a>
<a class="reference external" href="https://hpc.lanl.gov/networks/turquoise-network/index.html">turquoise network</a></p>
<p>login: <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">-t</span> <span class="pre">&lt;username&gt;&#64;wtrw.lanl.gov</span> <span class="pre">ssh</span> <span class="pre">ch-fe</span></code></p>
<p>File locations:</p>
<ul class="simple">
<li><p>small home directory, for start-up scripts only: <code class="docutils literal notranslate"><span class="pre">/users/&lt;username&gt;</span></code></p></li>
<li><p>home directory, backed up: <code class="docutils literal notranslate"><span class="pre">/usr/projects/climate/&lt;username&gt;</span></code></p></li>
<li><p>scratch space, not backed up: <code class="docutils literal notranslate"><span class="pre">/lustre/scratch4/turquoise/&lt;username&gt;</span></code> or
<code class="docutils literal notranslate"><span class="pre">scratch5</span></code></p></li>
</ul>
<p>Check compute time:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sacctmgr</span> <span class="pre">list</span> <span class="pre">assoc</span> <span class="pre">user=&lt;username&gt;</span> <span class="pre">format=Cluster,Account%18,Partition,QOS%45</span></code></p></li>
<li><p>Which is my default account? <code class="docutils literal notranslate"><span class="pre">sacctmgr</span> <span class="pre">list</span> <span class="pre">user</span> <span class="pre">&lt;username&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sshare</span> <span class="pre">-a</span> <span class="pre">|</span> <span class="pre">head</span> <span class="pre">-2;</span> <span class="pre">sshare</span> <span class="pre">-a</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">$ACCOUNT</span> <span class="pre">|</span> <span class="pre">head</span> <span class="pre">-1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sreport</span> <span class="pre">-t</span> <span class="pre">Hours</span> <span class="pre">cluster</span> <span class="pre">AccountUtilizationByUser</span> <span class="pre">start=2019-12-02</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">$ACCOUNT</span></code></p></li>
<li><p>check job priority: <code class="docutils literal notranslate"><span class="pre">sshare</span> <span class="pre">-a</span> <span class="pre">|</span> <span class="pre">head</span> <span class="pre">-2;</span> <span class="pre">sshare</span> <span class="pre">-a</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">$ACCOUNT</span></code></p></li>
<li><p><a class="reference external" href="https://hpcinfo.lanl.gov">LANL Cluster Usage Overview</a> (within LANL yellow)</p></li>
</ul>
<p>Check disk usage:</p>
<ul class="simple">
<li><p>your home space: <code class="docutils literal notranslate"><span class="pre">chkhome</span></code></p></li>
<li><p>total disk usage in Petabytes: <code class="docutils literal notranslate"><span class="pre">df</span> <span class="pre">-BP</span> <span class="pre">|head</span> <span class="pre">-n</span> <span class="pre">1;</span> <span class="pre">df</span> <span class="pre">-BP|grep</span> <span class="pre">climate;</span> <span class="pre">df</span> <span class="pre">-BP</span> <span class="pre">|grep</span> <span class="pre">scratch</span></code></p></li>
</ul>
<p>Archiving</p>
<ul class="simple">
<li><p><a class="reference external" href="https://hpc.lanl.gov/data/filesystems-and-storage-on-hpc-clusters/hpss-data-archive/index.html">turquoise HPSS archive</a></p></li>
<li><p>archive front end: <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">-t</span> <span class="pre">&lt;username&gt;&#64;wtrw.lanl.gov</span> <span class="pre">ssh</span> <span class="pre">ar-tn</span></code></p></li>
<li><p>storage available at: <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/archive/&lt;project_name&gt;</span></code></p></li>
<li><p>you can just copy files directly into here for a particular project.</p></li>
</ul>
<p>LANL uses slurm. To obtain an interactive node:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>salloc<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-t<span class="w"> </span><span class="m">2</span>:0:0<span class="w"> </span>--qos<span class="o">=</span>interactive
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">--account=ACCOUNT_NAME</span></code> to change to a particular account.</p>
<section id="chicoma-cpu">
<h2>Chicoma-CPU<a class="headerlink" href="#chicoma-cpu" title="Link to this heading"></a></h2>
<p><strong>There has not yet been a release with Chicoma-CPU, so the following applies
to the release of compass v1.2.0, when it happens.</strong></p>
<p>Chicoma’s CPU and GPU nodes have different configuration options and compilers.
We only support Chicoma-CPU at this time.</p>
<section id="config-options">
<h3>config options<a class="headerlink" href="#config-options" title="Link to this heading"></a></h3>
<p>Here are the default config options added when you choose <code class="docutils literal notranslate"><span class="pre">-m</span> <span class="pre">chicoma-cpu</span></code>
when setting up test cases or a test suite:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># The paths section describes paths that are used within the ocean core test</span>
<span class="c1"># cases.</span>
<span class="k">[paths]</span>

<span class="c1"># A shared root directory where MPAS standalone data can be found</span>
<span class="na">database_root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/usr/projects/regionalclimate/COMMON_MPAS/mpas_standalonedata/</span>

<span class="c1"># the path to the base conda environment where compass environments have</span>
<span class="c1"># been created</span>
<span class="na">compass_envs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/usr/projects/climate/SHARED_CLIMATE/compass/chicoma-cpu/base</span>


<span class="c1"># Options related to deploying a compass conda environment on supported</span>
<span class="c1"># machines</span>
<span class="k">[deploy]</span>

<span class="c1"># the compiler set to use for system libraries and MPAS builds</span>
<span class="na">compiler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">gnu</span>

<span class="c1"># the system MPI library to use for gnu compiler</span>
<span class="na">mpi_gnu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">mpich</span>

<span class="c1"># the base path for spack environments used by compass</span>
<span class="na">spack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/usr/projects/climate/SHARED_CLIMATE/compass/chicoma-cpu/spack</span>

<span class="c1"># whether to use the same modules for hdf5, netcdf-c, netcdf-fortran and</span>
<span class="c1"># pnetcdf as E3SM (spack modules are used otherwise)</span>
<span class="na">use_e3sm_hdf5_netcdf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>


<span class="c1"># The parallel section describes options related to running jobs in parallel</span>
<span class="k">[parallel]</span>

<span class="c1"># account for running diagnostics jobs</span>
<span class="na">account</span><span class="w"> </span><span class="o">=</span>

<span class="c1"># cores per node on the machine</span>
<span class="na">cores_per_node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">128</span>

<span class="c1"># threads per core (set to 1 because trying to hyperthread seems to be causing</span>
<span class="c1"># hanging on chicoma)</span>
<span class="na">threads_per_core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span>


<span class="c1"># Config options related to creating a job script</span>
<span class="k">[job]</span>

<span class="c1"># The job partition to use</span>
<span class="na">partition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">standard</span>

<span class="c1"># The job reservation to use (needed for debug jobs)</span>
<span class="na">reservation</span><span class="w"> </span><span class="o">=</span>

<span class="c1"># The job quality of service (QOS) to use</span>
<span class="na">qos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">standard</span>
</pre></div>
</div>
<p>Additionally, some relevant config options come from the
<a class="reference external" href="https://github.com/E3SM-Project/mache/">mache</a> package:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># The parallel section describes options related to running jobs in parallel</span>
<span class="k">[parallel]</span>

<span class="c1"># parallel system of execution: slurm, cobalt or single_node</span>
<span class="na">system</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">slurm</span>

<span class="c1"># whether to use mpirun or srun to run a task</span>
<span class="na">parallel_executable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">srun</span>

<span class="c1"># cores per node on the machine</span>
<span class="na">cores_per_node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">256</span>

<span class="c1"># available partition(s) (default is the first)</span>
<span class="na">partitions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">standard, gpu</span>

<span class="c1"># quality of service (default is the first)</span>
<span class="na">qos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">standard, debug</span>


<span class="c1"># Config options related to spack environments</span>
<span class="k">[spack]</span>

<span class="c1"># whether to load modules from the spack yaml file before loading the spack</span>
<span class="c1"># environment</span>
<span class="na">modules_before</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">False</span>

<span class="c1"># whether to load modules from the spack yaml file after loading the spack</span>
<span class="c1"># environment</span>
<span class="na">modules_after</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">False</span>
</pre></div>
</div>
</section>
<section id="hyperthreading">
<h3>Hyperthreading<a class="headerlink" href="#hyperthreading" title="Link to this heading"></a></h3>
<p>By default, hyperthreading has been disable on Chicoma. We had found some
some issues with runs hanging in early testing that seemed to be mitigated by
disabling hyperthreading.  We disable hyperthreading by setting
<code class="docutils literal notranslate"><span class="pre">threads_per_core</span> <span class="pre">=</span> <span class="pre">1</span></code> and reducing <code class="docutils literal notranslate"><span class="pre">cores_per_node</span></code> to not include the
2 hyperthreads.  You can re-enable hyperthreading on Chicoma by providing a
user config file where you set <code class="docutils literal notranslate"><span class="pre">threads_per_core</span></code> and <code class="docutils literal notranslate"><span class="pre">cores_per_node</span></code>
as follows:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># The parallel section describes options related to running jobs in parallel</span>
<span class="k">[parallel]</span>

<span class="c1"># cores per node on the machine (including hyperthreading)</span>
<span class="na">cores_per_node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">256</span>

<span class="c1"># threads per core with hyperthreading</span>
<span class="na">threads_per_core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2</span>
</pre></div>
</div>
</section>
<section id="gnu-on-chicoma-cpu">
<h3>Gnu on Chicoma-CPU<a class="headerlink" href="#gnu-on-chicoma-cpu" title="Link to this heading"></a></h3>
<p>To load the compass environment and modules, and set appropriate environment
variables:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>/usr/projects/climate/SHARED_CLIMATE/compass/chicoma-cpu/load_latest_compass_gnu_mpich.sh
</pre></div>
</div>
<p>To build the MPAS model with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span><span class="o">[</span><span class="nv">DEBUG</span><span class="o">=</span>true<span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="nv">OPENMP</span><span class="o">=</span>true<span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="nv">ALBANY</span><span class="o">=</span>true<span class="o">]</span><span class="w"> </span>gnu-cray
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="anvil.html" class="btn btn-neutral float-left" title="Anvil" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="chrysalis.html" class="btn btn-neutral float-right" title="Chrysalis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) 2013-2021,  Los Alamos National Security, LLC (LANS) (Ocean: LA-CC-13-047;Land Ice: LA-CC-13-117) and the University Corporation for Atmospheric Research (UCAR)..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>