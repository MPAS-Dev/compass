

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Quick Start for Users &mdash; compass latest documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Test Cases" href="test_cases.html" />
    <link rel="prev" title="compass" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> compass
          

          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User's guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quick Start for Users</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#compass-conda-environment">compass conda environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-a-test-case">Setting up a test case</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-a-test-case">Running a test case</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-suites">Test Suites</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="test_cases.html">Test Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_files.html">Config Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_suites.html">Test Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="landice/index.html">Landice core</a></li>
<li class="toctree-l1"><a class="reference internal" href="ocean/index.html">Ocean core</a></li>
<li class="toctree-l1"><a class="reference internal" href="machines/index.html">Machines</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/quick_start.html">Quick Start for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/command_line.html">Command-line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/organization.html">Organization of Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/landice/index.html">Landice core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/ocean/index.html">Ocean core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/framework.html">Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/machines/index.html">Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/building_docs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_docs/index.html">Design Documents</a></li>
</ul>
<p class="caption"><span class="caption-text">Glossary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
<p class="caption"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">Code and Documentation Versions</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">compass</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Quick Start for Users</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/users_guide/quick_start.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quick-start-for-users">
<span id="quick-start"></span><h1>Quick Start for Users<a class="headerlink" href="#quick-start-for-users" title="Permalink to this headline">¶</a></h1>
<div class="section" id="compass-conda-environment">
<span id="conda-env"></span><h2>compass conda environment<a class="headerlink" href="#compass-conda-environment" title="Permalink to this headline">¶</a></h2>
<p>For each <code class="docutils literal notranslate"><span class="pre">compass</span></code> release, we maintain a
<a class="reference external" href="https://docs.conda.io/en/latest/">conda environment</a>. that includes the
<code class="docutils literal notranslate"><span class="pre">compass</span></code> package as well as all of its dependencies on our standard machines
(Grizzly, Badger, Anvil, Chrysalis, Compy and Cori).  Here are the commands to
load the the environment for the latest <code class="docutils literal notranslate"><span class="pre">compass</span></code> release on each machine:</p>
<ul class="simple">
<li><p>Grizzly and Badger:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> /usr/projects/climate/SHARED_CLIMATE/anaconda_envs/load_latest_compass.sh
</pre></div>
</div>
<ul class="simple">
<li><p>Anvil (Blues) and Chrysalis:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> /lcrc/soft/climate/e3sm-unified/load_latest_compass.sh
</pre></div>
</div>
<ul class="simple">
<li><p>Compy:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> /share/apps/E3SM/conda_envs/load_latest_compass.sh
</pre></div>
</div>
<ul class="simple">
<li><p>Cori:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> /global/cfs/cdirs/e3sm/software/anaconda_envs/load_latest_compass.sh
</pre></div>
</div>
<p>To install your own <code class="docutils literal notranslate"><span class="pre">compass</span></code> conda environment on other machines, first,
install <a class="reference external" href="https://docs.conda.io/en/latest/miniconda.html">Miniconda3</a> (if
miniconda is not already installed), then add the
<a class="reference external" href="https://conda-forge.org/#about">conda-forge channel</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda config --add channels conda-forge
conda config --set channel_priority strict
</pre></div>
</div>
<p>then create a new conda environment (called <code class="docutils literal notranslate"><span class="pre">compass</span></code> in this example) as
follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda create -n compass python compass
</pre></div>
</div>
<p>To get a specific version of python and <code class="docutils literal notranslate"><span class="pre">compass</span></code>, you can instead run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda create -n compass <span class="nv">python</span><span class="o">=</span><span class="m">3</span>.8 <span class="nv">compass</span><span class="o">=</span><span class="m">1</span>.0.0
</pre></div>
</div>
<p>Each time you want to work with compass, you will need to run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda activate compass
</pre></div>
</div>
</div>
<div class="section" id="setting-up-a-test-case">
<span id="setup-overview"></span><h2>Setting up a test case<a class="headerlink" href="#setting-up-a-test-case" title="Permalink to this headline">¶</a></h2>
<p>Before you set up a test case with <code class="docutils literal notranslate"><span class="pre">compass</span></code>, you will need to build the
MPAS component you wish to test with.  Since the instructions for building
MPAS are machine specific, they are covered in the <a class="reference internal" href="machines/index.html#machines"><span class="std std-ref">Machines</span></a> part of the
User’s Guide.</p>
<p>To see all available test cases you can set up in compass, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>compass list
</pre></div>
</div>
<p>and you get output like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0: landice/dome/2000m/smoke_test
1: landice/dome/2000m/decomposition_test
2: landice/dome/2000m/restart_test
3: landice/dome/variable_resolution/smoke_test
4: landice/dome/variable_resolution/decomposition_test
5: landice/dome/variable_resolution/restart_test
6: landice/eismint2/standard_experiments
7: landice/eismint2/decomposition_test
8: landice/eismint2/restart_test
</pre></div>
</div>
<p>The list is long, so it will likely be useful to <code class="docutils literal notranslate"><span class="pre">grep</span></code> for particular
content:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>compass list <span class="p">|</span> grep baroclinic_channel
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>20: ocean/baroclinic_channel/1km/rpe_test
21: ocean/baroclinic_channel/4km/rpe_test
22: ocean/baroclinic_channel/10km/rpe_test
23: ocean/baroclinic_channel/10km/decomp_test
24: ocean/baroclinic_channel/10km/default
25: ocean/baroclinic_channel/10km/restart_test
26: ocean/baroclinic_channel/10km/threads_test
</pre></div>
</div>
<p>See <a class="reference internal" href="../developers_guide/command_line.html#dev-compass-list"><span class="std std-ref">compass list</span></a> for more information.</p>
<p>To set up a particular test case, you can either use the full path of the
test case:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>compass setup -t ocean/global_ocean/QU240/mesh -m <span class="nv">$MACHINE</span> -w <span class="nv">$WORKDIR</span> -p <span class="nv">$MPAS</span>
</pre></div>
</div>
<p>or you can replace the <code class="docutils literal notranslate"><span class="pre">-t</span></code> flag with the simple shortcut: <code class="docutils literal notranslate"><span class="pre">-n</span> <span class="pre">15</span></code>.  You
can set up several test cases at once by passing test numbers separated by
spaces: <code class="docutils literal notranslate"><span class="pre">-n</span> <span class="pre">15</span> <span class="pre">16</span> <span class="pre">17</span></code>.  See <a class="reference internal" href="../developers_guide/command_line.html#dev-compass-setup"><span class="std std-ref">compass setup</span></a> for more details.</p>
<p>Here <code class="docutils literal notranslate"><span class="pre">$WORKDIR</span></code> is a path, usually to your scratch space. For example,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-w /lustre/scratch4/turquoise/<span class="nv">$USER</span>/runs/210131_test_new_branch
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">$MACHINE</span></code> is one of the known machines (omit the <code class="docutils literal notranslate"><span class="pre">-m</span></code> flag if you are not
working on one of the known machines).  You can run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>compass list --machines
</pre></div>
</div>
<p>to see what machines are currently supported.</p>
<p><code class="docutils literal notranslate"><span class="pre">$MPAS</span></code> is the path where the MPAS component has been built (the directory,
not the executable itself; see <a class="reference internal" href="machines/index.html#machines"><span class="std std-ref">Machines</span></a>).  By default, <code class="docutils literal notranslate"><span class="pre">compass</span></code> looks
in either <code class="docutils literal notranslate"><span class="pre">MALI-Dev/components/mpas-albany-landice</span></code> or
<code class="docutils literal notranslate"><span class="pre">E3SM-Project/components/mpas-ocean</span></code>, for the <code class="docutils literal notranslate"><span class="pre">landice</span></code> and <code class="docutils literal notranslate"><span class="pre">ocean</span></code>
cores, respectively.  This default path is mostly useful for <code class="docutils literal notranslate"><span class="pre">compass</span></code>
developers, who will check out the <code class="docutils literal notranslate"><span class="pre">compass</span></code> repo and will therefore have
these directories available to them from the repo.</p>
<p>You may point to a config file with <code class="docutils literal notranslate"><span class="pre">-f</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>compass setup -t ocean/global_ocean/QU240/mesh -f ocean.cfg -w <span class="nv">$WORKDIR</span>
</pre></div>
</div>
<p>to specify config options that override the defaults from <code class="docutils literal notranslate"><span class="pre">compass</span></code> as a
whole, individual testcases, or machines.  If you are working on a supported
machine and you used <code class="docutils literal notranslate"><span class="pre">-p</span></code> to point to the MPAS build you want to use, you do
not need a config file.</p>
<p>If you are not on one of the supported machines, you will need to create a
config file like in this example for MPAS-Ocean. See also
<a class="reference external" href="https://github.com/MPAS-Dev/compass/tree/master/example_configs">these examples</a>
in the repository.</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># The paths section points compass to external paths</span>
<span class="k">[paths]</span>

<span class="c1"># the relative or absolute path to the root of a branch where MPAS-Ocean</span>
<span class="c1"># has been built</span>
<span class="na">mpas_model</span> <span class="o">=</span> <span class="s">E3SM-Project/components/mpas-ocean</span>

<span class="c1"># The mesh_database and the initial_condition_database are locations where</span>
<span class="c1"># meshes / initial conditions might be found on a specific machine. They can be</span>
<span class="c1"># the same directory, or different directory. Additionally, if they are empty</span>
<span class="c1"># some test cases might download data into them, which will then be reused if</span>
<span class="c1"># the test case is run again later.</span>
<span class="na">mesh_database</span> <span class="o">=</span> <span class="s">/home/xylar/data/mpas/meshes</span>
<span class="na">initial_condition_database</span> <span class="o">=</span> <span class="s">/home/xylar/data/mpas/initial_conditions</span>
<span class="na">bathymetry_database</span> <span class="o">=</span> <span class="s">/home/xylar/data/mpas/bathymetry_database</span>


<span class="c1"># The parallel section describes options related to running tests in parallel</span>
<span class="k">[parallel]</span>

<span class="c1"># parallel system of execution: slurm or single_node</span>
<span class="na">system</span> <span class="o">=</span> <span class="s">single_node</span>

<span class="c1"># whether to use mpirun or srun to run the model</span>
<span class="na">parallel_executable</span> <span class="o">=</span> <span class="s">mpirun</span>

<span class="c1"># cores per node on the machine</span>
<span class="na">cores_per_node</span> <span class="o">=</span> <span class="s">8</span>

<span class="c1"># the number of multiprocessing or dask threads to use</span>
<span class="na">threads</span> <span class="o">=</span> <span class="s">8</span>
</pre></div>
</div>
<p>In order to run a bit-for-bit test with a previous test case, use
<code class="docutils literal notranslate"><span class="pre">-b</span> <span class="pre">$PREVIOUS_WORKDIR</span></code> to specify a “baseline”.</p>
</div>
<div class="section" id="running-a-test-case">
<h2>Running a test case<a class="headerlink" href="#running-a-test-case" title="Permalink to this headline">¶</a></h2>
<p>After compiling the code and setting up a test case, you can log into an
interactive node (see <a class="reference internal" href="machines/index.html#supported-machines"><span class="std std-ref">Supported Machines</span></a>), load the required conda
environment and modules, and then</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$WORKDIR</span>/<span class="nv">$TEST_SUBDIR</span>
compass run
</pre></div>
</div>
<p>Note the sequence of subdirectories (<code class="docutils literal notranslate"><span class="pre">$TEST_SUBDIR</span></code>) is the same as given
when you list the test cases.  If the test case was set up properly, the
directory should contain a file <code class="docutils literal notranslate"><span class="pre">test_case.pickle</span></code> that contains the
information <code class="docutils literal notranslate"><span class="pre">compass</span></code> needs to run the test case.</p>
</div>
<div class="section" id="test-suites">
<span id="suite-overview"></span><h2>Test Suites<a class="headerlink" href="#test-suites" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">compass</span></code> includes several suites of test cases for code regressions and
bit-for-bit testing, as well as simply to make it easier to run several test
cases in one call. For the ocean core, they can be listed with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>compass list --suites
</pre></div>
</div>
<p>You can set up a suite as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>compass suite -s -c ocean -t nightly -m <span class="nv">$MACHINE</span> -w <span class="nv">$WORKDIR</span> -p <span class="nv">$MPAS</span>
</pre></div>
</div>
<p>where the details are similar to setting up a case. You can use the same
config file (e.g. <code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">ocean.cfg</span></code>) and you can specify a “baseline” with
<code class="docutils literal notranslate"><span class="pre">-b</span> <span class="pre">$PREVIOUS_WORKDIR</span></code> for bit-for-bit comparison of the output with a
previous run of the <code class="docutils literal notranslate"><span class="pre">nightly</span></code> suite. See <a class="reference internal" href="../developers_guide/command_line.html#dev-compass-suite"><span class="std std-ref">compass suite</span></a> for more
on this command.</p>
<p>To run the regression suite, log into an interactive node, load your modules,
and</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$WORKDIR</span>
compass run <span class="o">[</span>nightly<span class="o">]</span>
</pre></div>
</div>
<p>In this case, you can specify the name of the suite to run.  This is required
if there are multiple suites in the same <code class="docutils literal notranslate"><span class="pre">$WORKDIR</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="test_cases.html" class="btn btn-neutral float-right" title="Test Cases" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../index.html" class="btn btn-neutral float-left" title="compass" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Copyright (c) 2013-2021,  Los Alamos National Security, LLC (LANS) (Ocean: LA-CC-13-047;Land Ice: LA-CC-13-117) and the University Corporation for Atmospheric Research (UCAR)..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>