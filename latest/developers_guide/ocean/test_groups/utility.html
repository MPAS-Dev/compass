

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>utility &mdash; compass latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=c6e86fd7"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="ziso" href="ziso.html" />
    <link rel="prev" title="tides" href="tides.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            compass
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/quick_start.html">Quick Start for Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/test_cases.html">Test Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/config_files.html">Config Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/test_suites.html">Test Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/landice/index.html">Landice core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/ocean/index.html">Ocean core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/machines/index.html">Machines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../quick_start.html">Quick Start for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../command_line.html">Command-line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../organization.html">Organization of Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../landice/index.html">Landice core</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Ocean core</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Test groups</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="baroclinic_channel.html">baroclinic_channel</a></li>
<li class="toctree-l3"><a class="reference internal" href="baroclinic_gyre.html">baroclinic_gyre</a></li>
<li class="toctree-l3"><a class="reference internal" href="buttermilk_bay.html">buttermilk_bay</a></li>
<li class="toctree-l3"><a class="reference internal" href="dam_break.html">dam_break</a></li>
<li class="toctree-l3"><a class="reference internal" href="drying_slope.html">drying_slope</a></li>
<li class="toctree-l3"><a class="reference internal" href="global_convergence.html">global_convergence</a></li>
<li class="toctree-l3"><a class="reference internal" href="global_ocean.html">global_ocean</a></li>
<li class="toctree-l3"><a class="reference internal" href="gotm.html">gotm</a></li>
<li class="toctree-l3"><a class="reference internal" href="hurricane.html">hurricane</a></li>
<li class="toctree-l3"><a class="reference internal" href="ice_shelf_2d.html">ice_shelf_2d</a></li>
<li class="toctree-l3"><a class="reference internal" href="internal_wave.html">internal_wave</a></li>
<li class="toctree-l3"><a class="reference internal" href="isomip_plus.html">isomip_plus</a></li>
<li class="toctree-l3"><a class="reference internal" href="lock_exchange.html">lock_exchange</a></li>
<li class="toctree-l3"><a class="reference internal" href="merry_go_round.html">merry_go_round</a></li>
<li class="toctree-l3"><a class="reference internal" href="nonhydro.html">nonhydro</a></li>
<li class="toctree-l3"><a class="reference internal" href="overflow.html">overflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="parabolic_bowl.html">parabolic_bowl</a></li>
<li class="toctree-l3"><a class="reference internal" href="planar_convergence.html">planar_convergence</a></li>
<li class="toctree-l3"><a class="reference internal" href="soma.html">soma</a></li>
<li class="toctree-l3"><a class="reference internal" href="sphere_transport.html">sphere_transport</a></li>
<li class="toctree-l3"><a class="reference internal" href="spherical_harmonic_transform.html">spherical_harmonic_transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="tides.html">tides</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">utility</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#combine-topo">combine_topo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cull-restarts">cull_restarts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extrap-woa">extrap_woa</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-salin-restoring">create_salin_restoring</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ziso.html">ziso</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../framework.html">Ocean framework</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../framework.html">Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../machines/index.html">Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building_docs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deploying_spack.html">Deploying a new spack environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design_docs/index.html">Design Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/dev_add_test_group.html">Developer Tutorial: Adding a new test group</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/dev_add_rrm.html">Developer Tutorial: Adding a new ocean/sea ice regionally refined mesh (RRM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/dev_add_param_study.html">Developer Tutorial: Adding a parameter study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/dev_porting_legacy.html">Developer Tutorial: Porting a legacy COMPASS test group</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Glossary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../versions.html">Code and Documentation Versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">compass</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Ocean core</a></li>
          <li class="breadcrumb-item"><a href="index.html">Test groups</a></li>
      <li class="breadcrumb-item active">utility</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/developers_guide/ocean/test_groups/utility.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="utility">
<span id="dev-ocean-utility"></span><h1>utility<a class="headerlink" href="#utility" title="Link to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">utility</span></code> test group is a general test group for ocean utilities that
may create datasets for other test groups to use.  It is partly designed to
provide provenance for data processing that may be more complex than a single,
short script.</p>
<section id="combine-topo">
<h2>combine_topo<a class="headerlink" href="#combine-topo" title="Link to this heading"></a></h2>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.utility.combine_topo.CombineTopo.html#compass.ocean.tests.utility.combine_topo.CombineTopo" title="compass.ocean.tests.utility.combine_topo.CombineTopo"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.utility.combine_topo.CombineTopo</span></code></a>
defines a test case for combining the
<a class="reference external" href="https://nsidc.org/data/nsidc-0756/versions/3">BedMachine Antarctica v3</a>
dataset with the <a class="reference external" href="https://www.gebco.net/data_and_products/gridded_bathymetry_data/">GEBCO 2023</a>
dataset.</p>
<section id="combine">
<h3>combine<a class="headerlink" href="#combine" title="Link to this heading"></a></h3>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.utility.combine_topo.Combine.html#compass.ocean.tests.utility.combine_topo.Combine" title="compass.ocean.tests.utility.combine_topo.Combine"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.utility.combine_topo.Combine</span></code></a>
defines a step for combining the datasets above. The GEBCO and BedMachine data
are remapped to a common global grid to make later remapping to MPAS meshes
more manageable, and the two datasets are blended between 60 and 62 degrees
south latitude. The GEBCO global dataset is divided into regional tiles prior
to remapping to improve performance. Two common global target grid options are
provided: a 1/80 degree latitude-longitude grid and an ne3000 cubed sphere
grid. These target grid options are selectable via the <code class="docutils literal notranslate"><span class="pre">target_grid</span></code> argument
in the <a class="reference internal" href="../generated/compass.ocean.tests.utility.combine_topo.CombineTopo.html#compass.ocean.tests.utility.combine_topo.CombineTopo" title="compass.ocean.tests.utility.combine_topo.CombineTopo"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.utility.combine_topo.CombineTopo</span></code></a> test
case class.</p>
</section>
</section>
<section id="cull-restarts">
<h2>cull_restarts<a class="headerlink" href="#cull-restarts" title="Link to this heading"></a></h2>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.utility.cull_restarts.CullRestarts.html#compass.ocean.tests.utility.cull_restarts.CullRestarts" title="compass.ocean.tests.utility.cull_restarts.CullRestarts"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.utility.cull_restarts.CullRestarts</span></code></a>
defines a test case for culling ice-shelf cavities from MPAS-Ocean and -Seaice
restart files.</p>
<section id="cull">
<h3>cull<a class="headerlink" href="#cull" title="Link to this heading"></a></h3>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.utility.cull_restarts.Cull.html#compass.ocean.tests.utility.cull_restarts.Cull" title="compass.ocean.tests.utility.cull_restarts.Cull"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.utility.cull_restarts.Cull</span></code></a> defines
a step for culling ice-shelf cavities from MPAS-Ocean and -Seaice
restart files.  The step produces a culled mesh file, graph file, maps between
the unculled and culled meshes in addition to culled versions of the restart
files.</p>
</section>
</section>
<section id="extrap-woa">
<h2>extrap_woa<a class="headerlink" href="#extrap-woa" title="Link to this heading"></a></h2>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.utility.extrap_woa.ExtrapWoa.html#compass.ocean.tests.utility.extrap_woa.ExtrapWoa" title="compass.ocean.tests.utility.extrap_woa.ExtrapWoa"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.utility.extrap_woa.ExtrapWoa</span></code></a>
defines a test case for extrapolating
<a class="reference external" href="https://www.ncei.noaa.gov/products/world-ocean-atlas">WOA 2023</a> data into
ice-shelf cavities and coastal regions, then into land, grounded ice and below
bathymetry.</p>
<section id="id1">
<h3>combine<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.utility.extrap_woa.Combine.html#compass.ocean.tests.utility.extrap_woa.Combine" title="compass.ocean.tests.utility.extrap_woa.Combine"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.utility.extrap_woa.Combine</span></code></a> defines
a step for combining the Annual and January temperature and salinity
climatology data into a single file.  We use the 30-year objectively analyzed
climatology (1991-2020) data sets on a 0.25 degree lon-lat grid.  The WOA data
is provided only in the top 1500 m of the ocean in the monthly files, whereas
it extends to 5500 m depth in the annual dataset.  The test case uses the
January data where it is available and the annual data when monthly data is
not provided. Finally, the step converts in situ temperature to potential
temperature.</p>
</section>
<section id="remap-topography">
<h3>remap_topography<a class="headerlink" href="#remap-topography" title="Link to this heading"></a></h3>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.utility.extrap_woa.RemapTopography.html#compass.ocean.tests.utility.extrap_woa.RemapTopography" title="compass.ocean.tests.utility.extrap_woa.RemapTopography"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.utility.extrap_woa.RemapTopography</span></code></a>
defines a step for conservatively remapping a topography dataset (see
<a class="reference internal" href="../framework.html#dev-ocean-framework-remap-topography"><span class="std std-ref">Remapping Topography</span></a>) from a very high resolution
grid to the WOA 2023 0.25 degree grid.  The topography and masks are then used
to aid in the extrapolation process.  Because of the very high resolution
source grid, at least 360 cores are needed to make the mapping file in this
step.</p>
</section>
<section id="extrap-step">
<h3>extrap_step<a class="headerlink" href="#extrap-step" title="Link to this heading"></a></h3>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.utility.extrap_woa.ExtrapStep.html#compass.ocean.tests.utility.extrap_woa.ExtrapStep" title="compass.ocean.tests.utility.extrap_woa.ExtrapStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.utility.extrap_woa.ExtrapStep</span></code></a>
defines a step for extrapolating the data into invalid regions.  Because we
will use the dataset to interpolate potential temperature and salinity at the
centers of MPAS grid cells, we want there to be valid data not just where WOA
2023 has it defined but also in the cavities below Antarctic ice shelves, in a
buffer region into land, and below the bathymetry.  This way, the interpolation
will be sure never to be contaminated with NaNs or other invalid values.</p>
<p>The ice-shelf cavities provide a particular challenge.  No temperature or
salinity data is available for them in WOA 2023 but they cover vast areas so
it is not safe to simply extrapolate from the nearest point available in
the WOA dataset.  When we have done this in the past, properties deep in the
Filchner-Ronne ice-shelf cavity come from the Bellinghshausen Sea, which is
geographically close by but topographically disconnected from the cavity.  To
avoid this problem, we perform extrapolation in 4 steps.</p>
<ol class="arabic simple">
<li><p>Extrapolate horizontally from WOA 2023 data into regions that the topography
dataset indicates are ocean.  This includes anywhere where the top of a WOA
layer is above the bathymetry that is not covered the grounded antarctic ice
sheet.  This means that we extrapolate not only into ice-shelf cavities but
also into the ice-shelves above them.  Past experience has shown this to be
a helpful approach.</p></li>
<li><p>Extrapolate vertically downward from the surface to the seafloor.  This
fills in regions that are horizontally blocked by topography from any valid
WOA data (e.g. the deep interiors of ice-shelf cavities) but which are still
either in the ocean or in floating ice shelves.</p></li>
<li><p>Extrapolate horizontally from the results of step 2 to fill in land,
grounded ice sheet areas, and below the bathymetry.  here, we will likely
only ever use the data in a small halo around the “valid” ocean region when
we interpolate it to MPAS-Ocean meshes but we fill in everywhere “just in
case”.</p></li>
<li><p>Finally, we extrapolate vertically downward one last time all the way to the
bottom layer of the dataset.  This won’t do anything unless there happen to
be layers with no valid WOA data at all (which is not presently the case).</p></li>
</ol>
<p>The resulting file is ready to be placed in compass’ initial condition database
(see <a class="reference internal" href="../../organization.html#dev-step-input-download"><span class="std std-ref">Downloading and symlinking input files</span></a> for details on databases).</p>
</section>
</section>
<section id="create-salin-restoring">
<h2>create_salin_restoring<a class="headerlink" href="#create-salin-restoring" title="Link to this heading"></a></h2>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.utility.create_salin_restoring.CreateSalinRestoring.html#compass.ocean.tests.utility.create_salin_restoring.CreateSalinRestoring" title="compass.ocean.tests.utility.create_salin_restoring.CreateSalinRestoring"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.utility.create_salin_restoring.CreateSalinRestoring</span></code></a>
defines a test case for creating a monthly average sea surface salinity dataset based on the
<a class="reference external" href="https://www.ncei.noaa.gov/products/world-ocean-atlas">WOA 2023</a> data.  It also extrapolates
the twelve months of data into ice-shelf cavities and across continents.</p>
<section id="id3">
<h3>combine<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.utility.create_salin_restoring.Combine.html#compass.ocean.tests.utility.create_salin_restoring.Combine" title="compass.ocean.tests.utility.create_salin_restoring.Combine"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.utility.create_salin_restoring.Combine</span></code></a>
defines a step to download and combine January through December sea surface salinity into a single
file that serves as the base dataset for salinity restoring in forced ocean sea-ice cases (FOSI).
The surface level of WOA 2023 data is utilized.</p>
<p>The reference date for each month of data is assumed to be the 15th of each month.  In a simulation,
this implies that for a model start time of January 1, the salinity is restored to the average of
the December and January sea surface salinities.</p>
</section>
<section id="extrap">
<h3>extrap<a class="headerlink" href="#extrap" title="Link to this heading"></a></h3>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.utility.create_salin_restoring.Extrap.html#compass.ocean.tests.utility.create_salin_restoring.Extrap" title="compass.ocean.tests.utility.create_salin_restoring.Extrap"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.utility.create_salin_restoring.Extrap</span></code></a>
defines a step to extrapolate the combined January through December sea surface salinities
into missing ocean regions such as ice-shelf cavities and across continents.  Since this is only
extrapolation of surface values, masks are not utilized.</p>
</section>
<section id="remap">
<h3>remap<a class="headerlink" href="#remap" title="Link to this heading"></a></h3>
<p>The class <a class="reference internal" href="../generated/compass.ocean.tests.utility.create_salin_restoring.Remap.html#compass.ocean.tests.utility.create_salin_restoring.Remap" title="compass.ocean.tests.utility.create_salin_restoring.Remap"><code class="xref py py-class docutils literal notranslate"><span class="pre">compass.ocean.tests.utility.create_salin_restoring.Remap</span></code></a>
defines a step to remap the extrapolated data to a cubed-sphere grid at ne300
(~10 km) resolution. The cubed-sphere grid is much more favorable to remapping
to MPAS meshes, particularly at the poles and with significant smoothing.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tides.html" class="btn btn-neutral float-left" title="tides" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ziso.html" class="btn btn-neutral float-right" title="ziso" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) 2013-2021,  Los Alamos National Security, LLC (LANS) (Ocean: LA-CC-13-047;Land Ice: LA-CC-13-117) and the University Corporation for Atmospheric Research (UCAR)..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>